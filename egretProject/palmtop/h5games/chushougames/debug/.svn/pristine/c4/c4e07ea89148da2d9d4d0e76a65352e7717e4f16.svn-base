var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(o,r){function s(t){try{h(n.next(t))}catch(e){r(e)}}function a(t){try{h(n["throw"](t))}catch(e){r(e)}}function h(t){t.done?o(t.value):new i(function(e){e(t.value)}).then(s,a)}h((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return n([t,e])}}function n(i){if(o)throw new TypeError("Generator is already executing.");for(;h;)try{if(o=1,r&&(s=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[0,s.value]),i[0]){case 0:case 1:s=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,r=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(s=h.trys,!(s=s.length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){h.label=i[1];break}if(6===i[0]&&h.label<s[1]){h.label=s[1],s=i;break}if(s&&h.label<s[2]){h.label=s[2],h.ops.push(i);break}s[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(n){i=[6,n],r=0}finally{o=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var o,r,s,a,h={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},ZJ;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.skinName=t.Util.getClassName(i)+"Skin",i}return __extends(i,e),i.prototype.onDestroy=function(){return 0},i}(eui.Component);t.ComponentBase=e,__reflect(e.prototype,"ZJ.ComponentBase",["eui.UIComponent","egret.DisplayObject"])}(ZJ||(ZJ={}));var ZJ;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.setData=function(t){},e.prototype.show=function(){},e.prototype.onProgress=function(t,e){},e.prototype.onDestroy=function(){return t.prototype.onDestroy.call(this)},e}(t.ComponentBase);t.ViewBase=e,__reflect(e.prototype,"ZJ.ViewBase",["RES.PromiseTaskReporter"])}(ZJ||(ZJ={}));var ZJ;!function(t){var e=function(){function t(t,e,i){void 0===e&&(e=0),void 0===i&&(i=null),this.viewName="",this.layer=0,this.viewClass=null,this.viewName=t,this.layer=e,this.viewClass=i}return t}();t.UIData=e,__reflect(e.prototype,"ZJ.UIData")}(ZJ||(ZJ={}));var GameView=function(t){function e(){var e=t.call(this)||this;return e.INTERVAL=50,e.INTERVAL_PING=3e4,e.TOUCH_INTERVAL=180,e.DOUBLE_TAP_INTERVAL=500,e.TOUCH_DESC_INTERVAL=140,e.TOUCH_MIN_INTERVAL=50,e.TOUCH_MIN_DOWNINTERVAL=70,e.TOUCH_MIN_ROTATEINTERVAL=120,e.isTouchLeft=!1,e.isTouchRight=!1,e.isTouchDown=!1,e.isTouchRotate=!1,e.hasTouchMoveLeft=!1,e.hasTouchMoveRight=!1,e.hasTouchMoveDown=!1,e.hasTouchRotate=!1,e.touchLeftTime=0,e.touchRightTime=0,e.touchDownTime=0,e.touchRotateTime=0,e.lastTouchTapTime=0,e.addCount=0,e.timeOnEnterFrame=0,e.texiaoPosArray=[],e.bgmVolume=.5,e.bgmAddVolume=.1,e.intervalPing=0,e.skinName="GameViewSkin",e}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),ModuleConfig.compile.danji?ZJ.AudioManager.Instance.playBgm(0,this.bgmVolume):ZJ.AudioManager.Instance.isMute=!0,this.leftBtn.iconDisplay.horizontalCenter=30,this.rightBtn.iconDisplay.horizontalCenter=-30,this.fallBtn.iconDisplay.verticalCenter=-5,this.downBtn.iconDisplay.verticalCenter=0,setTimeout(function(){ZJ.ShapeUtil.setArcMask(e.head1,e.head1.width/2,0,1,!0,e.head1.width/2,e.head2.height/2),ZJ.ShapeUtil.setArcMask(e.head2,e.head2.width/2,0,1,!0,e.head2.width/2,e.head2.height/2)},50),ModuleConfig.compile.danji?ZJ.UIManager.instance.destroyView(UIName.Loading):this.connect();for(var i=0;i<this.texiaoPosGroup.numChildren;i++){var n=this.texiaoPosGroup.getChildAt(i);this.texiaoPosArray.push(new ZJ.Vector3(n.horizontalCenter,n.verticalCenter))}this.tetris1=new Tetris,this.tetris1.nextTetrisGroup=this.nextGroup,this.tetris1.doubleNextTetrisGroup=this.doubleNextGroup,this.tetris1Group.addChild(this.tetris1),this.tetris1.x=28,this.tetris1.y=50,this.tetris1.addEventListener(EventName.GAME_OVER,function(){e.tetris2.isOver=!0,ZJ.AudioManager.Instance.play("death"),"danger"==ZJ.AudioManager.Instance.bgm&&ZJ.AudioManager.Instance.stopBgm(),ModuleConfig.compile.danji&&(e.replay.getChildAt(0).source="fail_png",e.replay.getChildAt(1).text="",e.replay.visible=!0)},this),this.tetris1.addEventListener(EventName.SPEED_READY,function(){e.readySpeedEvent()},this),this.tetris1.addEventListener(EventName.SPEED,function(t){var i=ZJ.AudioManager.Instance.getChannel("bgm");if(null!=i){var n=i.volume;n+=e.bgmAddVolume,n>1&&(n=1),i.volume=n}e.updateSpeedTip(t.data)},this),this.tetris1.addEventListener(EventName.SPECIAL_X,function(t){setTimeout(function(){e.playFlyBlock()},100),(ModuleConfig.compile.danji||1==e.player2.isRobot)&&setTimeout(function(){e.tetris2.addObsBlock(t.data.uprow)},600),t.data.combo>=1&&e.createComboEffect(t.data.combo)},this),this.tetris2=new Tetris,ModuleConfig.compile.danji&&this.tetris2.setAI(!0),this.tetris2Group.addChild(this.tetris2),this.tetris2.x=1,this.tetris2.y=0,this.tetris2.scaleX=.38,this.tetris2.scaleY=.385,this.tetris2.addEventListener(EventName.GAME_OVER,function(){ModuleConfig.compile.danji?(e.tetris1.isOver=!0,e.replay.getChildAt(0).source="win_png",e.replay.getChildAt(1).text="",e.replay.visible=!0):1==e.player2.isRobot&&ZJ.SocketManager.instance.send(11012,{winPlayerId:e.playerId})},this),this.tetris2.addEventListener(EventName.SPECIAL_X,function(t){(ModuleConfig.compile.danji||1==e.player2.isRobot)&&setTimeout(function(){e.tetris1.addObsBlock(t.data.uprow)},300)},this),this.replay.visible=!1,this.replay.addEventListener("touchTap",function(){if(ModuleConfig.compile.danji){if(e.replay.visible=!1,e.tetris1.seed=ZJ.Util.timeStamp(),e.tetris2.seed=e.tetris1.seed,e.tetris1.rePlay(),e.tetris2.rePlay(),"bgm"!=ZJ.AudioManager.Instance.bgm)ZJ.AudioManager.Instance.stopBgm(),ZJ.AudioManager.Instance.bgm="bgm",ZJ.AudioManager.Instance.playBgm(0,e.bgmVolume);else{var t=ZJ.AudioManager.Instance.getChannel("bgm");t.volume=e.bgmVolume}e.guideBg.alpha=1,e.guideBg.visible=!0,e.guideMask.alpha=.5,e.guideMask.visible=!0,e.updateSpeedTip(1),e.countDownToPlay(3)}},this),this.leftBtn.addEventListener("touchBegin",function(t){this.tetris1.moveLeft()},this),this.leftBtn.addEventListener("touchBegin",function(t){this.isTouchLeft=!0,this.leftBtn.icon="left_click_png"},this),this.leftBtn.addEventListener("touchEnd",function(t){this.isTouchLeft=!1,this.touchLeftTime=0,this.addCount=0,this.leftBtn.icon="left_png"},this),this.leftBtn.addEventListener("touchReleaseOutside",function(t){this.isTouchLeft=!1,this.touchLeftTime=0,this.addCount=0,this.leftBtn.icon="left_png"},this),this.rightBtn.addEventListener("touchBegin",function(t){this.tetris1.moveRight()},this),this.rightBtn.addEventListener("touchBegin",function(t){this.isTouchRight=!0,this.rightBtn.icon="right_click_png"},this),this.rightBtn.addEventListener("touchEnd",function(t){this.isTouchRight=!1,this.touchRightTime=0,this.addCount=0,this.rightBtn.icon="right_png"},this),this.rightBtn.addEventListener("touchReleaseOutside",function(t){this.isTouchRight=!1,this.touchRightTime=0,this.addCount=0,this.rightBtn.icon="right_png"},this),this.downBtn.addEventListener("touchBegin",function(t){this.tetris1.moveDown()},this),this.downBtn.addEventListener("touchBegin",function(t){this.isTouchDown=!0,this.downBtn.icon="down_click_png"},this),this.downBtn.addEventListener("touchEnd",function(t){this.tetris1.hasTouchDown=!1,this.isTouchDown&&(this.tetris1.time=0),this.isTouchDown=!1,this.touchDownTime=0,this.addCount=0,this.downBtn.icon="down_png"},this),this.downBtn.addEventListener("touchReleaseOutside",function(t){this.tetris1.hasTouchDown=!1,this.isTouchDown&&(this.tetris1.time=0),this.isTouchDown=!1,this.touchDownTime=0,this.addCount=0,this.downBtn.icon="down_png"},this),this.fallBtn.addEventListener("touchBegin",function(t){this.tetris1.moveFastDown()},this),this.fallBtn.addEventListener("touchBegin",function(t){this.fallBtn.iconDisplay.source="fall_click_png"},this),this.fallBtn.addEventListener("touchEnd",function(t){this.fallBtn.icon="fall_png"},this),this.fallBtn.addEventListener("touchReleaseOutside",function(t){this.fallBtn.icon="fall_png"},this),this.rotateBtn.addEventListener("touchBegin",function(t){this.tetris1.rotateOnce()},this),this.rotateBtn.addEventListener("touchBegin",function(t){this.isTouchRotate=!0,this.rotateBtn.icon="rotate_click_png"},this),this.rotateBtn.addEventListener("touchEnd",function(t){this.isTouchRotate=!1,this.touchRotateTime=0,this.addCount=0,this.rotateBtn.icon="rotate_png"},this),this.rotateBtn.addEventListener("touchReleaseOutside",function(t){this.isTouchRotate=!1,this.touchRotateTime=0,this.addCount=0,this.rotateBtn.icon="rotate_png"},this),ModuleConfig.compile.danji||(this.tetris1.addEventListener(EventName.MOVE_LEFT,function(t){ZJ.SocketManager.instance.send(11010,{processData:ZJ.Util.objToByteArray({playerId:e.playerId,cmd:TetrisCmd.moveleft}).bytes})},this),this.tetris1.addEventListener(EventName.MOVE_RIGHT,function(t){ZJ.SocketManager.instance.send(11010,{processData:ZJ.Util.objToByteArray({playerId:e.playerId,cmd:TetrisCmd.moveright}).bytes})},this),this.tetris1.addEventListener(EventName.MOVE_DOWN,function(t){ZJ.SocketManager.instance.send(11010,{processData:ZJ.Util.objToByteArray({playerId:e.playerId,cmd:TetrisCmd.movedown}).bytes})},this),this.tetris1.addEventListener(EventName.MOVE_FAST_DOWN,function(t){ZJ.SocketManager.instance.send(11010,{processData:ZJ.Util.objToByteArray({playerId:e.playerId,cmd:TetrisCmd.movefastdown}).bytes})},this),this.tetris1.addEventListener(EventName.ROTATE,function(t){ZJ.SocketManager.instance.send(11010,{processData:ZJ.Util.objToByteArray({playerId:e.playerId,cmd:TetrisCmd.rotate}).bytes})},this),this.tetris1.addEventListener(EventName.ADD_OBS_BLOCK,function(t){ZJ.SocketManager.instance.send(11010,{processData:ZJ.Util.objToByteArray({playerId:e.playerId,cmd:TetrisCmd.addObsBlockMySelf,data:t.data}).bytes})},this),this.tetris1.addEventListener(EventName.SPECIAL_X,function(t){ZJ.SocketManager.instance.send(11010,{processData:ZJ.Util.objToByteArray({playerId:e.playerId,cmd:TetrisCmd.addObsBlockToEnemy,data:t.data.uprow}).bytes})},this),this.tetris1.addEventListener(EventName.GAME_OVER,function(t){ZJ.SocketManager.instance.send(11012,{winPlayerId:e.player2.playerId})},this),this.tetris1.addEventListener(EventName.MOVE_END_EVENT,function(t){ZJ.SocketManager.instance.send(11011,{playerScore:t.data.clearRow,resultData:ZJ.Util.objToByteArray({data:t.data.data}).bytes})},this)),this.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this),this.timeOnEnterFrame=egret.getTimer(),this.lastTouchTapTime=-1*this.DOUBLE_TAP_INTERVAL,ZJ.SocketManager.instance.addEventListener(ZJ.CommonEventName.SOCKET_CONNECTED,this.onSocketConnected,this),ZJ.SocketManager.instance.addEventListener(ZJ.CommonEventName.SOCKET_DATA,this.onSocketData,this),ZJ.SocketManager.instance.addEventListener(ZJ.CommonEventName.CHANNEL_DATA,this.onChannelData,this),ModuleConfig.compile.danji?(this.tetris1.seed=ZJ.Util.timeStamp(),this.tetris2.seed=this.tetris1.seed,this.tetris1.rePlay(),this.tetris2.rePlay(),this.countDownToPlay(3)):(this.tetris1.isPlay=!1,this.tetris2.isPlay=!1,ModuleConfig.compile.ali&&ALISDK.CatcherSDK.instance().updateProgress(ALISDK.CatcherSDK.ProgressState.COMPLETED,100)),this.stage.addEventListener(egret.Event.ACTIVATE,function(){if(!e.tetris1.isOver){var t=1;"bgm"==ZJ.AudioManager.Instance.bgm&&(t=e.bgmVolume),ZJ.AudioManager.Instance.playBgm(0,t)}},this),this.stage.addEventListener(egret.Event.DEACTIVATE,function(){ZJ.AudioManager.Instance.stopAll()},this)},e.prototype.onEnterFrame=function(t){var e=egret.getTimer(),i=this.timeOnEnterFrame,n=e-i;if(this.isTouchLeft&&(this.touchLeftTime+=n,this.touchLeftTime>=this.TOUCH_INTERVAL-this.addCount*this.TOUCH_DESC_INTERVAL&&this.touchLeftTime>=this.TOUCH_MIN_INTERVAL)){this.touchLeftTime=0,this.addCount=1;for(var o=0;o<this.addCount;o++)this.tetris1.moveLeft();this.hasTouchMoveLeft=!0}if(this.isTouchRight&&(this.touchRightTime+=n,this.touchRightTime>=this.TOUCH_INTERVAL-this.addCount*this.TOUCH_DESC_INTERVAL&&this.touchRightTime>=this.TOUCH_MIN_INTERVAL)){this.touchRightTime=0,this.addCount=1;for(var o=0;o<this.addCount;o++)this.tetris1.moveRight();this.hasTouchMoveRight=!0}if(this.isTouchDown&&(this.touchDownTime+=n,this.touchDownTime>=this.TOUCH_INTERVAL-this.addCount*this.TOUCH_DESC_INTERVAL&&this.touchDownTime>=this.TOUCH_MIN_DOWNINTERVAL)){this.touchDownTime=0,this.addCount=1;for(var o=0;o<this.addCount;o++)this.tetris1.moveDown();this.hasTouchMoveDown=!0,this.tetris1.hasTouchDown=!0}this.timeOnEnterFrame=egret.getTimer()},e.prototype.playFlyBlock=function(){var t=this;if(null==this.flyParticles){var e=RES.getRes("texiao1_png"),i=RES.getRes("texiao1_json");this.flyParticles=new particle.GravityParticleSystem(e,i);var n=new eui.Group;n.horizontalCenter=0,n.verticalCenter=0,this.addChild(n),n.addChild(this.flyParticles)}var o=new FlyBlock;this.texiaoGroup.addChild(o),o.callBack=function(e){ZJ.ResManager.instance.loadMovieClip("baodian","baodian",function(i,n){i.play(1),o.addChild(i),i.x=e.x,i.y=e.y,i.scaleX=4,i.scaleY=4,i.rotation=-o.rotation,i.addEventListener(egret.MovieClipEvent.FRAME_LABEL,function(t){"@end"==t.frameLabel&&(o.removeChild(i),o.parent.removeChild(o))},t)})},o.play(this.texiaoPosArray,this.flyParticles)},e.prototype.playFlyBlockToSpeedTip=function(){var t=this;if(null==this.flyParticles2){var e=RES.getRes("texiao1_png"),i=RES.getRes("texiao1_json");this.flyParticles2=new particle.GravityParticleSystem(e,i);var n=new eui.Group;n.horizontalCenter=0,n.verticalCenter=0,this.addChild(n),n.addChild(this.flyParticles2)}var o=new FlyBlock;this.texiaoGroup.addChild(o);for(var r=[new ZJ.Vector3(this.speedGroup.horizontalCenter,this.speedGroup.verticalCenter),new ZJ.Vector3(this.speedTipGroup.horizontalCenter+80,this.speedTipGroup.verticalCenter)],s=0;s<o.rotateArray.length;s++)o.rotateArray[s]=-115;o.callBack=function(e){ZJ.ResManager.instance.loadMovieClip("baodian2","baodian2",function(i,n){i.play(1),o.addChild(i),i.x=e.x,i.y=e.y,i.scaleX=4,i.scaleY=4,i.rotation=-o.rotation,i.addEventListener(egret.MovieClipEvent.FRAME_LABEL,function(t){"@end"==t.frameLabel&&(o.removeChild(i),o.parent.removeChild(o))},t)})},o.play(r,this.flyParticles2,!1)},e.prototype.createComboEffect=function(t){var e=new Combo;e.setCombo(t),e.horizontalCenter=300,e.verticalCenter=280,this.addChild(e),e.show()},e.prototype.sendPing=function(){ModuleConfig.compile.danji||(this.intervalPing=setInterval(function(){ZJ.SocketManager.instance.send(11004)},this.INTERVAL_PING))},e.prototype.sendLogin=function(){ModuleConfig.compile.danji||ZJ.SocketManager.instance.send(11e3,{openId:yyGameConfig.openId,nickname:yyGameConfig.nickname,avatarUrl:yyGameConfig.avatarUrl,timestamp:yyGameConfig.timestamp,sign:yyGameConfig.sign})},e.prototype.connect=function(){},e.prototype.onSocketConnected=function(){},e.prototype.onSocketData=function(t){var e=t.data;switch(e.protoID){case 11e3:this.onLogin(e.data);break;case 11001:this.onMatchRoom(e.data);break;case 11002:this.onReadyGame(e.data);break;case 11003:this.onCountDown(e.data),ZJ.UIManager.instance.destroyView(UIName.Loading);break;case 11010:this.onReceiveGameData(e.data);break;case 11011:this.onReceiveCheckData(e.data);break;case 11012:this.onReceiveWin(e.data)}},e.prototype.onChannelData=function(t){var e=t.data.eventName,i=t.data.event;switch(console.log("onChannelData "+e),e){case"CONNECT":break;case"PROGRESS":break;case"READY":this.sendPing(),this.readyGame();break;case"KICK":break;case"GAMEOVER":break;case"BREAK":break;case"CONTINUE":break;case"ERROR":break;case"MIC_CHANGE":this.onMicChange(i);break;case"AUDIO_CHANGE":this.onAudioChange(i)}},e.prototype.onLogin=function(t){console.log("登录结果:"+t.result+", 玩家id:"+t.playerId),this.playerId=t.playerId},e.prototype.matchRoom=function(t){ZJ.SocketManager.instance.send(11001,{matchId:t})},e.prototype.onMatchRoom=function(t){console.log("匹配房间结果:"+t.result+", 生成房间id:"+t.roomId+", 匹配id:"+t.matchId)},e.prototype.readyGame=function(){ZJ.SocketManager.instance.send(11002,{})},e.prototype.onReadyGame=function(t){console.log("准备游戏结果:"+t.result),this.playerId=t.playerId,this.tetris1.seed=t.seeds[0],this.tetris2.seed=t.seeds[0],this.tetris2.setReceiver(!0)},e.prototype.onCountDown=function(t){console.log("开始倒计时:"+t.readyTime),this.visible=!0;for(var e=0;e<t.playerInfos.length;e++)if(t.playerInfos[e].playerId==this.playerId)this.player1=t.playerInfos[e];else if(this.player2=t.playerInfos[e],1==this.player2.isRobot){this.tetris2.setAI(!0);var i=this.player2.robotLevel;(null==i||0/0==i)&&(i=2),0==i&&(i=ZJ.MathUtil.randomRange(1,4,this.tetris2.seed)),this.tetris2.setAILevel(i)}this.tetris1.battleTimes=this.player1.battleTimes,this.tetris2.battleTimes=this.player2.battleTimes,this.player1.battleTimes<10?(this.guideBg.visible=!0,this.guideMask.visible=!0):(this.guideBg.visible=!1,this.guideMask.visible=!1,this.daojishiGroup.verticalCenter=-143),""!=this.player1.avatarUrl?this.head1.source=this.player1.avatarUrl:2==this.player1.gender&&(this.head1.source="girl_png"),""!=this.player2.avatarUrl?this.head2.source=this.player2.avatarUrl:1==this.player2.gender&&(this.head2.source="boy_png"),this.updateSex(this.player1,this.player1.gender),this.updateSex(this.player2,this.player2.gender),this.tetris1.rePlay(),this.tetris2.rePlay(),this.countDownToPlay(3)},e.prototype.onReceiveGameData=function(t){var e,i,n=new egret.ByteArray(t.processData),o=JSON.parse(n.readUTF());t.playerId==this.playerId?(e=this.tetris1,i=this.tetris2):(e=this.tetris2,i=this.tetris1);var r=o.cmd;if(e==this.tetris2)if(r==TetrisCmd.moveleft)e.pushCmd(r,null);else if(r==TetrisCmd.moveright)e.pushCmd(r,null);else if(r==TetrisCmd.movedown)e.pushCmd(r,null);else if(r==TetrisCmd.movefastdown)e.pushCmd(r,null);else if(r==TetrisCmd.rotate)e.pushCmd(r,null);else if(r==TetrisCmd.addObsBlockToEnemy){var s=o.data;i.addObsBlock(s)}else if(r==TetrisCmd.addObsBlockMySelf){var s=o.data;e.addObsBlock(s)}else r==TetrisCmd.checkData&&this.onReceiveCheckData(o.data)},e.prototype.onReceiveCheckData=function(t){var e=t.playerId;if(e==this.player2.playerId){var i=new egret.ByteArray(t.resultData),n=JSON.parse(i.readUTF());this.tetris2.pushCmd(TetrisCmd.checkData,n.data)}},e.prototype.onReceiveWin=function(t){var e=t.result,i=t.winPlayerId;if(0==e){var n=void 0;n=i==this.playerId?"win_png":"fail_png",this.tetris1.isOver=!0,this.tetris2.isOver=!0,this.replay.visible=!0,this.replay.getChildAt(0).source=n,this.replay.getChildAt(1).text="",ZJ.AudioManager.Instance.stopBgm()}else console.log("结果通知返回失败")},e.prototype.onMicChange=function(t){for(var e=t.statusList,i=0;i<e.length;i++){var n=e[i],o=void 0;o=n.openId==this.player1.openId?this.player1:this.player2;var r=n.micStatus;this.updateVoice(o,r)}},e.prototype.onAudioChange=function(t){ZJ.AudioManager.Instance.isMute=!t.audioStatus},e.prototype.updateSex=function(t,e){var i;i=t==this.player1?this.sex1:this.sex2,1==e?i.source="boy_png":i.source="girl_png"},e.prototype.updateVoice=function(t,e){var i;i=t==this.player1?this.voice1:this.voice2,1==e?i.source="voice_open_png":i.source="voice_close_png"},e.prototype.countDownToPlay=function(t){var e=this;this.tetris1.isPlay=!1,this.tetris2.isPlay=!1;var i=ZJ.ResManager.instance.loadDragonBones("daojishi");this.daojishiGroup.addChild(i),i.addDBEventListener(dragonBones.EventObject.COMPLETE,function(t){e.guideBg.visible&&(egret.Tween.get(e.guideBg).to({alpha:0},200).call(function(){e.guideBg.visible=!1}),egret.Tween.get(e.guideMask).to({alpha:0},200).call(function(){e.guideMask.visible=!1})),e.tetris1.isPlay=!0,e.tetris2.isPlay=!0,e.tetris1.createRandomTetris(),e.tetris2.createRandomTetris(),e.daojishiGroup.removeChild(i)},this),i.animation.play("newAnimation",1)},e.prototype.readySpeedEvent=function(){var t=this,e=ZJ.ResManager.instance.loadDragonBones("sudu");this.speedGroup.addChild(e),e.animation.play("newAnimation",-1),setTimeout(function(){t.playFlyBlockToSpeedTip()},2500),setTimeout(function(){e.animation.stop(),t.speedGroup.removeChild(e)},2500)},e.prototype.updateSpeedTip=function(t){var e=this;if(1>t?t=1:t>5&&(t=5),this.speedTip.source!="speed"+t+"_png"){var i=new eui.Image;i.source="speed"+t+"_png",null==this.defSpeedTipTopY&&(this.defSpeedTipTopY=this.speedTip.top),this.speedTipGroup.addChild(i),i.horizontalCenter=this.speedTip.horizontalCenter,i.top=this.defSpeedTipTopY+70,ZJ.ShapeUtil.setRectMask(i,this.speedTip.x,this.defSpeedTipTopY,1.5*i.width,1.5*i.height),ZJ.ShapeUtil.setRectMask(this.speedTip,this.speedTip.x,this.defSpeedTipTopY-.25*this.speedTip.height,1.5*this.speedTip.width,1.5*this.speedTip.height),egret.Tween.get(i).to({top:this.defSpeedTipTopY},400),egret.Tween.get(this.speedTip).to({top:this.defSpeedTipTopY-70},400).call(function(){e.speedTipGroup.removeChild(e.speedTip.mask),e.speedTipGroup.removeChild(e.speedTip),e.speedTip=i})}},e.prototype.onDestroy=function(){return clearInterval(this.intervalPing),ZJ.SocketManager.instance.removeEventListener(ZJ.CommonEventName.SOCKET_CONNECTED,this.onSocketConnected,this),ZJ.SocketManager.instance.removeEventListener(ZJ.CommonEventName.SOCKET_DATA,this.onSocketData,this),ZJ.SocketManager.instance.removeEventListener(ZJ.CommonEventName.CHANNEL_DATA,this.onChannelData,this),0},e}(ZJ.ViewBase);__reflect(GameView.prototype,"GameView");var LoadingView=function(t){function e(){var e=t.call(this)||this;return e.intervalID=0,e.ran1=0,e.ran2=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);var e=ZJ.ShapeUtil.getRect(0,1,this.stage.stageWidth,this.stage.stageHeight);this.addChild(e);var i=500,n=new eui.ProgressBar;n.skinName="YYLoadingPBSkin",this.progress=n,this.progress.width=450,this.progress.height=62,this.progress.minimum=0,this.progress.maximum=100,this.progress.horizontalCenter=0,this.progress.y=i+435,this.progress.scaleX=1.3,this.progress.scaleY=1.3,this.progress.labelFunction=function(t,e){return t+"%"},this.addChild(this.progress);var o=new eui.Image;o.source="load_img03_png",o.horizontalCenter=0,o.y=i+630,o.width=510,o.height=100,o.alpha=.2,this.addChild(o),this.load3=new eui.Label,this.load3.text="等待对手加入游戏...",this.load3.horizontalCenter=0,this.load3.y=i+660,this.load3.size=40,this.load3.textColor=16777215,this.addChild(this.load3),this.startCount()},e.prototype.startCount=function(){var t=this;this.intervalID=setInterval(function(){t.ran2=Math.min(t.ran2+8*Math.random()+2,99),t.progress.value=Math.floor((t.ran1+t.ran2)/2)},200)},e.prototype.onProgress=function(t,e){this.ran1=Math.floor(t/e*100),this.progress.value=Math.floor((this.ran1+this.ran2)/2)},e.prototype.onDestroy=function(){return t.prototype.onDestroy.call(this),clearInterval(this.intervalID),0},e}(ZJ.ViewBase);__reflect(LoadingView.prototype,"LoadingView");var ZJ;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.cb=null,t.leftSecond=0,t.intervalID=0,t.isPause=!1,t.skinName="CountDownSkin",t}return __extends(i,e),i.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},i.prototype.start=function(t){var e=this;this.stop(),this.isPause=!1,this.leftSecond=t,this.count(),this.intervalID=setInterval(function(){e.count()},1e3)},i.prototype.pause=function(){this.isPause=!0},i.prototype.resume=function(){this.isPause=!1},i.prototype.stop=function(){clearInterval(this.intervalID)},i.prototype.setSecond=function(e){var i=Math.floor(e/60)%60,n=e%60,o=this.checkTime(i),r=this.checkTime(n);this.label.text=t.Util.strFormat("{0}:{1}",o,r)},i.prototype.count=function(){return this.setSecond(this.leftSecond),0==this.leftSecond?(this.stop(),void(null!=this.cb&&this.cb())):void(this.isPause||this.leftSecond--)},i.prototype.checkTime=function(t){return 10>t&&(t="0"+t),t},i.prototype.OnDestroy=function(){this.cb=null,this.stop()},i}(eui.Component);t.CountDown=e,__reflect(e.prototype,"ZJ.CountDown",["eui.UIComponent","egret.DisplayObject"])}(ZJ||(ZJ={}));var Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){},egret.lifecycle.onResume=function(){},egret.registerImplementation("eui.IAssetAdapter",new AssetAdapter),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,this.createGameScene()];case 1:return e.sent(),[4,platform.login()];case 2:return e.sent(),[4,platform.getUserInfo()];case 3:return t=e.sent(),console.log(t),[2]}})})},e.prototype.createGameScene=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return egret.ImageLoader.crossOrigin="anonymous",ModuleConfig.compile.yy&&onPKLoading(),[4,ZJ.ResManager.instance.init(this.stage)];case 1:return e.sent(),[4,ZJ.ResManager.instance.loadGroup("realpreload")];case 2:return e.sent(),ZJ.UIManager.instance.init(this),ZJ.UIManager.instance.uiLayers=ModuleConfig.uiLayers,ZJ.UIManager.instance.uiDatas=ModuleConfig.uiDatas,t=this.GetLoadingView(),[4,ZJ.ResManager.instance.loadGroup("sample",0,t)];case 3:return e.sent(),ZJ.SocketManager.instance.init(),1==ModuleConfig.compile.yy&&onPKFinishLoading(),ModuleStartUp.init(),1==ModuleConfig.compile.yy&&onPKStart(),[2]}})})},e.prototype.GetLoadingView=function(){var t=null,e=null;return ModuleConfig.compile.need_loading&&(ModuleConfig.compile.danji?e=LoadingView:ModuleConfig.compile.yy?e=YYLoadingView:ModuleConfig.compile.ali&&(e=AliLoadingView)),null!=e&&(ModuleConfig.uiDatas[UIName.Loading].viewClass=e,t=ZJ.UIManager.instance.openView(UIName.Loading)),t},e.prototype.onEnterFrame=function(){},e}(eui.UILayer);__reflect(Main.prototype,"Main");var ZJ;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){return 0},e._instance=new e,e}(egret.EventDispatcher);t.EventManager=e,__reflect(e.prototype,"ZJ.EventManager")}(ZJ||(ZJ={}));var ZJ;!function(t){var e=function(){function e(){}return e.randomRange=function(e,i,n){null==n&&(n=t.Util.timeStamp());var o=this.randomSeed(n);return o/=233280,Math.floor(e+o*(i-e))},e.randomSeed=function(t){return t=(9301*t+49297)%233280},e.YiYuanErCi=function(t,e,i){var n,o,r,s=[];return n=e*e-4*t*i,0>n||(o=(-1*e+Math.sqrt(n))/(2*t),r=(-1*e-Math.sqrt(n))/(2*t),s.push(o),s.push(r)),s},e}();t.MathUtil=e,__reflect(e.prototype,"ZJ.MathUtil")}(ZJ||(ZJ={}));var ZJ;!function(t){var e=function(){function e(){this.aa=null,this.stage=null,this.dbFactory=dragonBones.EgretFactory.factory,this.dbFileNames=[]}return Object.defineProperty(e,"instance",{get:function(){return this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.stage=t,this.aa=new AssetAdapter,[4,this.loadConfig("resource/default.res.json?v="+Math.random(),"resource/")];case 1:return e.sent(),[4,this.loadTheme()];case 2:return e.sent(),[2]}})})},e.prototype.loadRes=function(t,e,i,n){this.aa.getAsset(t,e,i,n)},e.prototype.loadExistRes=function(t){return RES.getRes(t)},e.prototype.loadConfig=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,RES.loadConfig(t,e)];case 1:return i.sent(),[2]}})})},e.prototype.loadGroup=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=null),__awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,RES.loadGroup(t,e,i)];case 1:return o.sent(),[3,3];case 2:return n=o.sent(),console.error(n),[3,3];case 3:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,i){var n=new eui.Theme("resource/default.thm.json",t.stage);n.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.loadMovieClip=function(e,i,n){t.ResManager.instance.loadRes(e+"_json",function(o,r){var s=o;t.ResManager.instance.loadRes(e+"_png",function(t,e){var o=t,r=new egret.MovieClipDataFactory(s,o),a=new egret.MovieClip(r.generateMovieClipData(i));n(a,r)},this)},this)},e.prototype.loadDragonBones=function(t,e){if(void 0===e&&(e=""),""==e&&(e=t),-1==this.dbFileNames.indexOf(t)){var i=this.loadExistRes(t+"_ske_json"),n=this.loadExistRes(t+"_tex_json"),o=this.loadExistRes(t+"_tex_png");this.dbFactory.parseDragonBonesData(i),this.dbFactory.parseTextureAtlasData(n,o),this.dbFileNames.push(t)}var r=this.dbFactory.buildArmatureDisplay(e);return r},e.prototype.replaceDBSlotDisplay=function(t,e,i,n,o){void 0===e&&(e=""),""==e&&(e=t),this.dbFactory.replaceSlotDisplay(t,e,i,n,o)},e._instance=new e,e}();t.ResManager=e,__reflect(e.prototype,"ZJ.ResManager")}(ZJ||(ZJ={}));var ZJ;!function(t){var e=function(){function t(){}return t.getRect=function(t,e,i,n,o,r){void 0===o&&(o=0),void 0===r&&(r=0);var s=new egret.Shape;return s.graphics.beginFill(t,e),s.graphics.drawRect(o,r,i,n),s.graphics.endFill(),s},t.getCircle=function(t,e,i,n,o){void 0===n&&(n=0),void 0===o&&(o=0);var r=new egret.Shape;return r.graphics.beginFill(t,e),r.graphics.drawCircle(n,o,i),r.graphics.endFill(),r},t.getLine=function(t,e,i,n,o,r,s){var a=new egret.Shape;return a.graphics.lineStyle(i,t,e),a.graphics.moveTo(n,o),a.graphics.lineTo(r,s),a.graphics.endFill(),a},t.getArc=function(t,e,i,n,o,r,s,a,h){void 0===s&&(s=!1),void 0===a&&(a=0),void 0===h&&(h=0);var l=new egret.Shape;return l.graphics.lineStyle(i,t,e),l.graphics.drawArc(a,h,n,Math.PI/180*o,Math.PI/180*r,s),l.graphics.endFill(),l},t.getArch=function(t,e,i,n,o,r,s,a){void 0===r&&(r=!1),void 0===s&&(s=0),void 0===a&&(a=0);var h=new egret.Shape;return h.graphics.beginFill(t,e),h.graphics.drawArc(s,a,i,Math.PI/180*n,Math.PI/180*o,r),h.graphics.endFill(),h},t.setArcMask=function(t,e,i,n,o,r,s){void 0===o&&(o=!1),void 0===r&&(r=t.x),void 0===s&&(s=t.y);var a;null!=t.mask?a=t.mask:(a=new egret.Shape,t.parent.addChild(a));var h=Math.round(i+360*n)*Math.PI/180;i*=Math.PI/180,a.graphics.clear(),a.graphics.beginFill(16711680,1),a.graphics.lineTo(e,0),a.graphics.drawArc(r,s,e,i,h,o),a.graphics.lineTo(r,s),a.graphics.endFill(),a.x=t.x,a.y=t.y,t.mask=a},t.setRectMask=function(t,e,i,n,o){void 0===e&&(e=t.x),void 0===i&&(i=t.y),void 0===n&&(n=t.width),void 0===o&&(o=t.height);var r;null!=t.mask?r=t.mask:(r=new egret.Shape,t.parent.addChild(r)),r.graphics.clear(),r.graphics.beginFill(16711680,1),r.graphics.drawRect(0,0,n,o),r.graphics.endFill(),r.x=e,r.y=i,t.mask=r},t}();t.ShapeUtil=e,__reflect(e.prototype,"ZJ.ShapeUtil")}(ZJ||(ZJ={}));var ZJ;!function(t){var e=function(t){function e(e,i,n,o){var r=t.call(this,e,i,n,o)||this;return r.data=null,r}return __extends(e,t),e}(egret.Event);t.SocketDataEvent=e,__reflect(e.prototype,"ZJ.SocketDataEvent")}(ZJ||(ZJ={}));var ZJ;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.socket=null,t.ProtoBufRoot=new protobuf.Root,t.send=null,t.onSocketData=null,t.getProtoByID=null,t._company=1,t.clientIndex=0,t
}return __extends(i,e),Object.defineProperty(i,"instance",{get:function(){return this._instance},enumerable:!0,configurable:!0}),i.prototype.init=function(){return this.parseProto(),this.socket=new egret.WebSocket,this.socket.type=egret.WebSocket.TYPE_BINARY,this.setCompany(1),this.socket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onSocketData,this),this.socket.addEventListener(egret.Event.CONNECT,this.onSocketConnect,this),0},i.prototype.parseProto=function(){for(var t=this.ProtoBufRoot,e=ModuleConfig.protoFiles,i=0,n=e.length;n>i;++i){var o=RES.getRes(e[i]);protobuf.parse(o,t)}},i.prototype.setCompany=function(t){switch(this._company=t,t){case 2:this.send=this.sendYouai,this.onSocketData=this.onSocketDataYouai,this.getProtoByID=this.getProtoByIDYouai;break;case 3:this.send=this.sendAli,this.getProtoByID=this.getProtoByIDHuoshu;break;default:this.send=this.sendHuoshu,this.onSocketData=this.onSocketDataHuoshu,this.getProtoByID=this.getProtoByIDHuoshu}},i.prototype.connect=function(t,e){this.socket.connect(t,e)},i.prototype.connectByUrl=function(t){this.socket.connectByUrl(t)},i.prototype.close=function(){this.socket.close()},i.prototype.onSocketConnect=function(e){var i=new egret.Event(t.CommonEventName.SOCKET_CONNECTED);this.dispatchEvent(i)},i.prototype.buildSmallShitByID=function(t,e){var i=this.getProtoByID(t,!0),n=this.buildSmallShit(i,e);return n},i.prototype.decodeShitByID=function(t,e){var i=this.getProtoByID(t,!1),n=this.decodeShit(i,e);return n},i.prototype.buildSmallShit=function(t,e){var i=t.create(e),n=t.encode(i),o=n.finish();return o},i.prototype.decodeShit=function(t,e){var i=t.decode(e);return i},i.prototype.sendHuoshu=function(t,e){void 0===e&&(e={});var i=this.buildSmallShitByID(t,e),n=new egret.ByteArray;n.writeInt(i.byteLength),n.writeShort(t),n._writeUint8Array(i),this.socket.writeBytes(n)},i.prototype.onSocketDataHuoshu=function(e){var i=new egret.ByteArray;this.socket.readBytes(i);var n=(i.readInt(),i.readShort()),o=this.decodeShitByID(n,i.bytes.subarray(6)),r=new t.SocketDataEvent(t.CommonEventName.SOCKET_DATA);r.data={data:o,protoID:n},this.dispatchEvent(r)},i.prototype.getProtoByIDHuoshu=function(e,i){var n=(Math.floor(e/1e3),""),o="";o=i?"cs_":"sc_",n=o+e;var r=t.SocketManager.instance.ProtoBufRoot,s=r.lookupType(n);return s},i.prototype.sendYouai=function(t,e){void 0===e&&(e={});var i=this.buildSmallShitByID(t,e),n=this.buildSmallShitByID(99999,{messageId:t,clientIndex:this.clientIndex++,data:i}),o=new egret.ByteArray(n);this.socket.writeBytes(o)},i.prototype.onSocketDataYouai=function(e){var i=new egret.ByteArray;this.socket.readBytes(i);var n=this.decodeShitByID(99999,i.bytes),o="",r={},s=n.result,a=n.messageId;n.result?r=this.decodeShitByID(n.messageId,n.data):o=t.Util.Utf8ArrayToStr(n.data);var h=new t.SocketDataEvent(t.CommonEventName.SOCKET_DATA);h.data={data99999:n,error:o,result:s,data:r,protoID:a},this.dispatchEvent(h)},i.prototype.getProtoByIDYouai=function(e,i){var n="";if(i)switch(e){case 99999:n="ClientCmdData";break;case 1e3:n="CmdLoginGameReqMsg";break;case 1001:n="CmdPingReqMsg";break;case 1300:n="CmdJumperUploadAnswerReqMsg";break;case 1303:n="CmdJumperGameOverReqMsg"}else switch(e){case 99999:n="ServerCmdData";break;case 1e3:n="CmdLoginGameRspMsg";break;case 1001:n="CmdPingRspMsg";break;case 1300:n="CmdJumperUploadAnswerRspMsg";break;case 1303:n="CmdJumperGameOverRspMsg";break;case 1399:n="CmdBroadcastJumperBC"}var o=t.SocketManager.instance.ProtoBufRoot,r=o.lookupType(n);return r},i.prototype.sendAli=function(t,e){void 0===e&&(e={});var i=this.buildSmallShitByID(t,e),n=new egret.ByteArray;n.writeInt(i.byteLength),n.writeShort(t),n._writeUint8Array(i),ALISDK.CatcherSDK.instance().sendData(n.buffer)},i.prototype.onSocketDataAli=function(e){var i=new egret.ByteArray(e),n=(i.readInt(),i.readShort()),o=this.decodeShitByID(n,i.bytes.subarray(6));console.log("receive: "+n),console.log(o);var r=new t.SocketDataEvent(t.CommonEventName.SOCKET_DATA);r.data={data:o,protoID:n},this.dispatchEvent(r)},i.prototype.connectByUrlAli=function(e){var i=this;ALISDK.CatcherSDK.init({url:"ws://"+e.ip+":"+e.port+"/ws/game",gameVersion:"0.0.1",gameId:"123123",messageType:"ARRAYBUFFER"}),ALISDK.CatcherSDK.instance().on("CONNECT",function(e){var n=new t.ChannelDataEvent(t.CommonEventName.CHANNEL_DATA);n.data={eventName:"CONNECT",event:e},i.dispatchEvent(n)}).on("PROGRESS",function(e){var n=new t.ChannelDataEvent(t.CommonEventName.CHANNEL_DATA);n.data={eventName:"PROGRESS",event:e},i.dispatchEvent(n)}).on("READY",function(e){var n=new t.ChannelDataEvent(t.CommonEventName.CHANNEL_DATA);n.data={eventName:"READY",event:e},i.dispatchEvent(n)}).on("KICK",function(e){var n=new t.ChannelDataEvent(t.CommonEventName.CHANNEL_DATA);n.data={eventName:"KICK",event:e},i.dispatchEvent(n)}).on("GAMEOVER",function(e){var n=new t.ChannelDataEvent(t.CommonEventName.CHANNEL_DATA);n.data={eventName:"GAMEOVER",event:e},i.dispatchEvent(n)}).on("BREAK",function(e){var n=new t.ChannelDataEvent(t.CommonEventName.CHANNEL_DATA);n.data={eventName:"BREAK",event:e},i.dispatchEvent(n)}).on("CONTINUE",function(e){var n=new t.ChannelDataEvent(t.CommonEventName.CHANNEL_DATA);n.data={eventName:"CONTINUE",event:e},i.dispatchEvent(n)}).on("ERROR",function(e){var n=new t.ChannelDataEvent(t.CommonEventName.CHANNEL_DATA);n.data={eventName:"ERROR",event:e},i.dispatchEvent(n)}).on("MIC_CHANGE",function(e){var n=new t.ChannelDataEvent(t.CommonEventName.CHANNEL_DATA);n.data={eventName:"MIC_CHANGE",event:e},i.dispatchEvent(n)}).on("AUDIO_CHANGE",function(e){var n=new t.ChannelDataEvent(t.CommonEventName.CHANNEL_DATA);n.data={eventName:"AUDIO_CHANGE",event:e},i.dispatchEvent(n)}).on("MESSAGE",function(t){i.onSocketDataAli(t.data)}).start()},i._instance=new i,i}(egret.EventDispatcher);t.SocketManager=e,__reflect(e.prototype,"ZJ.SocketManager")}(ZJ||(ZJ={}));var ZJ;!function(t){var e=function(){function e(){this._tables={}}return Object.defineProperty(e,"instance",{get:function(){return this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){return this.load("bg_djw_png"),0},Object.defineProperty(e.prototype,"tables",{get:function(){return this._tables},enumerable:!0,configurable:!0}),e.prototype.load=function(e){t.ResManager.instance.loadRes(e,function(e){for(var i,n=i.file(/^[tc].*/),o=0,r=n.length;r>o;o++){var s=n[o],a=t.Util.strFormat("shared/{0}",s.name);this._tables[a]=JSON.parse(s.asText())}t.EventManager.instance.dispatchEvent(new egret.Event(t.CommonEventName.TABLE_LOADED))},this)},e._instance=new e,e}();t.TableManager=e,__reflect(e.prototype,"ZJ.TableManager")}(ZJ||(ZJ={}));var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,n){function o(t){e.call(n,t)}function r(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),i.call(n))}"undefined"!=typeof generateEUI?egret.callLater(function(){e.call(n,generateEUI)},this):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(t,o,this,RES.ResourceItem.TYPE_TEXT))},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i,n){function o(n){e.call(i,n,t)}if(void 0===n&&(n=RES.ResourceItem.TYPE_IMAGE),RES.hasRes(t)){var r=RES.getRes(t);r?o(r):RES.getResAsync(t,o,this)}else RES.getResByUrl(t,o,this,n)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var ZJ;!function(t){var e=function(){function t(){this._uiLayers=[],this.uiDatas={},this.uiroot=null,this.views={}}return Object.defineProperty(t,"instance",{get:function(){return this._instance},enumerable:!0,configurable:!0}),t.prototype.init=function(t){return this.uiroot=t,0},Object.defineProperty(t.prototype,"uiLayers",{set:function(t){if(this._uiLayers.length>0)egret.warn("uiLayers已经设定。");else{this._uiLayers=t;for(var e=0,i=this._uiLayers.length;i>e;++e){var n=new eui.Group;n.name="layer"+e,n.touchEnabled=!1,this.uiroot.addChild(n),n.percentWidth=100,n.percentHeight=100}}},enumerable:!0,configurable:!0}),t.prototype.getUIData=function(t){return this.uiDatas[t]},t.prototype.getView=function(t){return this.views[t]},t.prototype.openView=function(t){var e=this.getUIData(t);if(void 0==e)return egret.log("ModuleConfig没有界面配置: "+t),null;var i=this.getView(t);if(void 0!=i);else{if(i=new e.viewClass,void 0==i)return console.warn("viewClass不存在 请检查ModuleConfig.uiDatas"),null;i.percentWidth=100,i.percentHeight=100,this.views[t]=i;var n=0;e.layer<this.uiroot.numChildren&&(n=e.layer),this.uiroot.getChildAt(n).addChild(i)}return i.visible=!0,i.parent.setChildIndex(i,9999),i.show(),i},t.prototype.destroyView=function(t){var e=this.getView(t);return void 0!=e&&null!=e&&(e.onDestroy(),e.parent.removeChild(e),this.views[t]=null),0},t._instance=new t,t}();t.UIManager=e,__reflect(e.prototype,"ZJ.UIManager")}(ZJ||(ZJ={}));var ZJ;!function(t){var e=function(){function t(){}return t.getChar=function(t,e){var i=new egret.ByteArray;return i.writeUTFBytes(t),i.length<e?t:(i.position=0,i.readUTFBytes(e)+"...")},t.strFormat=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return t.replace(/\{(\d+)\}/g,function(t,i){return e[i]})},t.timeStamp=function(t){return t=t||(new Date).toString(),Date.parse(t)/1e3},t.Utf8ArrayToStr=function(t){var e,i,n,o,r,s;for(e="",n=t.length,i=0;n>i;)switch(o=t[i++],o>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:e+=String.fromCharCode(o);break;case 12:case 13:r=t[i++],e+=String.fromCharCode((31&o)<<6|63&r);break;case 14:r=t[i++],s=t[i++],e+=String.fromCharCode((15&o)<<12|(63&r)<<6|(63&s)<<0)}return e},t.getClassName=function(t){if(t&&t.constructor&&t.constructor.toString()){if(t.constructor.name)return t.constructor.name;var e=t.constructor.toString();if("["==e.charAt(0))var i=e.match(/\[\w+\s*(\w+)\]/);else var i=e.match(/function\s*(\w+)/);if(i&&2==i.length)return i[1]}},t.objToByteArray=function(t){var e=JSON.stringify(t),i=new egret.ByteArray;return i.writeUTF(e),i},t.rmArrayObj=function(t,e){return-1!=t.indexOf(e)?t.splice(t.indexOf(e),1):void 0},t}();t.Util=e,__reflect(e.prototype,"ZJ.Util")}(ZJ||(ZJ={}));var ZJ;!function(t){var e=function(){function t(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this.x=0,this.y=0,this.z=0,this.x=t,this.y=e,this.z=i}return t}();t.Vector3=e,__reflect(e.prototype,"ZJ.Vector3")}(ZJ||(ZJ={}));var ZJ;!function(t){var e=function(){function e(){this.bgm="bgm",this._isMute=!1,this.sounds={},this.soundsChannel={}}return Object.defineProperty(e,"Instance",{get:function(){return this._instance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isMute",{get:function(){return this._isMute},set:function(t){this._isMute=t,this._isMute?this.stopAll():(this.stopBgm(),this.playBgm())},enumerable:!0,configurable:!0}),e.prototype.playBgm=function(t,e){void 0===t&&(t=0),void 0===e&&(e=1),this._isMute||null!=this.bgm&&""!=this.bgm&&this.play(this.bgm,t,e,!0)},e.prototype.stopBgm=function(){this.stop(this.bgm)},e.prototype.play=function(e,i,n,o){var r=this;void 0===i&&(i=1),void 0===n&&(n=1),void 0===o&&(o=!1);var s=e+"_mp3";if(!this._isMute)if(null!=this.sounds[e]){o&&this.stop(e);var a=this.sounds[e].play(0,i);this.soundsChannel[e]=a,a.volume=n}else t.ResManager.instance.loadRes(s,function(t,o){var s=t,a=s.play(0,i);a.volume=n,r.sounds[e]=s,r.soundsChannel[e]=a},this)},e.prototype.stop=function(t){null!=this.soundsChannel[t]&&(this.soundsChannel[t].stop(),this.soundsChannel[t]=null)},e.prototype.stopAll=function(){for(var t in this.soundsChannel)this.stop(t)},e.prototype.getSound=function(t){return this.sounds[t]},e.prototype.getChannel=function(t){return this.soundsChannel[t]},e._instance=new e,e}();t.AudioManager=e,__reflect(e.prototype,"ZJ.AudioManager")}(ZJ||(ZJ={}));var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.share=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ZJ;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.INTERVAL=60,i.DISTANCE=20,i.pastTime=0,i.lastPos=new t.Vector3,i.nowPos=new t.Vector3,i.isBegin=!1,i.intervalID=0,i}return __extends(i,e),i.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},i.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),this.layer.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.layer.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.layer.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.intervalID=setInterval(function(){t.onInterval()},this.INTERVAL)},i.prototype.onInterval=function(){if(this.isBegin){var e=this.nowPos.x-this.lastPos.x,i=this.nowPos.y-this.lastPos.y,n=Math.abs(e),o=Math.abs(i),r={};if(n>o?n>this.DISTANCE&&(e>0?r.direct=t.CommonConfig.RIGHT:r.direct=t.CommonConfig.LEFT,this.isBegin=!1):o>this.DISTANCE&&(i>0?r.direct=t.CommonConfig.DOWN:r.direct=t.CommonConfig.UP,this.isBegin=!1),!this.isBegin){var s=new egret.Event(t.CommonEventName.GESTURE_DIRECT);s.data=r,t.EventManager.instance.dispatchEvent(s)}this.lastPos.x=this.nowPos.x,this.lastPos.y=this.nowPos.y}},i.prototype.onTouchBegin=function(t){this.pastTime=0,this.nowPos.x=t.stageX,this.nowPos.y=t.stageY,this.lastPos.x=t.stageX,this.lastPos.y=t.stageY,this.isBegin=!0},i.prototype.onTouchEnd=function(t){this.isBegin=!1},i.prototype.onTouchMove=function(t){this.nowPos.x=t.stageX,this.nowPos.y=t.stageY},i.prototype.OnDestroy=function(){return clearInterval(this.intervalID),0},i}(t.ComponentBase);t.Gesture=e,__reflect(e.prototype,"ZJ.Gesture")}(ZJ||(ZJ={}));var MyButton=function(t){function e(){var e=t.call(this)||this;return e.addEventListener("touchBegin",function(){e.img.visible=!1},e),e.addEventListener("touchEnd",function(){e.img.visible=!0},e),e.addEventListener("touchReleaseOutside",function(){e.img.visible=!0},e),e}return __extends(e,t),e}(ZJ.ComponentBase);__reflect(MyButton.prototype,"MyButton");var UILayer=function(){function t(){}return t.View=0,t.Pop=1,t.SDK=2,t}();__reflect(UILayer.prototype,"UILayer");var UIName=function(){function t(){}return t.Game="Game",t.Loading="Loading",t}();__reflect(UIName.prototype,"UIName");var ModuleConfig=function(){function t(){}return t.WIN_INDEX=6,t.uiLayers=[UILayer.View,UILayer.Pop,UILayer.SDK],t.uiDatas=(_a={},_a[UIName.Game]=new ZJ.UIData(UIName.Game,UILayer.View,GameView),_a[UIName.Loading]=new ZJ.UIData(UIName.Loading,UILayer.Pop,LoadingView),_a),t.compile={need_loading:!0,ali:!0,danji:!0},t.ip="192.168.1.134",t.port="8081",t.protoFiles=["p11_proto"],t}();__reflect(ModuleConfig.prototype,"ModuleConfig");var EventName=function(){function t(){}return t.SPEED="Speed",t.SPEED_READY="SpeedReady",t.MOVE_LEFT="Moveleft",t.MOVE_RIGHT="MoveRight",t.MOVE_DOWN="MoveDown",t.MOVE_FAST_DOWN="MoveFastDown",t.ROTATE="Rotate",t.ADD_OBS_BLOCK="AddObsBlock",t.SPECIAL_X="Special_X",t.MOVE_END_EVENT="MoveEndEvent",t.GAME_OVER="GameOver",t}();__reflect(EventName.prototype,"EventName");var _a,ModuleStartUp=function(){function t(){}return t.init=function(){return ZJ.SocketManager.instance.setCompany(3),ZJ.UIManager.instance.openView(UIName.Game),0},t}();__reflect(ModuleStartUp.prototype,"ModuleStartUp");var ModuleUtil=function(){function t(){}return Object.defineProperty(t,"tables",{get:function(){return ZJ.TableManager.instance.tables},enumerable:!0,configurable:!0}),t}();__reflect(ModuleUtil.prototype,"ModuleUtil");var Block=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.skinName="BlockSkin"},e}(eui.Component);__reflect(Block.prototype,"Block",["eui.UIComponent","egret.DisplayObject"]);var Combo=function(t){function e(){var e=t.call(this)||this;return e.skinName="ComboSkin",e}return __extends(e,t),e.prototype.setCombo=function(t){this.comboLabel.text="X"+t.toString()},e.prototype.show=function(){var t=this;this.scaleX=.5,this.scaleY=.5;var e=350,i=150,n=500,o=500;egret.Tween.get(this).to({scaleX:1.1,scaleY:1.1,verticalCenter:this.verticalCenter-250},e).call(function(){egret.Tween.get(t).to({scaleX:1,scaleY:1,verticalCenter:t.verticalCenter+80},i).wait(n).call(function(){egret.Tween.get(t).to({alpha:0},o).call(function(){t.parent.removeChild(t)})},t)},this)},e}(eui.Component);__reflect(Combo.prototype,"Combo",["eui.UIComponent","egret.DisplayObject"]);var FlyBlock=function(t){function e(){var e=t.call(this)||this;e.posArray=[],e.curIndex=0,e.rotateArray=[-105,-105],e.moveTimeArray=[0,320],e.moveTotalTime=0,e.callBack=null,e.skinName="FlyBlockSkin";for(var i=0;i<e.moveTimeArray.length;i++)e.moveTotalTime+=e.moveTimeArray[i];return e}return __extends(e,t),e.prototype.play=function(t,e,i){void 0===i&&(i=!0),this.particleSystem=e,this.posArray=t,this.ball.visible=!0,this.tail.scaleY=.1,this.tail.visible=!0,this.tail.source="tail_png",this.light_point.visible=!0,this.horizontalCenter=this.posArray[0].x,this.verticalCenter=this.posArray[0].y,this.rotation=this.rotateArray[0];var n=["J","L","Z","S","T","O","I"];i&&(this.ball_block.source="block_"+n[ZJ.MathUtil.randomRange(0,n.length)]+"_png",this.ball_block.scaleX=0,this.ball_block.scaleY=0,this.ball_block.rotation=0,this.ball_block.visible=!0,egret.Tween.get(this.ball_block).to({scaleX:1,scaleY:1},this.moveTimeArray[1]),egret.Tween.get(this.ball_block).to({rotation:150},this.moveTotalTime)),this.particleSystem.emitterX=this.posArray[0].x,this.particleSystem.emitterY=this.posArray[0].y,this.particleSystem.start(),this.moveNextPos()},e.prototype.moveNextPos=function(){var t=this;if(this.curIndex++,this.curIndex>=this.posArray.length)this.light_point.visible=!1,this.ball_block.visible=!1,setTimeout(function(){t.tail.visible=!1},50),null!=this.callBack&&this.callBack(this.ball),this.particleSystem.stop();else{var e=this.posArray[this.curIndex];egret.Tween.get(this.particleSystem).to({emitterX:e.x,emitterY:e.y},this.moveTimeArray[this.curIndex]),egret.Tween.get(this).to({horizontalCenter:e.x,verticalCenter:e.y,rotation:this.rotateArray[this.curIndex]},this.moveTimeArray[this.curIndex]).call(function(){t.moveNextPos()}),1==this.curIndex&&egret.Tween.get(this.tail).to({scaleY:1},this.moveTimeArray[this.curIndex]/2)}},e}(eui.Component);__reflect(FlyBlock.prototype,"FlyBlock",["eui.UIComponent","egret.DisplayObject"]);var NumCountDown=function(t){function e(){var e=t.call(this)||this;return e.cb=null,e.leftSecond=0,e.intervalID=0,e.isPause=!1,e.skinName="NumCountDownSkin",e}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.start=function(t){var e=this;this.stop(),this.isPause=!1,this.leftSecond=t,this.count(),this.intervalID=setInterval(function(){e.count()},1e3)},e.prototype.pause=function(){this.isPause=!0},e.prototype.stop=function(){this.label.text="",clearInterval(this.intervalID)},e.prototype.count=function(){return this.label.text=this.leftSecond.toString(),0==this.leftSecond?(this.stop(),void(null!=this.cb&&this.cb())):void(this.isPause||this.leftSecond--)},e.prototype.OnDestroy=function(){this.cb=null,this.stop()},e}(eui.Component);__reflect(NumCountDown.prototype,"NumCountDown",["eui.UIComponent","egret.DisplayObject"]);var Dir;!function(t){t[t.left=0]="left",t[t.right=1]="right",t[t.down=2]="down"}(Dir||(Dir={}));var TetrisCmd;!function(t){t[t.rotate=0]="rotate",t[t.moveleft=1]="moveleft",t[t.moveright=2]="moveright",t[t.movedown=3]="movedown",t[t.movefastdown=4]="movefastdown",t[t.addObsBlockToEnemy=5]="addObsBlockToEnemy",t[t.addObsBlockMySelf=6]="addObsBlockMySelf",t[t.gameover=7]="gameover",t[t.checkData=8]="checkData"}(TetrisCmd||(TetrisCmd={}));var Tetris=function(t){function e(){var e=t.call(this)||this;e.COL=10,e.ROW=20,e.BLOCK_WIDTH=56.5,e.BLOCK_HEIGHT=56.2,e.SMALL_BLOCK_PERCENT=.55,e.DEF_INTERVAL=700,e.TETRIS_NAMES=["block_J","block_L","block_S","block_Z","block_T","block_I","block_O"],e.SPEED_INTERVAL=100,e.MIN_INTERVAL=100,e.SPEED_READY_TIME=3e3,e.clear_row=0,e.use_time=0,e.bornBeginPos=new Pos(0,3),e.curBlockBeginPos=new Pos(0,3),e.curBlockTetrisType=0,e.curBlockState=0,e.curBlockTetrisTypeName="",e.curBlockArray=[],e.shadowBlocks=[],e.nextBlockArray=[],e.doubleNextBlockArray=[],e.timeOnEnterFrame=0,e.randomNumArray=[],e.isOver=!1,e.isPlay=!0,e.isAI=!1,e.isReceiver=!1,e.addSpeedCount=0,e.time=0,e.isDoMoveEndEvent=!1,e.isMoveFastDown=!1,e.hasTouchDown=!1,e.combo=-1,e.interval=e.DEF_INTERVAL,e.hasReadySpeed=!1,e.speedLevel=1,e.curRanIndex=-1,e.curRanCount=0,e.cmdArray=[],e.whitePanelArray=[],e.AIReadyRotateTimeArray=[250,130,90,10],e.AIReadyMoveTimeArray=[200,130,90,10],e.AIReadyMoveFastDownTimeArray=[500,370,270,10],e.AIRotateIntervalTimeArray=[250,160,120,10],e.AIMoveIntervalTimeArray=[230,140,50,10],e.curAILevel=3,e.AIWrongProArray=[30,15,0,0],e.seed=0,e.battleTimes=0,e.tetrisInfo=[new TetrisInfo([[[0,0,0,0],[0,1,1,1],[0,0,0,1],[0,0,0,0]],[[0,0,1,0],[0,0,1,0],[0,1,1,0],[0,0,0,0]],[[0,0,0,0],[0,1,0,0],[0,1,1,1],[0,0,0,0]],[[0,0,1,1],[0,0,1,0],[0,0,1,0],[0,0,0,0]]]),new TetrisInfo([[[0,0,0,0],[0,1,1,1],[0,1,0,0],[0,0,0,0]],[[0,1,1,0],[0,0,1,0],[0,0,1,0],[0,0,0,0]],[[0,0,0,0],[0,0,0,1],[0,1,1,1],[0,0,0,0]],[[0,0,1,0],[0,0,1,0],[0,0,1,1],[0,0,0,0]]]),new TetrisInfo([[[0,0,0,0],[0,0,1,1],[0,1,1,0],[0,0,0,0]],[[0,1,0,0],[0,1,1,0],[0,0,1,0],[0,0,0,0]]]),new TetrisInfo([[[0,0,0,0],[0,1,1,0],[0,0,1,1],[0,0,0,0]],[[0,0,0,1],[0,0,1,1],[0,0,1,0],[0,0,0,0]]]),new TetrisInfo([[[0,0,0,0],[0,1,1,1],[0,0,1,0],[0,0,0,0]],[[0,0,1,0],[0,1,1,0],[0,0,1,0],[0,0,0,0]],[[0,0,0,0],[0,0,1,0],[0,1,1,1],[0,0,0,0]],[[0,0,1,0],[0,0,1,1],[0,0,1,0],[0,0,0,0]]]),new TetrisInfo([[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]]]),new TetrisInfo([[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]]])],e.AIRotateIdArray=[],e.AIMoveIdArray=[],e.total_width=e.BLOCK_WIDTH*e.COL,e.total_height=e.BLOCK_HEIGHT*e.ROW,e.width=e.total_width,e.height=e.total_height,e.blocks=new Array;for(var i=0;i<e.ROW;i++){e.blocks[i]=new Array;for(var n=0;n<e.COL;n++)e.blocks[i][n]=null}return e.skinName="",e}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),ZJ.ResManager.instance.loadMovieClip("luodi","luodi",function(t,i){e.luodiFactory=i}),this.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this)},e.prototype.onEnterFrame=function(t){if(this.isPlay&&!this.isOver){var e=egret.getTimer(),i=this.timeOnEnterFrame,n=e-i;for(this.use_time+=n,this.battleTimes>=10||ModuleConfig.compile.danji?(this.use_time>=6e4-this.SPEED_READY_TIME&&this.use_time<6e4?this.speedReadyEvent():this.use_time>=9e4-this.SPEED_READY_TIME&&this.use_time<9e4?this.speedReadyEvent():this.use_time>=9e4+3e4*(this.addSpeedCount+1)-this.SPEED_READY_TIME&&this.use_time<9e4+3e4*(this.addSpeedCount+1)&&this.speedReadyEvent(),this.use_time>=6e4&&this.use_time<9e4?this.interval>500&&(this.interval=500,this.hasReadySpeed=!1,this.speedLevel++,this.dispatchEvent(new egret.Event(EventName.SPEED,!1,!1,this.speedLevel))):this.use_time>=9e4&&this.use_time<12e4?this.interval>300&&(this.interval=300,this.hasReadySpeed=!1,this.speedLevel++,this.dispatchEvent(new egret.Event(EventName.SPEED,!1,!1,this.speedLevel))):this.use_time>=9e4+3e4*(this.addSpeedCount+1)&&(this.addSpeedCount++,this.interval-=100,this.interval<this.MIN_INTERVAL?this.interval=this.MIN_INTERVAL:(this.hasReadySpeed=!1,this.speedLevel++,this.dispatchEvent(new egret.Event(EventName.SPEED,!1,!1,this.speedLevel))))):(this.use_time>=9e4-this.SPEED_READY_TIME&&this.use_time<9e4?this.speedReadyEvent():this.use_time>=15e4-this.SPEED_READY_TIME&&this.use_time<15e4?this.speedReadyEvent():this.use_time>=15e4+3e4*(this.addSpeedCount+1)-this.SPEED_READY_TIME&&this.use_time<15e4+3e4*(this.addSpeedCount+1)&&this.speedReadyEvent(),this.use_time>=9e4&&this.use_time<15e4?this.interval>500&&(this.interval=500,this.hasReadySpeed=!1,this.speedLevel++,this.dispatchEvent(new egret.Event(EventName.SPEED,!1,!1,this.speedLevel))):this.use_time>=15e4&&this.use_time<18e4?this.interval>300&&(this.interval=300,this.hasReadySpeed=!1,this.speedLevel++,this.dispatchEvent(new egret.Event(EventName.SPEED,!1,!1,this.speedLevel))):this.use_time>=15e4+3e4*(this.addSpeedCount+1)&&(this.addSpeedCount++,this.interval-=100,this.interval<this.MIN_INTERVAL?this.interval=this.MIN_INTERVAL:(this.hasReadySpeed=!1,this.speedLevel++,this.dispatchEvent(new egret.Event(EventName.SPEED,!1,!1,this.speedLevel))))),this.time+=n,(!this.isReceiver||this.isAI)&&this.time>=this.getIntervalTime()&&!this.hasTouchDown&&(this.onInterval(),this.time=0);this.cmdArray.length>0&&this.isPlay;){var o=this.cmdArray.shift(),r=o.cmd,s=o.data;r==TetrisCmd.rotate?this.rotateOnce():r==TetrisCmd.moveleft?this.moveLeft():r==TetrisCmd.moveright?this.moveRight():r==TetrisCmd.movedown?this.moveDown():r==TetrisCmd.movefastdown?this.moveFastDown():r==TetrisCmd.checkData&&(this.checkDataSame(s)||this.setDatas(s))}this.timeOnEnterFrame=egret.getTimer()}},e.prototype.createTetris=function(t,e){var i=this.getTetrisInfo(t,e);this.curBlockTetrisType=t,this.curBlockTetrisTypeName=this.TETRIS_NAMES[t],this.curBlockState=e;for(var n=-1,o=i.length-1;o>=0&&-1==n;o--)for(var r=0;r<i[o].length;r++)if(1==i[o][r]){n=o;break}this.curBlockBeginPos.i=this.bornBeginPos.i-(n-0),this.curBlockBeginPos.j=this.bornBeginPos.j,this.createTetrisBlockByInfo(i),this.setTetrisShadow()},e.prototype.createRandomTetris=function(){var t=this,e=this.randomNumArray.shift();this.createTetris(e.tetrisType,e.state),this.randomNumArray.push(this.getRandomNumByRule()),this.nextTetrisGroup&&this.setTetrisBySelf(this.randomNumArray[0].tetrisType,this.randomNumArray[0].state,this.BLOCK_WIDTH*this.SMALL_BLOCK_PERCENT,this.BLOCK_HEIGHT*this.SMALL_BLOCK_PERCENT,this.nextTetrisGroup),this.doubleNextTetrisGroup&&this.setTetrisBySelf(this.randomNumArray[1].tetrisType,this.randomNumArray[1].state,this.BLOCK_WIDTH*this.SMALL_BLOCK_PERCENT*.7,this.BLOCK_HEIGHT*this.SMALL_BLOCK_PERCENT*.7,this.doubleNextTetrisGroup),this.isAI&&setTimeout(function(){var e=t.getFitAIPos();null!=e&&t.setFitAIPos(e)},300)},e.prototype.getRandomNum=function(){var t={};return this.seed=ZJ.MathUtil.randomSeed(this.seed),t.tetrisType=ZJ.MathUtil.randomRange(0,this.tetrisInfo.length,this.seed),this.seed=ZJ.MathUtil.randomSeed(this.seed),t.state=ZJ.MathUtil.randomRange(0,this.tetrisInfo[t.tetrisType].info.length,this.seed),t},e.prototype.getRandomNumByRule=function(){var t=this.getRandomNum();if(t.tetrisType!=this.curRanIndex?(this.curRanIndex=t.tetrisType,this.curRanCount=1):this.curRanCount++,this.curRanCount>=3)for(;;)if(t=this.getRandomNum(),t.tetrisType!=this.curRanIndex){this.curRanIndex=t.tetrisType,this.curRanCount=1;break}return t},e.prototype.createTetrisBlockByInfo=function(t){if(null!=t){this.curBlockArray.length=0;for(var e=0;e<t.length;e++)for(var i=0;i<t[e].length;i++)if(1==t[e][i]){var n=new Block;n.width=this.BLOCK_WIDTH,n.height=this.BLOCK_HEIGHT,this.addChild(n),this.curBlockArray.push(n);var o=this.getPosByIndex(this.curBlockBeginPos.i+e,this.curBlockBeginPos.j+i);n.x=o.x,n.y=o.y,n.row=this.curBlockBeginPos.i+e,n.col=this.curBlockBeginPos.j+i,n.tetrisType=this.curBlockTetrisType,n.img.source=this.curBlockTetrisTypeName+"_png",n.row<0&&(n.visible=!1)}}},e.prototype.setTetrisBySelf=function(t,e,i,n,o){if(!this.isAI&&!this.isReceiver){var r=this.getTetrisInfo(t,e);if(r){var s=0,a=void 0;if(o==this.nextTetrisGroup?a=this.nextBlockArray:o==this.doubleNextTetrisGroup&&(a=this.doubleNextBlockArray),a){for(var h=0,l=0,c=0;c<r.length;c++)for(var u=0;u<r[c].length;u++)if(1==r[c][u]){h++;break}for(var u=0;u<r[0].length;u++)for(var c=0;c<r.length;c++)if(1==r[c][u]){l++;break}for(var d=new Pos(-1,-1),c=0;c<r.length&&-1==d.i;c++)for(var u=0;u<r[c].length;u++)if(1==r[c][u]){d.i=c;break}for(var u=0;u<r[0].length&&-1==d.j;u++)for(var c=0;c<r.length;c++)if(1==r[c][u]){d.j=u;break}for(var p=new Array,c=0;c<r.length;c++){p[c]=new Array;for(var u=0;u<r[c].length;u++)1==r[c][u]&&(p[c-d.i][u-d.j]=1)}for(var v=new Pos(-(h-1)/2*n,-(l-1)/2*i),f=0;h>f;f++)for(var g=0;l>g;g++)if(1==p[f][g]){var y=new Pos(v.i+f*n,v.j+g*i);if(s++,a){var m=void 0;a.length>=s?(m=a[s-1],m.visible=!0):(m=new Block,a.push(m),o.addChild(m),a==this.doubleNextBlockArray&&(m.alpha=.5)),m.horizontalCenter=y.j,m.verticalCenter=y.i,m.width=i,m.height=n,m.img.source=this.TETRIS_NAMES[t]+"_png"}}for(var f=0;f<a.length;f++)f>=s&&(a[f].visible=!1)}}}},e.prototype.getTetrisInfo=function(t,e){if(t>=0&&t<this.tetrisInfo.length){var i=this.tetrisInfo[t];if(e>=0&&e<i.info.length)return i.info[e]}return null},e.prototype.getRandomTetrisInfo=function(){this.seed=ZJ.MathUtil.randomSeed(this.seed);var t=ZJ.MathUtil.randomRange(0,this.tetrisInfo.length,this.seed),e=this.tetrisInfo[t];this.seed=ZJ.MathUtil.randomSeed(this.seed);var i=ZJ.MathUtil.randomRange(0,e.info.length);return{tetrisType:t,state:i}},e.prototype.moveTetris=function(t,e){if(void 0===e&&(e=!0),this.isOver||!this.isPlay)return!1;var i=new Pos(this.curBlockBeginPos.i,this.curBlockBeginPos.j);t==Dir.left?i.j--:t==Dir.right?i.j++:t==Dir.down&&i.i++;for(var n=this.tetrisInfo[this.curBlockTetrisType].info[this.curBlockState],o=!0,r=[],s=0;s<n.length&&o;s++)for(var a=0;a<n[s].length;a++)if(1==n[s][a]){var h=new Pos(i.i+s,i.j+a);if(!(h.i<this.ROW&&h.j>=0&&h.j<this.COL)){o=!1;break}if(h.i>=0&&null!=this.blocks[h.i][h.j]&&-1==this.curBlockArray.indexOf(this.blocks[h.i][h.j])){o=!1;break}r.push(h)}if(o){this.curBlockBeginPos.i=i.i,this.curBlockBeginPos.j=i.j;for(var s in this.curBlockArray){var h=this.getPosByIndex(r[s].i,r[s].j),l=this.curBlockArray[s];if(l.row>=0&&l.row<this.ROW&&l.col>=0&&l.col<this.COL&&this.blocks[l.row][l.col]==l)return!0;l.x=h.x,l.y=h.y,l.row=r[s].i,l.col=r[s].j,l.row>=0&&0==l.visible&&(l.visible=!0)}return!e||this.isReceiver||this.isAI||ZJ.AudioManager.Instance.play("move",1,.5),!0}return!1},e.prototype.moveLeft=function(){this.isPlay&&!this.isOver&&(this.moveTetris(Dir.left),this.setTetrisShadow(),this.dispatchEvent(new egret.Event(EventName.MOVE_LEFT,!1,!1,null)))},e.prototype.moveRight=function(){this.isPlay&&!this.isOver&&(this.moveTetris(Dir.right),this.setTetrisShadow(),this.dispatchEvent(new egret.Event(EventName.MOVE_RIGHT,!1,!1,null)))},e.prototype.moveDown=function(t){void 0===t&&(t=!0),this.isPlay&&!this.isOver&&(this.isMoveFastDown&&console.log("moveFastDown"),this.moveTetris(Dir.down,t)?this.setTetrisShadow():this.moveEndEvent(),this.dispatchEvent(new egret.Event(EventName.MOVE_DOWN,!1,!1,null)))},e.prototype.rotateOnce=function(){this.isPlay&&!this.isOver&&this.rotate()&&(this.setTetrisShadow(),this.dispatchEvent(new egret.Event(EventName.ROTATE,!1,!1,null)))},e.prototype.moveFastDown=function(){if(!this.isOver&&this.isPlay){this.isMoveFastDown=!0;for(var t=0;t<this.curBlockArray.length;t++){var e=this.curBlockArray[t],i=this.shadowBlocks[t];e.row=i.row,e.col=i.col,e.x=i.x,e.y=i.y,e.visible||(e.visible=!0)}for(var n=0,o=this.shadowBlocks;n<o.length;n++){var i=o[n];i.visible=!1}this.moveEndEvent(),this.isMoveFastDown=!1,this.dispatchEvent(new egret.Event(EventName.MOVE_FAST_DOWN,!1,!1,null))}},e.prototype.rotate=function(){if(!this.isOver&&this.isPlay){this.isReceiver||this.isAI||ZJ.AudioManager.Instance.play("rotate",1,.5);var t=this.curBlockState+1;t>=this.tetrisInfo[this.curBlockTetrisType].info.length&&(t=0);for(var e=this.tetrisInfo[this.curBlockTetrisType].info[t],i=!0,n=[],o=0;o<e.length&&i;o++)for(var r=0;r<e[o].length;r++)if(1==e[o][r]){var s=new Pos(this.curBlockBeginPos.i+o,this.curBlockBeginPos.j+r);
if(!(s.i<this.ROW&&s.j>=0&&s.j<this.COL)||s.i>=0&&null!=this.blocks[s.i][s.j]){i=!1;break}n.push(s)}if(!i){for(var a=0,h=0,l=!1,o=0;o<e.length;o++)for(var r=0;r<e[o].length;r++)if(1==e[o][r]){var s=new Pos(this.curBlockBeginPos.i+o,this.curBlockBeginPos.j+r);if(s.i>this.ROW-1){var c=s.i-(this.ROW-1);h=c>h?c:h,l=!0}if(s.j<0){var c=s.j-0;a=a>c?c:a,l=!0}else if(s.j>this.COL-1){var c=s.j-(this.COL-1);a=c>a?c:a,l=!0}}if(l){var u=this.curBlockBeginPos.i-h,d=this.curBlockBeginPos.j-a;i=!0,n.length=0;for(var o=0;o<e.length&&i;o++)for(var r=0;r<e[o].length;r++)if(1==e[o][r]){var s=new Pos(u+o,d+r);if(!(s.i<this.ROW&&s.j>=0&&s.j<this.COL)||s.i>=0&&null!=this.blocks[s.i][s.j]){i=!1;break}n.push(s)}i&&(this.curBlockBeginPos.i=u,this.curBlockBeginPos.j=d)}}if(i){for(var o in this.curBlockArray){var s=this.getPosByIndex(n[o].i,n[o].j),p=this.curBlockArray[o];p.x=s.x,p.y=s.y,p.row=n[o].i,p.col=n[o].j,p.row<0&&p.visible?p.visible=!1:p.row>=0&&!p.visible&&(p.visible=!0)}return this.curBlockState=t,!0}return!1}},e.prototype.setTetrisShadow=function(){var t=this.getNearPushPos(this.curBlockTetrisType,this.curBlockState,this.curBlockBeginPos);if(null==t||t.i==this.curBlockBeginPos.i&&t.j==this.curBlockBeginPos.j)for(var e=0;e<this.shadowBlocks.length;e++)this.shadowBlocks[e].visible=!1;else{for(var i=this.getTetrisInfo(this.curBlockTetrisType,this.curBlockState),n=0,o=0;o<i.length;o++)for(var r=0;r<i[o].length;r++)if(1==i[o][r]){n++;var s=this.getPosByIndex(t.i+o,t.j+r),a=void 0;this.shadowBlocks.length>=n?a=this.shadowBlocks[n-1]:(a=new Block,a.width=this.BLOCK_WIDTH,a.height=this.BLOCK_HEIGHT,a.name="shadowBlock",this.shadowBlocks.push(a),this.addChild(a),a.img.source="block_Shadow_png"),a.visible=!0,a.x=s.x,a.y=s.y,a.row=t.i+o,a.col=t.j+r}for(var e=0;e<this.shadowBlocks.length;e++)if(e>=n)this.shadowBlocks[e].visible=!1;else for(var a=this.shadowBlocks[e],h=0;h<this.curBlockArray.length;h++){var l=this.curBlockArray[h];if(l.row==a.row&&l.col==a.col){a.visible=!1;break}}}this.isAI||this.isReceiver},e.prototype.clearData=function(){this.clear_row=0,this.use_time=0;for(var t=0;t<this.blocks.length;t++)for(var e=0;e<this.blocks[t].length;e++){var i=this.blocks[t][e];null!=i&&(this.removeChild(i),this.blocks[t][e]=null)}for(var t=0;t<this.curBlockArray.length;t++){var i=this.curBlockArray[t];null!=i&&this.removeChild(i)}this.curBlockArray=[];for(var t=0;t<this.shadowBlocks.length;t++)this.shadowBlocks[t].visible=!1;for(var t=0;t<this.nextBlockArray.length;t++)this.nextBlockArray[t].visible=!1;for(var t=0;t<this.doubleNextBlockArray.length;t++)this.doubleNextBlockArray[t].visible=!1;this.cmdArray.length=0,this.randomNumArray=[],this.isOver=!1,this.addSpeedCount=0,this.time=0,this.timeOnEnterFrame=egret.getTimer(),this.curRanIndex=-1,this.curRanCount=0,this.isDoMoveEndEvent=!1,this.isMoveFastDown=!1,this.interval=this.DEF_INTERVAL,this.combo=-1,this.hasTouchDown=!1,this.hasReadySpeed=!1,this.speedLevel=1},e.prototype.onInterval=function(){this.isPlay&&!this.isOver&&this.moveDown(!1)},e.prototype.moveEndEvent=function(){var t=this;if(!this.isOver&&this.isPlay){this.isDoMoveEndEvent=!0;for(var e=0,i=this.curBlockArray;e<i.length;e++){var n=i[e];n.row>=0&&n.row<this.ROW&&n.col>=0&&n.col<this.COL?null==this.blocks[n.row][n.col]?this.blocks[n.row][n.col]=n:this.removeChild(n):(this.isOver=!0,this.overGame()),this.playLuodiAnim(n),this.isReceiver||this.isAI||ZJ.AudioManager.Instance.play("fall",1,.2)}for(var o=new Array,r=this.ROW-1;r>=0;r--){for(var s=!0,a=this.blocks[r],h=0;h<this.COL;h++)if(null==a[h]){s=!1;break}s&&(o.push(r),this.clearUp(r))}var l=0;this.isReceiver||this.isAI||(this.isPlay=!1),o.length>0&&(l=this.playClearUpAnim(o)),this.isReceiver?this.fillEmptyRow(o):setTimeout(function(){t.fillEmptyRow(o)},l)}},e.prototype.playLuodiAnim=function(t){var e=this;if(!this.isAI&&!this.isReceiver){var i=new eui.Image;i.source="block_light_png",i.x=t.x,i.y=t.y,i.anchorOffsetX=7,i.anchorOffsetY=8,this.addChild(i),egret.Tween.get(i).to({alpha:0},200,egret.Ease.circIn).call(function(){e.removeChild(i)});var n=t.x+t.width/2,o=t.y+t.height,r=new egret.MovieClip(this.luodiFactory.generateMovieClipData("luodi"));r.addEventListener(egret.MovieClipEvent.FRAME_LABEL,function(t){"@end"==t.frameLabel&&e.removeChild(r)},this),this.addChild(r),r.x=n,r.y=o,r.play(1)}},e.prototype.playClearUpAnim=function(t){var e=this;if(!this.isAI&&!this.isReceiver){var i=300;return ZJ.ResManager.instance.loadMovieClip("xiaochu","xiaochu",function(i,n){for(var o=function(i){var o=t[i],r=e.getPosByIndex(o,0).y+e.BLOCK_HEIGHT/2,s=new egret.MovieClip(n.generateMovieClipData("xiaochu"));s.addEventListener(egret.MovieClipEvent.FRAME_LABEL,function(t){"@end"==t.frameLabel&&e.removeChild(s)},e),e.addChild(s),e.setChildIndex(s,e.numChildren-1),s.x=e.width/2,s.y=r,s.scaleX=2,s.scaleY=2,s.visible=!1,s.frameRate=12,s.visible=!0,s.gotoAndPlay(1)},r=0;r<t.length;r++)o(r)}),i}},e.prototype.addObsBlock=function(t){var e=this;if(!this.isOver){if(this.isDoMoveEndEvent)return void setTimeout(function(){e.addObsBlock(t)},300);this.isReceiver||this.isAI||ZJ.AudioManager.Instance.play("addObs");for(var i=!1,n=0;n<this.ROW;n++)for(var o=this.blocks[n],r=0;r<o.length;r++){var s=this.blocks[n][r];if(null!=s){s.row-=t,s.row>=0?this.blocks[s.row][r]=s:(s.visible=!1,i=!0),this.blocks[n][r]=null;var a=this.getPosByIndex(s.row,r);s.x=a.x,s.y=a.y}}for(var h=ZJ.MathUtil.randomSeed(ZJ.Util.timeStamp()),l=0;t>l;l++){var n=this.ROW-1-l;h=ZJ.MathUtil.randomSeed(h);for(var c=ZJ.MathUtil.randomRange(0,this.COL,h),r=0;r<this.COL;r++)if(r!=c){var s=new Block;this.addChild(s),s.img.source="block_obstacle_png",s.width=this.BLOCK_WIDTH,s.height=this.BLOCK_HEIGHT,s.name="block_obs",s.row=n,s.col=r;var a=this.getPosByIndex(n,r);s.x=a.x,s.y=a.y,s.tetrisType=-10,this.blocks[n][r]=s}}this.setTetrisShadow(),this.checkBgm(),i&&this.overGame(),this.dispatchEvent(new egret.Event(EventName.ADD_OBS_BLOCK,!1,!1,t))}},e.prototype.clearUp=function(t){this.clear_row++;for(var e=0;e<this.COL;e++){var i=this.blocks[t][e];null!=i&&(this.removeChild(i),this.blocks[t][e]=null)}},e.prototype.fillEmptyRow=function(t){if(t.length>0){for(var e=t[0],i=e-1;i>=0;i--)if(-1==t.indexOf(i)){for(var n=this.blocks[i],o=0;o<this.COL;o++){var r=n[o];null!=r&&(r.y=this.getPosByIndex(e,o).y,this.blocks[e][o]=r,r.row=e,n[o]=null)}e--}if(t.length>=3){if(this.combo++,this.dispatchEvent(new egret.Event(EventName.SPECIAL_X,!1,!1,{uprow:t.length+this.combo,combo:this.combo})),this.isReceiver||this.isAI||ZJ.AudioManager.Instance.play("specialX"),this.combo>=1&&!this.isReceiver&&!this.isAI){var o=this.combo;o>3&&(o=3),ZJ.AudioManager.Instance.play("combo"+o)}}else this.combo=-1,this.isReceiver||this.isAI||ZJ.AudioManager.Instance.play("normalX",1,.5)}else this.combo=-1;this.checkBgm(),this.createRandomTetris(),this.isGameOver()?this.overGame():(this.time=this.interval,this.isPlay=!0),this.isDoMoveEndEvent=!1,this.dispatchEvent(new egret.Event(EventName.MOVE_END_EVENT,!1,!1,{data:this.getCurData(),clearRow:this.clear_row}))},e.prototype.getNearPushPos=function(t,e,i){for(var n=this.getTetrisInfo(t,e),o=[],r=0;4>r;r++)for(var s=n.length-1;s>=0;s--)if(1==n[s][r]){o.push(new Pos(s,r));break}for(var a=[],h=0,l=o;h<l.length;h++){var c=l[h],u=i.j+c.j;if(u>=0&&u<this.COL)for(var s=i.i+c.i+1;s<=this.ROW;s++)if(s==this.ROW||s>=0&&null!=this.blocks[s][u]){for(var d=new Pos(s-1-c.i,u-c.j),p=!0,v=0;v<n.length&&p;v++)for(var f=0;f<n[v].length;f++)if(1==n[v][f]){var g=new Pos(d.i+v,d.j+f);if(g.i<0||g.i>=this.ROW||g.j<0||g.j>=this.COL||g.i>=0&&null!=this.blocks[g.i][g.j]){p=!1;break}}!p||d.i==i.i&&d.j==i.j||a.push(d);break}}var y;if(a.length>0)for(var m=0,E=a;m<E.length;m++){var c=E[m];null==y?y=new Pos(c.i,c.j):c.i<y.i&&(y.i=c.i,y.j=c.j)}return y},e.prototype.getFitAIPos=function(){if(this.isPlay&&!this.isOver){for(var t=this.curBlockTetrisType,e=this.curBlockState,i=[],n=0,o=0;o<this.tetrisInfo[t].info.length;o++){e>=this.tetrisInfo[t].info.length&&(e=0);for(var r=this.getTetrisInfo(t,e),s=1-r[0].length;s<=this.COL-1;s++){var a=new Pos(this.curBlockBeginPos.i,s),h=this.getNearPushPos(t,e,a),l=void 0;if(null!=h){l=h.j<this.bornBeginPos.j?100*Math.abs(s-this.bornBeginPos.j)+10+n:100*Math.abs(s-this.bornBeginPos.j)+n;var c=this.calAIScore(h,r);i.push({pos:h,score:c,rotate:n,priority:l})}}e++,n++}i.sort(function(t,e){return t.score>e.score?-1:t.score<e.score?1:t.priority>e.priority?-1:t.priority<e.priority?1:0});var u=this.AIWrongProArray[this.curAILevel-1],d=ZJ.MathUtil.randomRange(0,101),p=0;u>d&&(p=ZJ.MathUtil.randomRange(1,3),p>=i.length&&(p=i.length-1));var v;return p>=0&&p<i.length&&(v=i[p]),v}},e.prototype.setFitAIPos=function(t){var e=this,i=t.pos,n=t.rotate,o=i.j-this.curBlockBeginPos.j,r=this.addSpeedCount;1==this.curAILevel&&(r=0);var s=this.AIRotateIntervalTimeArray[this.curAILevel-1]-10*r,a=this.AIMoveIntervalTimeArray[this.curAILevel-1]-10*r,h=this.AIReadyRotateTimeArray[this.curAILevel-1]-25*r,l=this.AIMoveIntervalTimeArray[this.curAILevel-1]-25*r,c=this.AIReadyMoveFastDownTimeArray[this.curAILevel-1]-20*r;40>s&&(s=40),40>a&&(a=40),80>h&&(h=80),80>l&&(l=80),80>c&&(c=80);for(var u=h,d=0;d<this.AIRotateIdArray.length;d++)clearTimeout(this.AIRotateIdArray[d]);for(var d=0;d<this.AIMoveIdArray.length;d++)clearTimeout(this.AIMoveIdArray[d]);clearTimeout(this.AIMoveFastDownId),this.AIRotateIdArray.length=0,this.AIMoveIdArray.length=0;for(var d=0;n>d;d++)this.AIRotateIdArray.push(setTimeout(function(){e.rotateOnce()},u)),u+=s;u+=l;for(var d=0;d<Math.abs(o);d++)this.AIMoveIdArray.push(setTimeout(function(){o>0?e.moveRight():0>o&&e.moveLeft()},u)),u+=a;u+=c,this.AIMoveFastDownId=setTimeout(function(){e.moveFastDown()},u)},e.prototype.calAIScore=function(t,e){for(var i=new Array,n=0;n<this.ROW;n++){i[n]=new Array;for(var o=0;o<this.COL;o++)null!=this.blocks[n][o]?i[n][o]=1:i[n][o]=0}for(var r=[],s=0;s<e.length;s++)for(var a=0;a<e[s].length;a++)1==e[s][a]&&(i[t.i+s][t.j+a]=1,r.push(new Pos(t.i+s,t.j+a)));var h=this.getLandingHeight(t),l=this.getErodedPieceCellsMetric(i,r),c=this.getBoardRowTransition(i),u=this.getBoardColTransition(i),d=this.getBoardBuriedHoles(i),p=this.getBoardWells(i);return-1*h+l+-1*c+-1*u+-4*d+-1*p},e.prototype.getLandingHeight=function(t){return this.ROW-1-t.i},e.prototype.getErodedPieceCellsMetric=function(t,e){for(var i=0,n=0,o=[],r=0;r<t.length;r++){for(var s=!0,a=0;a<t[r].length;a++)if(0==t[r][a]){s=!1;break}s&&o.push(r)}for(var h=0,l=e;h<l.length;h++){var c=l[h];-1!=o.indexOf(c.i)&&n++}return i*n},e.prototype.getBoardRowTransition=function(t){for(var e=0,i=0;i<t.length;i++)for(var n=t[i],o=0;o<n.length;o++)0==o?0==n[o]&&e++:o==n.length-1?0==n[o]&&e++:(0==n[o]&&1==n[o+1]&&e++,1==n[o]&&0==n[o+1]&&e++);return e},e.prototype.getBoardColTransition=function(t){for(var e=0,i=0;i<this.COL;i++)for(var n=0;n<this.ROW;n++)0==n?0==t[n][i]&&e++:n==t.length-1?0==t[n][i]&&e++:(0==t[n][i]&&1==t[n+1][i]&&e++,1==t[n][i]&&0==t[n+1][i]&&e++);return e},e.prototype.getBoardBuriedHoles=function(t){for(var e=0,i=0;i<t.length;i++)for(var n=0;n<this.ROW;n++)if(1==t[n][i]){for(;++n<this.ROW;)0==t[n][i]&&e++;break}return e},e.prototype.getBoardWells=function(t){for(var e=0,i=0;i<this.COL;i++)for(var n=0;n<this.ROW;n++)if(0==i){if(0==t[n][i]&&1==t[n][i+1]){for(var o=n,r=o;++n<this.ROW&&0==t[n][i]&&1==t[n][i+1];)r=n;for(var s=r-o+1;s>1;)e+=s*(s-1),s--}}else if(i==this.COL-1){if(0==t[n][i]&&1==t[n][i-1]){for(var o=n,r=o;++n<this.ROW&&0==t[n][i]&&1==t[n][i-1];)r=n;for(var s=r-o+1;s>1;)e+=s*(s-1),s--}}else if(0==t[n][i]&&1==t[n][i-1]&&1==t[n][i+1]){for(var o=n,r=o;++n<this.ROW&&0==t[n][i]&&1==t[n][i-1]&&1==t[n][i+1];)r=n;for(var s=r-o+1;s>1;)e+=s*(s-1),s--}return e},e.prototype.speedReadyEvent=function(){!this.hasReadySpeed&&this.interval>this.MIN_INTERVAL&&(this.hasReadySpeed=!0,this.dispatchEvent(new egret.Event(EventName.SPEED_READY)))},e.prototype.AIDoSomething=function(){var t=this.getFitAIPos();null!=t&&this.setFitAIPos(t)},e.prototype.checkBgm=function(){if(!this.isReceiver&&!this.isAI&&!this.isOver){for(var t=!1,e=0;6>e&&!t;e++)for(var i=0;i<this.COL;i++)if(null!=this.blocks[e][i]){t=!0;break}t?"danger"!=ZJ.AudioManager.Instance.bgm&&(ZJ.AudioManager.Instance.stopBgm(),ZJ.AudioManager.Instance.bgm="danger",ZJ.AudioManager.Instance.playBgm()):"bgm"!=ZJ.AudioManager.Instance.bgm&&(ZJ.AudioManager.Instance.stopBgm(),ZJ.AudioManager.Instance.bgm="bgm",ZJ.AudioManager.Instance.playBgm())}},e.prototype.getCurData=function(){for(var t=new Array,e=0;e<this.ROW;e++){t[e]=new Array;for(var i=0;i<this.COL;i++)null==this.blocks[e][i]?t[e][i]=-1:t[e][i]=this.blocks[e][i].tetrisType}var n={};return n.blockDatas=t,n},e.prototype.checkDataSame=function(t){for(var e=this.getCurData(),i=t.blockDatas,n=e.blockDatas,o=0;o<this.ROW;o++)for(var r=0;r<this.COL;r++)if(i[o][r]!=n[o][r])return!1;return!0},e.prototype.setDatas=function(t){for(var e=0;e<this.curBlockArray.length;e++)this.removeChild(this.curBlockArray[e]);this.curBlockArray.length=0;for(var i=t.blockDatas,n=0;n<this.ROW;n++)for(var o=0;o<this.COL;o++){var r=this.blocks[n][o],s=i[n][o];if(-1==s)null!=r&&(this.removeChild(r),this.blocks[n][o]=null);else{if(null==r){r=new Block,r.width=this.BLOCK_WIDTH,r.height=this.BLOCK_HEIGHT,r.row=n,r.col=o,this.addChild(r);var a=this.getPosByIndex(n,o);r.x=a.x,r.y=a.y,this.blocks[n][o]=r}-10==s?r.img.source="block_obstacle_png":r.img.source=this.TETRIS_NAMES[s]+"_png",r.tetrisType=s}}this.createRandomTetris()},e.prototype.rePlay=function(){this.clearData();for(var t=0;3>t;t++)this.randomNumArray.push(this.getRandomNumByRule());this.isPlay=!0},e.prototype.startPlay=function(){for(var t=0;3>t;t++)this.randomNumArray.push(this.getRandomNumByRule());this.isPlay=!0},e.prototype.isGameOver=function(){for(var t=0,e=this.curBlockArray;t<e.length;t++){var i=e[t];if(i.row>=0&&i.row<this.ROW&&i.col>=0&&i.col<this.COL&&null!=this.blocks[i.row][i.col])return!0}return!1},e.prototype.overGame=function(){this.isOver=!0,this.dispatchEvent(new egret.Event(EventName.GAME_OVER))},e.prototype.getPosByIndex=function(t,e){return{x:e*this.BLOCK_WIDTH,y:t*this.BLOCK_HEIGHT}},e.prototype.getCenterPosByIndex=function(t,e){var i=new Pos(-(this.ROW-1)/2*this.BLOCK_HEIGHT,-(this.COL-1)/2*this.BLOCK_WIDTH);return{x:i.j+e*this.BLOCK_WIDTH,y:i.i+t*this.BLOCK_HEIGHT}},e.prototype.getIntervalTime=function(){return this.interval},e.prototype.setAI=function(t){this.isAI=t},e.prototype.setAILevel=function(t){1>t?t=1:t>3&&(t=3),this.curAILevel=t},e.prototype.setReceiver=function(t){this.isReceiver=t},e.prototype.pushCmd=function(t,e){var i={cmd:t,data:e};this.cmdArray.push(i)},e.prototype.destroy=function(){},e}(eui.Component);__reflect(Tetris.prototype,"Tetris",["eui.UIComponent","egret.DisplayObject"]);var Pos=function(){function t(t,e){this.i=t,this.j=e}return t}();__reflect(Pos.prototype,"Pos");var TetrisInfo=function(){function t(t){this.info=t}return t}();__reflect(TetrisInfo.prototype,"TetrisInfo");var ZJ;!function(t){var e=function(t){function e(e,i,n,o){var r=t.call(this,e,i,n,o)||this;return r.data=null,r}return __extends(e,t),e}(egret.Event);t.ChannelDataEvent=e,__reflect(e.prototype,"ZJ.ChannelDataEvent")}(ZJ||(ZJ={}));var ZJ;!function(t){var e=function(){function t(){}return t.FRAME=30,t.UP=0,t.DOWN=1,t.LEFT=2,t.RIGHT=3,t}();t.CommonConfig=e,__reflect(e.prototype,"ZJ.CommonConfig");var i=function(){function t(){}return t.TABLE_LOADED="TABLE_LOADED",t.SOCKET_CONNECTED="SOCKET_CONNECTED",t.SOCKET_DATA="SOCKET_DATA",t.GESTURE_DIRECT="GESTURE_DIRECT",t.CHANNEL_DATA="CHANNEL_DATA",t}();t.CommonEventName=i,__reflect(i.prototype,"ZJ.CommonEventName")}(ZJ||(ZJ={}));var MatchView=function(t){function e(){var e=t.call(this)||this;return e.skinName="MatchViewSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.idInput.textDisplay.size=80,this.idInput.textDisplay.textAlign="center",this.idInput.textDisplay.verticalAlign="middle",this.idInput.textDisplay.left=0,this.idInput.textDisplay.right=0,this.idInput.textDisplay.top=0,this.idInput.textDisplay.bottom=0,this.matchInput.textDisplay.size=80,this.matchInput.textDisplay.textAlign="center",this.matchInput.textDisplay.verticalAlign="middle",this.matchInput.textDisplay.left=0,this.matchInput.textDisplay.right=0,this.matchInput.textDisplay.top=0,this.matchInput.textDisplay.bottom=0,this.login.addEventListener("touchTap",function(){e.sendLogin(),e.log.text="已点击登录"},this),this.match.addEventListener("touchTap",function(){var t=e.matchInput.text;e.matchRoom(t),e.log.text="已点击匹配"},this),this.ready.addEventListener("touchTap",function(){e.readyGame(),e.log.text="已点击准备"},this),this.a10010.addEventListener("touchTap",function(){ZJ.SocketManager.instance.send(11010,{processData:ZJ.Util.objToByteArray("11010的数据").bytes}),e.log.text="已点击发送11010"},this),this.a10011.addEventListener("touchTap",function(){ZJ.SocketManager.instance.send(11011,{resultData:ZJ.Util.objToByteArray("11011的数据").bytes}),e.log.text="已点击发送11011"},this),this.log=new eui.Label,this.log.horizontalCenter=450,this.log.verticalCenter=-200,this.log.textAlign="center",this.log.verticalAlign="middle",this.addChild(this.log)},e.prototype.sendLogin=function(){ModuleConfig.compile.danji||ZJ.SocketManager.instance.send(11e3,{openId:this.idInput.text,nickname:yyGameConfig.nickname,avatarUrl:yyGameConfig.avatarUrl,timestamp:yyGameConfig.timestamp,sign:yyGameConfig.sign})},e.prototype.matchRoom=function(t){ZJ.SocketManager.instance.send(11001,{matchId:t})},e.prototype.readyGame=function(){ZJ.SocketManager.instance.send(11002,{})},e}(ZJ.ViewBase);__reflect(MatchView.prototype,"MatchView");var AliLoadingView=function(t){function e(){var e=t.call(this)||this;return e.intervalID=0,e.ran1=0,e.ran2=0,e.SEND_PROGRESS=6,e.progressIndex=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);var e=ZJ.ShapeUtil.getRect(0,1,this.stage.stageWidth,this.stage.stageHeight);this.addChild(e);var i=500,n=new eui.ProgressBar;n.skinName="YYLoadingPBSkin",this.progress=n,this.progress.width=450,this.progress.height=62,this.progress.minimum=0,this.progress.maximum=100,this.progress.horizontalCenter=0,this.progress.y=i+435,this.progress.scaleX=1.3,this.progress.scaleY=1.3,this.progress.labelFunction=function(t,e){return t+"%"},this.addChild(this.progress);var o=new eui.Image;o.source="load_img03_png",o.horizontalCenter=0,o.y=i+630,o.width=510,o.height=100,o.alpha=.2,this.addChild(o),this.load3=new eui.Label,this.load3.text="等待对手加入游戏...",this.load3.horizontalCenter=0,this.load3.y=i+660,this.load3.size=40,this.load3.textColor=16777215,this.addChild(this.load3),this.startCount(),ZJ.SocketManager.instance.connectByUrlAli({ip:ModuleConfig.ip,port:ModuleConfig.port})},e.prototype.startCount=function(){var t=this;this.intervalID=setInterval(function(){t.ran2=Math.min(t.ran2+8*Math.random()+2,99),t.progress.value=Math.floor((t.ran1+t.ran2)/2)},200)},e.prototype.onProgress=function(t,e){this.ran1=Math.floor(t/e*100);var i=Math.floor(t/e*100);100==i?ALISDK.CatcherSDK.instance().updateProgress(ALISDK.CatcherSDK.ProgressState.COMPLETED,i):(this.progressIndex==this.SEND_PROGRESS-1&&ALISDK.CatcherSDK.instance().updateProgress(ALISDK.CatcherSDK.ProgressState.PROGRESSING,i),this.progressIndex=++this.progressIndex%this.SEND_PROGRESS)},e.prototype.onDestroy=function(){return t.prototype.onDestroy.call(this),0},e}(ZJ.ViewBase);__reflect(AliLoadingView.prototype,"AliLoadingView");var YYLoadingView=function(t){function e(){var e=t.call(this)||this;return e.intervalID=0,e.ran1=0,e.ran2=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);var e=ZJ.ShapeUtil.getRect(0,1,this.stage.stageWidth,this.stage.stageHeight);this.addChild(e);var i=500,n=new eui.ProgressBar;n.skinName="YYLoadingPBSkin",this.progress=n,this.progress.width=450,this.progress.height=62,this.progress.minimum=0,this.progress.maximum=100,this.progress.horizontalCenter=0,this.progress.y=i+435,this.progress.scaleX=1.3,this.progress.scaleY=1.3,this.progress.labelFunction=function(t,e){return t+"%"},this.addChild(this.progress);var o=new eui.Image;o.source="load_img03_png",o.horizontalCenter=0,o.y=i+630,o.width=510,o.height=100,o.alpha=.2,this.addChild(o),this.load3=new eui.Label,this.load3.text="等待对手加入游戏...",this.load3.horizontalCenter=0,this.load3.y=i+660,this.load3.size=40,this.load3.textColor=16777215,this.addChild(this.load3),this.startCount()},e.prototype.startCount=function(){var t=this;this.intervalID=setInterval(function(){t.ran2=Math.min(t.ran2+8*Math.random()+2,99),t.progress.value=Math.floor((t.ran1+t.ran2)/2)},200)},e.prototype.onProgress=function(t,e){this.ran1=Math.floor(t/e*100),this.progress.value=Math.floor((this.ran1+this.ran2)/2)},e.prototype.onDestroy=function(){return t.prototype.onDestroy.call(this),clearInterval(this.intervalID),0},e}(ZJ.ViewBase);__reflect(YYLoadingView.prototype,"YYLoadingView");var xlsx;!function(t){t.cfg_c_plot="shared/c_plot.json",t.c_plot_id="A",t.c_plot_plot="B",t.c_plot_react="C",t.c_plot_finish="D",t.c_plot_trigger="E",t.cfg_c_role="shared/c_role.json",t.c_role_id="A",t.c_role_role_name="B",t.c_role_head="C",t.c_role_sex="D",t.c_role_relation="E",t.cfg_c_task="shared/c_task.json",t.c_task_id="A",t.c_task_plot="B",t.c_task_trigger="C",t.c_task_param1="D",t.c_task_param2="E",t.c_task_param3="F",t.c_task_param4="G"}(xlsx||(xlsx={}));