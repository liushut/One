var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))(function(n,s){function r(t){try{h(o.next(t))}catch(e){s(e)}}function a(t){try{h(o["throw"](t))}catch(e){s(e)}}function h(t){t.done?n(t.value):new i(function(e){e(t.value)}).then(r,a)}h((o=o.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return o([t,e])}}function o(i){if(n)throw new TypeError("Generator is already executing.");for(;h;)try{if(n=1,s&&(r=s[2&i[0]?"return":i[0]?"throw":"next"])&&!(r=r.call(s,i[1])).done)return r;switch(s=0,r&&(i=[0,r.value]),i[0]){case 0:case 1:r=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,s=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(r=h.trys,!(r=r.length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){h.label=i[1];break}if(6===i[0]&&h.label<r[1]){h.label=r[1],r=i;break}if(r&&h.label<r[2]){h.label=r[2],h.ops.push(i);break}r[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(o){i=[6,o],s=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var n,s,r,a,h={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},ZJ;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.skinName=t.Util.getClassName(i)+"Skin",i}return __extends(i,e),i.prototype.onDestroy=function(){return 0},i}(eui.Component);t.ComponentBase=e,__reflect(e.prototype,"ZJ.ComponentBase",["eui.UIComponent","egret.DisplayObject"])}(ZJ||(ZJ={}));var ZJ;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.setData=function(t){},e.prototype.show=function(){},e.prototype.onProgress=function(t,e){},e.prototype.onDestroy=function(){return t.prototype.onDestroy.call(this)},e}(t.ComponentBase);t.ViewBase=e,__reflect(e.prototype,"ZJ.ViewBase",["RES.PromiseTaskReporter"])}(ZJ||(ZJ={}));var ZJ;!function(t){var e=function(){function t(t,e,i){void 0===e&&(e=0),void 0===i&&(i=null),this.viewName="",this.layer=0,this.viewClass=null,this.viewName=t,this.layer=e,this.viewClass=i}return t}();t.UIData=e,__reflect(e.prototype,"ZJ.UIData")}(ZJ||(ZJ={}));var GameView=function(t){function e(){var e=t.call(this)||this;return e.INTERVAL=50,e.INTERVAL_PING=3e4,e.TOUCH_INTERVAL=180,e.DOUBLE_TAP_INTERVAL=500,e.TOUCH_DESC_INTERVAL=140,e.TOUCH_MIN_INTERVAL=50,e.TOUCH_MIN_DOWNINTERVAL=70,e.TOUCH_MIN_ROTATEINTERVAL=120,e.isTouchLeft=!1,e.isTouchRight=!1,e.isTouchDown=!1,e.isTouchRotate=!1,e.hasTouchMoveLeft=!1,e.hasTouchMoveRight=!1,e.hasTouchMoveDown=!1,e.hasTouchRotate=!1,e.touchLeftTime=0,e.touchRightTime=0,e.touchDownTime=0,e.touchRotateTime=0,e.lastTouchTapTime=0,e.addCount=0,e.timeOnEnterFrame=0,e.texiaoPosArray=[],e.bgmVolume=1,e.bgmAddVolume=.1,e.isMicOpen=!0,e.isAudioOpen=!0,e.isDanji=!1,e.scoreNumber=0,e.topScore=0,e.weekScore=0,e.isClose=!1,e.intervalPing=0,e.skinName="GameViewSkin",e}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.isDanji=ModuleConfig.compile.danji,this.isDanji?(ZJ.AudioManager.Instance.playBgm(0,this.bgmVolume),ZJ.UIManager.instance.destroyView(UIName.Loading)):(ZJ.AudioManager.Instance.isMute=!0,this.connect(),ZJ.UIManager.instance.destroyView(UIName.Loading)),this.score.text="0",this.guideBg.visible=!1,this.guideMask.visible=!1,this.daojishiGroup.verticalCenter=-143,setTimeout(function(){ZJ.ShapeUtil.setArcMask(e.head1,e.head1.width/2,0,1,!0,e.head1.width/2,e.head2.height/2),ZJ.ShapeUtil.setArcMask(e.head2,e.head2.width/2,0,1,!0,e.head2.width/2,e.head2.height/2)},50);for(var i=0;i<this.texiaoPosGroup.numChildren;i++){var o=this.texiaoPosGroup.getChildAt(i);this.texiaoPosArray.push(new ZJ.Vector3(o.horizontalCenter,o.verticalCenter))}this.tetris1=new Tetris,this.tetris1.nextTetrisGroup=this.nextGroup,this.tetris1.doubleNextTetrisGroup=this.doubleNextGroup,this.tetris1Group.addChild(this.tetris1),this.tetris1.x=28,this.tetris1.y=45,this.tetris1.addEventListener(EventName.GAME_OVER,function(){if(ZJ.AudioManager.Instance.play("death"),"danger"==ZJ.AudioManager.Instance.bgm&&ZJ.AudioManager.Instance.stopBgm(),e.isDanji){e.replay.getChildAt(0).source="fail_png",e.replay.getChildAt(1).text="";var t=ZJ.UIManager.instance.openView(UIName.Settle);t.setScore(e.scoreNumber,e.topScore,e.weekScore,0,0)}},this),this.tetris1.addEventListener(EventName.SPEED_READY,function(){e.readySpeedEvent()},this),this.tetris1.addEventListener(EventName.SPEED,function(t){var i=ZJ.AudioManager.Instance.getUniqueChannel("bgm");if(null!=i){var o=i.volume;o+=e.bgmAddVolume,o>1&&(o=1),i.volume=o}e.updateSpeedTip(t.data)},this),this.tetris1.addEventListener(EventName.SPECIAL_X,function(t){t.data.combo>=1&&e.createComboEffect(t.data.combo)},this),this.tetris1.addEventListener(EventName.ADD_SCORE,function(t){var i=t.data;e.scoreNumber=i,e.score.text=i.toString(),e.isDanji||ZJ.SocketManager.instance.send(11011,{score:e.scoreNumber,resultData:null})},this),this.replay.visible=!1,this.replay.addEventListener("touchTap",function(){e.rePlayGame()},this),this.leftBtn.addEventListener("touchBegin",function(t){this.tetris1.moveLeft()},this),this.leftBtn.addEventListener("touchBegin",function(t){this.isTouchLeft=!0,this.leftBtn.icon="left_click_png"},this),this.leftBtn.addEventListener("touchEnd",function(t){this.isTouchLeft=!1,this.touchLeftTime=0,this.addCount=0,this.leftBtn.icon="left_png"},this),this.leftBtn.addEventListener("touchReleaseOutside",function(t){this.isTouchLeft=!1,this.touchLeftTime=0,this.addCount=0,this.leftBtn.icon="left_png"},this),this.rightBtn.addEventListener("touchBegin",function(t){this.tetris1.moveRight()},this),this.rightBtn.addEventListener("touchBegin",function(t){this.isTouchRight=!0,this.rightBtn.icon="right_click_png"},this),this.rightBtn.addEventListener("touchEnd",function(t){this.isTouchRight=!1,this.touchRightTime=0,this.addCount=0,this.rightBtn.icon="right_png"},this),this.rightBtn.addEventListener("touchReleaseOutside",function(t){this.isTouchRight=!1,this.touchRightTime=0,this.addCount=0,this.rightBtn.icon="right_png"},this),this.downBtn.addEventListener("touchBegin",function(t){this.tetris1.moveDown()},this),this.downBtn.addEventListener("touchBegin",function(t){this.isTouchDown=!0,this.downBtn.icon="down_click_png"},this),this.downBtn.addEventListener("touchEnd",function(t){this.tetris1.hasTouchDown=!1,this.isTouchDown&&(this.tetris1.time=0),this.isTouchDown=!1,this.touchDownTime=0,this.addCount=0,this.downBtn.icon="down_png"},this),this.downBtn.addEventListener("touchReleaseOutside",function(t){this.tetris1.hasTouchDown=!1,this.isTouchDown&&(this.tetris1.time=0),this.isTouchDown=!1,this.touchDownTime=0,this.addCount=0,this.downBtn.icon="down_png"},this),this.fallBtn.addEventListener("touchBegin",function(t){this.tetris1.moveFastDown()},this),this.fallBtn.addEventListener("touchBegin",function(t){this.fallBtn.iconDisplay.source="fall_click_png"},this),this.fallBtn.addEventListener("touchEnd",function(t){this.fallBtn.icon="fall_png"},this),this.fallBtn.addEventListener("touchReleaseOutside",function(t){this.fallBtn.icon="fall_png"},this),this.rotateBtn.addEventListener("touchBegin",function(t){this.tetris1.rotateOnce()},this),this.rotateBtn.addEventListener("touchBegin",function(t){this.isTouchRotate=!0,this.rotateBtn.icon="rotate_click_png"},this),this.rotateBtn.addEventListener("touchEnd",function(t){this.isTouchRotate=!1,this.touchRotateTime=0,this.addCount=0,this.rotateBtn.icon="rotate_png"},this),this.rotateBtn.addEventListener("touchReleaseOutside",function(t){this.isTouchRotate=!1,this.touchRotateTime=0,this.addCount=0,this.rotateBtn.icon="rotate_png"},this),this.isDanji||(this.tetris1.addEventListener(EventName.GAME_OVER,function(t){ZJ.SocketManager.instance.send(11012,{winPlayerId:e.player1.playerId})},this),this.exitgame.addEventListener("touchTap",function(t){ModuleConfig.compile.chushou&&ChushouSDK.instance.csExitGame()},this)),this.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this),this.timeOnEnterFrame=egret.getTimer(),this.lastTouchTapTime=-1*this.DOUBLE_TAP_INTERVAL,ZJ.SocketManager.instance.addEventListener(ZJ.CommonEventName.SOCKET_CONNECTED,this.onSocketConnected,this),ZJ.SocketManager.instance.addEventListener(ZJ.CommonEventName.SOCKET_DATA,this.onSocketData,this),ZJ.SocketManager.instance.addEventListener(ZJ.CommonEventName.CHANNEL_DATA,this.onChannelData,this),ZJ.SocketManager.instance.addEventListener(ZJ.CommonEventName.SOCKET_CLOSE,this.onSocketClose,this),this.isDanji?(this.tetris1.seed=ZJ.Util.timeStamp(),this.tetris1.rePlay(),this.countDownToPlay(3)):this.tetris1.isPlay=!1,this.stage.addEventListener(egret.Event.ACTIVATE,function(){if(!e.tetris1.isOver){var t=1;"bgm"==ZJ.AudioManager.Instance.bgm&&(t=e.bgmVolume),ZJ.AudioManager.Instance.playBgm(0,t)}},this),this.stage.addEventListener(egret.Event.DEACTIVATE,function(){ZJ.AudioManager.Instance.stopAll()},this)},e.prototype.onEnterFrame=function(t){var e=egret.getTimer(),i=this.timeOnEnterFrame,o=e-i;if(this.isTouchLeft&&(this.touchLeftTime+=o,this.touchLeftTime>=this.TOUCH_INTERVAL-this.addCount*this.TOUCH_DESC_INTERVAL&&this.touchLeftTime>=this.TOUCH_MIN_INTERVAL)){this.touchLeftTime=0,this.addCount=1;for(var n=0;n<this.addCount;n++)this.tetris1.moveLeft();this.hasTouchMoveLeft=!0}if(this.isTouchRight&&(this.touchRightTime+=o,this.touchRightTime>=this.TOUCH_INTERVAL-this.addCount*this.TOUCH_DESC_INTERVAL&&this.touchRightTime>=this.TOUCH_MIN_INTERVAL)){this.touchRightTime=0,this.addCount=1;for(var n=0;n<this.addCount;n++)this.tetris1.moveRight();this.hasTouchMoveRight=!0}if(this.isTouchDown&&(this.touchDownTime+=o,this.touchDownTime>=this.TOUCH_INTERVAL-this.addCount*this.TOUCH_DESC_INTERVAL&&this.touchDownTime>=this.TOUCH_MIN_DOWNINTERVAL)){this.touchDownTime=0,this.addCount=1;for(var n=0;n<this.addCount;n++)this.tetris1.moveDown();this.hasTouchMoveDown=!0,this.tetris1.hasTouchDown=!0}this.timeOnEnterFrame=egret.getTimer()},e.prototype.playFlyBlock=function(){var t=this;if(null==this.flyParticles){var e=RES.getRes("texiao1_png"),i=RES.getRes("texiao1_json");this.flyParticles=new particle.GravityParticleSystem(e,i);var o=new eui.Group;o.horizontalCenter=0,o.verticalCenter=0,this.addChild(o),o.addChild(this.flyParticles)}var n=new FlyBlock;this.texiaoGroup.addChild(n),n.callBack=function(e){ZJ.ResManager.instance.loadMovieClip("baodian","baodian",function(i,o){i.play(1),n.addChild(i),i.x=e.x,i.y=e.y,i.scaleX=4,i.scaleY=4,i.rotation=-n.rotation,i.addEventListener(egret.MovieClipEvent.FRAME_LABEL,function(t){"@end"==t.frameLabel&&(n.removeChild(i),n.parent.removeChild(n))},t)})},n.play(this.texiaoPosArray,this.flyParticles)},e.prototype.playFlyBlockToSpeedTip=function(){var t=this;if(null==this.flyParticles2){var e=RES.getRes("texiao1_png"),i=RES.getRes("texiao1_json");this.flyParticles2=new particle.GravityParticleSystem(e,i);var o=new eui.Group;o.horizontalCenter=0,o.verticalCenter=0,this.addChild(o),o.addChild(this.flyParticles2)}var n=new FlyBlock;this.texiaoGroup.addChild(n);for(var s=[new ZJ.Vector3(this.speedGroup.horizontalCenter,this.speedGroup.verticalCenter),new ZJ.Vector3(this.speedTipGroup.horizontalCenter,this.speedTipGroup.verticalCenter)],r=0;r<n.rotateArray.length;r++)n.rotateArray[r]=-115;n.callBack=function(e){ZJ.ResManager.instance.loadMovieClip("baodian2","baodian2",function(i,o){i.play(1),n.addChild(i),i.x=e.x,i.y=e.y,i.scaleX=4,i.scaleY=4,i.rotation=-n.rotation,i.addEventListener(egret.MovieClipEvent.FRAME_LABEL,function(t){"@end"==t.frameLabel&&(n.removeChild(i),n.parent.removeChild(n))},t)})},n.play(s,this.flyParticles2,!1)},e.prototype.createComboEffect=function(t){var e=new Combo;e.setCombo(t),e.horizontalCenter=300,e.verticalCenter=280,this.addChild(e),e.show()},e.prototype.rePlayGame=function(){if(this.isDanji||ZJ.SocketManager.instance.send(11008),ZJ.UIManager.instance.destroyView(UIName.Settle),!this.isClose){if(this.score.text="0",this.scoreNumber=0,this.replay.visible=!1,this.tetris1.seed=ZJ.Util.timeStamp(),this.tetris1.rePlay(),"bgm"!=ZJ.AudioManager.Instance.bgm)ZJ.AudioManager.Instance.stopBgm(),ZJ.AudioManager.Instance.bgm="bgm",ZJ.AudioManager.Instance.playBgm(0,this.bgmVolume);else{var t=ZJ.AudioManager.Instance.getUniqueChannel("bgm");t.volume=this.bgmVolume}this.updateSpeedTip(1),this.countDownToPlay(3)}},e.prototype.sendPing=function(){this.isDanji||(this.intervalPing=setInterval(function(){ZJ.SocketManager.instance.send(11004)},this.INTERVAL_PING))},e.prototype.sendLogin=function(){this.isDanji||ZJ.SocketManager.instance.send(1e4,{openId:ChushouSDK.instance.csAuthRequestData.openUid,sign:"sign",timestamp:ZJ.Util.timeStamp(),appId:1234,params:[ChushouSDK.instance.csAuthRequestData.nickname,ChushouSDK.instance.csAuthRequestData.gender,ChushouSDK.instance.csAuthRequestData.avatar]})},e.prototype.connect=function(){if(!this.isDanji){var t=ModuleConfig.ws+"://"+ModuleConfig.ip+":"+ModuleConfig.port;ZJ.SocketManager.instance.connectByUrl(t)}},e.prototype.onSocketConnected=function(){var t=this;ModuleConfig.compile.chushou&&ChushouSDK.instance.csAuthRequest(function(){t.sendPing(),t.sendLogin()})},e.prototype.onSocketClose=function(){this.showConnectCloseTip(),this.isClose=!0},e.prototype.onSocketData=function(t){var e=t.data;if(!ModuleConfig.compile.yy||1==e.result){var i=e.data;switch(e.protoID){case 1e4:this.sendMatch(),this.playerId=i.playerId;break;case 10001:this.sendReady(),ChushouSDK.instance.gameRoomId=i.roomId,ChushouSDK.instance.csJoinRoom();break;case 10010:0==i.result?ChushouSDK.instance.csPayEntryFee(i.cpOrderId,i.cpPropId,i.cpPropName,function(t){"0"==t.code?console.log("成功扣除入场费"):("100"==t.code&&console.log("触手豆余额不足"),console.log(t.code+","+t.errMsg))}):console.log("商品不存在");break;case 11002:0==i.result?console.log("ready success"):(ChushouSDK.instance.csExitGame(),console.log("ready fail"));break;case 11003:this.onCountDown(i);break;case 11008:this.onReceiveScore(i);break;case 11010:this.onReceiveGameData(i);break;case 11011:this.onReceiveCheckData(i);break;case 11012:this.onReceiveWin(i)}}},e.prototype.onChannelData=function(t){var e=t.data.eventName,i=t.data.event;switch(console.log("onChannelData "+e),e){case"CONNECT":break;case"PROGRESS":break;case"READY":this.sendPing(),this.readyGame();break;case"KICK":break;case"GAMEOVER":break;case"BREAK":break;case"CONTINUE":break;case"ERROR":break;case"MIC_CHANGE":this.onMicChange(i);break;case"AUDIO_CHANGE":this.onAudioChange(i)}},e.prototype.readyGame=function(){ZJ.SocketManager.instance.send(11002,{})},e.prototype.sendMatch=function(){ZJ.SocketManager.instance.send(10001,{gameMode:1,matchType:1})},e.prototype.sendReady=function(){ZJ.SocketManager.instance.send(11002)},e.prototype.onCountDown=function(t){console.log("开始倒计时:"+t.readyTime),ZJ.UIManager.instance.destroyView(UIName.Settle),ZJ.SocketManager.instance.send(11008),"bgm"!=ZJ.AudioManager.Instance.bgm&&(ZJ.AudioManager.Instance.stopBgm(),ZJ.AudioManager.Instance.bgm="bgm"),this.replay.visible=!1;for(var e=0;e<t.playerInfos.length;e++)t.playerInfos[e].playerId==this.playerId&&(this.player1=t.playerInfos[e]);this.tetris1.seed=t.seeds[0],this.guideBg.visible=!1,this.guideMask.visible=!1,this.daojishiGroup.verticalCenter=-143,this.tetris1.rePlay(),ModuleConfig.compile.chushou&&(ZJ.AudioManager.Instance.isMute=!1),this.countDownToPlay(3)},e.prototype.onReceiveScore=function(t){this.topScore=t.topScore,this.weekScore=t.weekScore},e.prototype.onReceiveGameData=function(t){},e.prototype.onReceiveCheckData=function(t){},e.prototype.onReceiveWin=function(t){var e=t.result,i=t.winPlayerId,o=t.friendRank,n=t.rank;if(0==e){var s=void 0,r=void 0;if(i==this.playerId?(s="win_png",r=!0):(s="fail_png",r=!1),this.tetris1.isOver=!0,this.replay.visible=!0,this.replay.getChildAt(0).source=s,this.replay.getChildAt(1).text="",ZJ.AudioManager.Instance.stopBgm(),null==ZJ.UIManager.instance.getView(UIName.Settle)){var a=ZJ.UIManager.instance.openView(UIName.Settle);a.setScore(this.scoreNumber,this.topScore,this.scoreNumber>this.weekScore?this.scoreNumber:this.weekScore,o,n)}}else console.log("结果通知返回失败")},e.prototype.onMicChange=function(t){for(var e=t.statusList,i=0;i<e.length;i++){var o=e[i],n=void 0;n=o.openId==this.player1.openId?this.player1:this.player2;var s=o.micStatus;this.updateVoice(n,s)}},e.prototype.onAudioChange=function(t){ZJ.AudioManager.Instance.isMute=!t.audioStatus},e.prototype.updateSex=function(t,e){var i;i=t==this.player1?this.sex1:this.sex2,"1"==e?i.source="boy_png":i.source="girl_png"},e.prototype.updateVoice=function(t,e){var i;i=t==this.player1?this.voice1:this.voice2,1==e?i.source="voice_open_png":i.source="voice_close_png"},e.prototype.countDownToPlay=function(t){var e=this;this.tetris1.isPlay=!1;var i=ZJ.ResManager.instance.loadDragonBones("daojishi");this.daojishiGroup.addChild(i),i.addDBEventListener(dragonBones.EventObject.COMPLETE,function(t){e.guideBg.visible&&(egret.Tween.get(e.guideBg).to({alpha:0},200).call(function(){e.guideBg.visible=!1}),egret.Tween.get(e.guideMask).to({alpha:0},200).call(function(){e.guideMask.visible=!1})),e.tetris1.isPlay=!0,e.tetris1.createRandomTetris(),e.daojishiGroup.removeChild(i)},this),i.animation.play("newAnimation",1)},e.prototype.readySpeedEvent=function(){var t=this,e=ZJ.ResManager.instance.loadDragonBones("sudu");this.speedGroup.addChild(e),e.animation.play("newAnimation",-1),setTimeout(function(){t.playFlyBlockToSpeedTip()},2500),setTimeout(function(){e.animation.stop(),t.speedGroup.removeChild(e)},2500)},e.prototype.updateSpeedTip=function(t){var e=this;if(this.speedTip.text!=t.toString()){var i=new eui.BitmapLabel;i.font=this.speedTip.font,i.scaleX=this.speedTip.scaleX,i.scaleY=this.speedTip.scaleY,i.text=t.toString(),null==this.defSpeedTipTopY&&(this.defSpeedTipTopY=this.speedTip.top),this.speedTipGroup.addChild(i),i.horizontalCenter=this.speedTip.horizontalCenter,i.top=this.defSpeedTipTopY+70,ZJ.ShapeUtil.setRectMask(i,this.speedTip.x-i.width/2,this.defSpeedTipTopY,3*i.width,1.5*i.height),ZJ.ShapeUtil.setRectMask(this.speedTip,this.speedTip.x,this.defSpeedTipTopY-.25*this.speedTip.height,1.5*this.speedTip.width,1.5*this.speedTip.height),egret.Tween.get(i).to({top:this.defSpeedTipTopY},400),egret.Tween.get(this.speedTip).to({top:this.defSpeedTipTopY-70},400).call(function(){e.speedTipGroup.removeChild(e.speedTip.mask),e.speedTipGroup.removeChild(e.speedTip),e.speedTip=i})}},e.prototype.updateAudio=function(t){t?this.audio.source="vol_open_png":this.audio.source="vol_close_png"},e.prototype.showConnectCloseTip=function(){this.connectGroup.visible=!0,this.tetris1.isPlay=!1},e.prototype.onDestroy=function(){return clearInterval(this.intervalPing),this.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this),ZJ.SocketManager.instance.removeEventListener(ZJ.CommonEventName.SOCKET_CONNECTED,this.onSocketConnected,this),ZJ.SocketManager.instance.removeEventListener(ZJ.CommonEventName.SOCKET_DATA,this.onSocketData,this),ZJ.SocketManager.instance.removeEventListener(ZJ.CommonEventName.SOCKET_CLOSE,this.onSocketClose,this),ZJ.SocketManager.instance.removeEventListener(ZJ.CommonEventName.CHANNEL_DATA,this.onChannelData,this),0},e}(ZJ.ViewBase);__reflect(GameView.prototype,"GameView");var LoadingView=function(t){function e(){var e=t.call(this)||this;return e.intervalID=0,e.ran1=0,e.ran2=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);var e=ZJ.ShapeUtil.getRect(0,1,this.stage.stageWidth,this.stage.stageHeight);this.addChild(e);var i=500,o=new eui.ProgressBar;o.skinName="YYLoadingPBSkin",this.progress=o,this.progress.width=450,this.progress.height=62,this.progress.minimum=0,this.progress.maximum=100,this.progress.horizontalCenter=0,this.progress.y=i+435,this.progress.scaleX=1.3,this.progress.scaleY=1.3,this.progress.labelFunction=function(t,e){return t+"%"},this.addChild(this.progress);var n=new eui.Image;n.source="load_img03_png",n.horizontalCenter=0,n.y=i+630,n.width=510,n.height=100,n.alpha=.2,this.addChild(n),this.load3=new eui.Label,this.load3.text="正在加载游戏...",this.load3.horizontalCenter=0,this.load3.y=i+660,this.load3.size=40,this.load3.textColor=16777215,this.addChild(this.load3),this.startCount()},e.prototype.startCount=function(){var t=this;this.intervalID=setInterval(function(){t.ran2=Math.min(t.ran2+8*Math.random()+2,99),t.progress.value=Math.floor((t.ran1+t.ran2)/2)},200)},e.prototype.onProgress=function(t,e){this.ran1=Math.floor(t/e*100),this.progress.value=Math.floor((this.ran1+this.ran2)/2)},e.prototype.onDestroy=function(){return t.prototype.onDestroy.call(this),clearInterval(this.intervalID),0},e}(ZJ.ViewBase);__reflect(LoadingView.prototype,"LoadingView");var SettleView=function(t){function e(){var e=t.call(this)||this;return e.skinName="SettleViewSkin",e}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.timeOnEnterFrame=egret.getTimer(),this.rankbg.addEventListener("touchTap",function(t){ModuleConfig.compile.chushou&&ChushouSDK.instance.csExitGame()},this),this.replay.addEventListener("touchTap",function(t){ModuleConfig.compile.danji||ZJ.SocketManager.instance.send(11007);var e=ZJ.UIManager.instance.getView(UIName.Game);e.rePlayGame()},this),this.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this)},e.prototype.onEnterFrame=function(t){var e=egret.getTimer(),i=this.timeOnEnterFrame,o=e-i;this.light.rotation+=o/1e3*90,this.timeOnEnterFrame=e},e.prototype.setScore=function(t,e,i,o,n){this.curscore.text=t.toString(),this.weekscore.text=i.toString(),this.friendrank.text=o.toString(),this.rank.text=n.toString()},e.prototype.onDestroy=function(){return this.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this),0},e}(ZJ.ViewBase);__reflect(SettleView.prototype,"SettleView");var ZJ;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.INTERVAL=60,i.DISTANCE=20,i.pastTime=0,i.lastPos=new t.Vector3,i.nowPos=new t.Vector3,i.isBegin=!1,i.intervalID=0,i}return __extends(i,e),i.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},i.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),this.layer.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.layer.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.layer.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.intervalID=setInterval(function(){t.onInterval()},this.INTERVAL)},i.prototype.onInterval=function(){if(this.isBegin){var e=this.nowPos.x-this.lastPos.x,i=this.nowPos.y-this.lastPos.y,o=Math.abs(e),n=Math.abs(i),s={};if(o>n?o>this.DISTANCE&&(e>0?s.direct=t.CommonConfig.RIGHT:s.direct=t.CommonConfig.LEFT,this.isBegin=!1):n>this.DISTANCE&&(i>0?s.direct=t.CommonConfig.DOWN:s.direct=t.CommonConfig.UP,this.isBegin=!1),!this.isBegin){var r=new egret.Event(t.CommonEventName.GESTURE_DIRECT);r.data=s,t.EventManager.instance.dispatchEvent(r)}this.lastPos.x=this.nowPos.x,this.lastPos.y=this.nowPos.y}},i.prototype.onTouchBegin=function(t){this.pastTime=0,this.nowPos.x=t.stageX,this.nowPos.y=t.stageY,this.lastPos.x=t.stageX,this.lastPos.y=t.stageY,this.isBegin=!0},i.prototype.onTouchEnd=function(t){this.isBegin=!1},i.prototype.onTouchMove=function(t){this.nowPos.x=t.stageX,this.nowPos.y=t.stageY},i.prototype.OnDestroy=function(){return clearInterval(this.intervalID),0},i}(t.ComponentBase);t.Gesture=e,__reflect(e.prototype,"ZJ.Gesture")}(ZJ||(ZJ={}));var ZJ;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){return 0},e._instance=new e,e}(egret.EventDispatcher);t.EventManager=e,__reflect(e.prototype,"ZJ.EventManager")}(ZJ||(ZJ={}));var ZJ;!function(t){var e=function(){function e(){}return e.randomRange=function(e,i,o){null==o&&(o=t.Util.timeStamp());var n=this.randomSeed(o);return n/=233280,Math.floor(e+n*(i-e))},e.randomSeed=function(t){return t=(9301*t+49297)%233280},e.YiYuanErCi=function(t,e,i){var o,n,s,r=[];return o=e*e-4*t*i,0>o||(n=(-1*e+Math.sqrt(o))/(2*t),s=(-1*e-Math.sqrt(o))/(2*t),r.push(n),r.push(s)),r},e}();t.MathUtil=e,__reflect(e.prototype,"ZJ.MathUtil")}(ZJ||(ZJ={}));var ZJ;!function(t){var e=function(){function e(){this.aa=null,this.stage=null,this.dbFactory=dragonBones.EgretFactory.factory,this.dbFileNames=[]}return Object.defineProperty(e,"instance",{get:function(){return this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.stage=t,this.aa=new AssetAdapter,[4,this.loadConfig("resource/default.res.json","resource/")];case 1:return e.sent(),[4,this.loadTheme()];case 2:return e.sent(),[2]}})})},e.prototype.loadRes=function(t,e,i,o){this.aa.getAsset(t,e,i,o)},e.prototype.loadExistRes=function(t){return RES.getRes(t)},e.prototype.loadConfig=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,RES.loadConfig(t,e)];case 1:return i.sent(),[2]}})})},e.prototype.loadGroup=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=null),__awaiter(this,void 0,void 0,function(){var o;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,RES.loadGroup(t,e,i)];case 1:return n.sent(),[3,3];case 2:return o=n.sent(),console.error(o),[3,3];case 3:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,i){var o=new eui.Theme("resource/default.thm.json",t.stage);o.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.loadMovieClip=function(e,i,o){t.ResManager.instance.loadRes(e+"_json",function(n,s){var r=n;t.ResManager.instance.loadRes(e+"_png",function(t,e){var n=t,s=new egret.MovieClipDataFactory(r,n),a=new egret.MovieClip(s.generateMovieClipData(i));o(a,s)},this)},this)},e.prototype.loadDragonBones=function(t,e){if(void 0===e&&(e=""),""==e&&(e=t),-1==this.dbFileNames.indexOf(t)){var i=this.loadExistRes(t+"_ske_json"),o=this.loadExistRes(t+"_tex_json"),n=this.loadExistRes(t+"_tex_png");this.dbFactory.parseDragonBonesData(i),this.dbFactory.parseTextureAtlasData(o,n),this.dbFileNames.push(t)}var s=this.dbFactory.buildArmatureDisplay(e);return s},e.prototype.replaceDBSlotDisplay=function(t,e,i,o,n){void 0===e&&(e=""),""==e&&(e=t),this.dbFactory.replaceSlotDisplay(t,e,i,o,n)},e._instance=new e,e}();t.ResManager=e,__reflect(e.prototype,"ZJ.ResManager")}(ZJ||(ZJ={}));var ZJ;!function(t){var e=function(){function t(){}return t.getRect=function(t,e,i,o,n,s){void 0===n&&(n=0),void 0===s&&(s=0);var r=new egret.Shape;return r.graphics.beginFill(t,e),r.graphics.drawRect(n,s,i,o),r.graphics.endFill(),r},t.getCircle=function(t,e,i,o,n){void 0===o&&(o=0),void 0===n&&(n=0);var s=new egret.Shape;return s.graphics.beginFill(t,e),s.graphics.drawCircle(o,n,i),s.graphics.endFill(),s},t.getLine=function(t,e,i,o,n,s,r){var a=new egret.Shape;return a.graphics.lineStyle(i,t,e),a.graphics.moveTo(o,n),a.graphics.lineTo(s,r),a.graphics.endFill(),a},t.getArc=function(t,e,i,o,n,s,r,a,h){void 0===r&&(r=!1),void 0===a&&(a=0),void 0===h&&(h=0);var c=new egret.Shape;return c.graphics.lineStyle(i,t,e),c.graphics.drawArc(a,h,o,Math.PI/180*n,Math.PI/180*s,r),c.graphics.endFill(),c},t.getArch=function(t,e,i,o,n,s,r,a){void 0===s&&(s=!1),void 0===r&&(r=0),void 0===a&&(a=0);var h=new egret.Shape;return h.graphics.beginFill(t,e),h.graphics.drawArc(r,a,i,Math.PI/180*o,Math.PI/180*n,s),h.graphics.endFill(),h},t.setArcMask=function(t,e,i,o,n,s,r){void 0===n&&(n=!1),void 0===s&&(s=t.x),void 0===r&&(r=t.y);var a;null!=t.mask?a=t.mask:(a=new egret.Shape,t.parent.addChild(a));var h=Math.round(i+360*o)*Math.PI/180;i*=Math.PI/180,a.graphics.clear(),a.graphics.beginFill(16711680,1),a.graphics.lineTo(e,0),a.graphics.drawArc(s,r,e,i,h,n),a.graphics.lineTo(s,r),a.graphics.endFill(),a.x=t.x,a.y=t.y,t.mask=a},t.setRectMask=function(t,e,i,o,n){void 0===e&&(e=t.x),void 0===i&&(i=t.y),void 0===o&&(o=t.width),void 0===n&&(n=t.height);var s;null!=t.mask?s=t.mask:(s=new egret.Shape,t.parent.addChild(s)),s.graphics.clear(),s.graphics.beginFill(16711680,1),s.graphics.drawRect(0,0,o,n),s.graphics.endFill(),s.x=e,s.y=i,t.mask=s},t}();t.ShapeUtil=e,__reflect(e.prototype,"ZJ.ShapeUtil")}(ZJ||(ZJ={}));var ZJ;!function(t){var e=function(t){function e(e,i,o,n){var s=t.call(this,e,i,o,n)||this;return s.data=null,s}return __extends(e,t),e}(egret.Event);t.SocketDataEvent=e,__reflect(e.prototype,"ZJ.SocketDataEvent")}(ZJ||(ZJ={}));var ZJ;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.socket=null,t.ProtoBufRoot=new protobuf.Root,t.send=null,t.onSocketData=null,t.getProtoByID=null,t._company=1,t.clientIndex=0,t}return __extends(i,e),Object.defineProperty(i,"instance",{get:function(){return this._instance},enumerable:!0,configurable:!0}),i.prototype.init=function(){return this.parseProto(),this.socket=new egret.WebSocket,this.socket.type=egret.WebSocket.TYPE_BINARY,this.setCompany(1),this.socket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onSocketData,this),this.socket.addEventListener(egret.Event.CONNECT,this.onSocketConnect,this),this.socket.addEventListener(egret.Event.CLOSE,this.onSocketClose,this),0},i.prototype.parseProto=function(){for(var t=this.ProtoBufRoot,e=ModuleConfig.protoFiles,i=0,o=e.length;o>i;++i){var n=RES.getRes(e[i]);protobuf.parse(n,t)}},i.prototype.setCompany=function(t){switch(this._company=t,t){case 2:this.send=this.sendYouai,this.onSocketData=this.onSocketDataYouai,this.getProtoByID=this.getProtoByIDYouai;break;case 3:this.send=this.sendAli,this.getProtoByID=this.getProtoByIDHuoshu;break;default:this.send=this.sendHuoshu,this.onSocketData=this.onSocketDataHuoshu,this.getProtoByID=this.getProtoByIDHuoshu}},i.prototype.connect=function(t,e){this.socket.connect(t,e)},i.prototype.connectByUrl=function(t){this.socket.connectByUrl(t)},i.prototype.close=function(){this.socket.close()},i.prototype.onSocketConnect=function(e){var i=new egret.Event(t.CommonEventName.SOCKET_CONNECTED);this.dispatchEvent(i)},i.prototype.onSocketClose=function(e){var i=new egret.Event(t.CommonEventName.SOCKET_CLOSE);this.dispatchEvent(i)},i.prototype.buildSmallShitByID=function(t,e){var i=this.getProtoByID(t,!0),o=this.buildSmallShit(i,e);return o},i.prototype.decodeShitByID=function(t,e){var i=this.getProtoByID(t,!1),o=this.decodeShit(i,e);return o},i.prototype.buildSmallShit=function(t,e){var i=t.create(e),o=t.encode(i),n=o.finish();return n},i.prototype.decodeShit=function(t,e){var i=t.decode(e);return i},i.prototype.sendHuoshu=function(t,e){void 0===e&&(e={});var i=this.buildSmallShitByID(t,e),o=new egret.ByteArray;o.writeInt(i.byteLength),o.writeShort(t),o._writeUint8Array(i),this.socket.writeBytes(o)},i.prototype.onSocketDataHuoshu=function(e){var i=new egret.ByteArray;this.socket.readBytes(i);var o=(i.readInt(),i.readShort()),n=this.decodeShitByID(o,i.bytes.subarray(6)),s=new t.SocketDataEvent(t.CommonEventName.SOCKET_DATA);s.data={data:n,protoID:o},this.dispatchEvent(s)},i.prototype.getProtoByIDHuoshu=function(e,i){var o=(Math.floor(e/1e3),""),n="";
n=i?"cs_":"sc_",o=n+e;var s=t.SocketManager.instance.ProtoBufRoot,r=s.lookupType(o);return r},i.prototype.sendYouai=function(t,e){void 0===e&&(e={});var i=this.buildSmallShitByID(t,e),o=this.buildSmallShitByID(99999,{messageId:t,clientIndex:this.clientIndex++,data:i}),n=new egret.ByteArray(o);this.socket.writeBytes(n)},i.prototype.onSocketDataYouai=function(e){var i=new egret.ByteArray;this.socket.readBytes(i);var o=this.decodeShitByID(99999,i.bytes),n="",s={},r=o.result,a=o.messageId;o.result?s=this.decodeShitByID(o.messageId,o.data):n=t.Util.Utf8ArrayToStr(o.data);var h=new t.SocketDataEvent(t.CommonEventName.SOCKET_DATA);h.data={data99999:o,error:n,result:r,data:s,protoID:a},this.dispatchEvent(h)},i.prototype.getProtoByIDYouai=function(e,i){var o="";if(i)switch(e){case 99999:o="ClientCmdData";break;case 1e3:o="CmdLoginGameReqMsg";break;case 1001:o="CmdPingReqMsg";break;case 1300:o="CmdJumperUploadAnswerReqMsg";break;case 1303:o="CmdJumperGameOverReqMsg"}else switch(e){case 99999:o="ServerCmdData";break;case 1e3:o="CmdLoginGameRspMsg";break;case 1001:o="CmdPingRspMsg";break;case 1300:o="CmdJumperUploadAnswerRspMsg";break;case 1303:o="CmdJumperGameOverRspMsg";break;case 1399:o="CmdBroadcastJumperBC"}var n=t.SocketManager.instance.ProtoBufRoot,s=n.lookupType(o);return s},i.prototype.sendAli=function(t,e){void 0===e&&(e={});var i=this.buildSmallShitByID(t,e),o=new egret.ByteArray;o.writeInt(i.byteLength),o.writeShort(t),o._writeUint8Array(i),ALISDK.CatcherSDK.instance().sendData(o.buffer)},i.prototype.onSocketDataAli=function(e){var i=new egret.ByteArray(e),o=(i.readInt(),i.readShort()),n=this.decodeShitByID(o,i.bytes.subarray(6)),s=new t.SocketDataEvent(t.CommonEventName.SOCKET_DATA);s.data={data:n,protoID:o},this.dispatchEvent(s)},i.prototype.connectByUrlAli=function(e){var i=this;ALISDK.CatcherSDK.init({url:"ws://"+e.ip+":"+e.port+"/ws/game",gameVersion:"0.0.1",gameId:"123123",messageType:"ARRAYBUFFER"}),ALISDK.CatcherSDK.instance().on("CONNECT",function(e){var o=new t.ChannelDataEvent(t.CommonEventName.CHANNEL_DATA);o.data={eventName:"CONNECT",event:e},i.dispatchEvent(o)}).on("PROGRESS",function(e){var o=new t.ChannelDataEvent(t.CommonEventName.CHANNEL_DATA);o.data={eventName:"PROGRESS",event:e},i.dispatchEvent(o)}).on("READY",function(e){var o=new t.ChannelDataEvent(t.CommonEventName.CHANNEL_DATA);o.data={eventName:"READY",event:e},i.dispatchEvent(o)}).on("KICK",function(e){var o=new t.ChannelDataEvent(t.CommonEventName.CHANNEL_DATA);o.data={eventName:"KICK",event:e},i.dispatchEvent(o)}).on("GAMEOVER",function(e){var o=new t.ChannelDataEvent(t.CommonEventName.CHANNEL_DATA);o.data={eventName:"GAMEOVER",event:e},i.dispatchEvent(o)}).on("BREAK",function(e){var o=new t.ChannelDataEvent(t.CommonEventName.CHANNEL_DATA);o.data={eventName:"BREAK",event:e},i.dispatchEvent(o)}).on("CONTINUE",function(e){var o=new t.ChannelDataEvent(t.CommonEventName.CHANNEL_DATA);o.data={eventName:"CONTINUE",event:e},i.dispatchEvent(o)}).on("ERROR",function(e){var o=new t.ChannelDataEvent(t.CommonEventName.CHANNEL_DATA);o.data={eventName:"ERROR",event:e},i.dispatchEvent(o)}).on("MIC_CHANGE",function(e){var o=new t.ChannelDataEvent(t.CommonEventName.CHANNEL_DATA);o.data={eventName:"MIC_CHANGE",event:e},i.dispatchEvent(o)}).on("AUDIO_CHANGE",function(e){var o=new t.ChannelDataEvent(t.CommonEventName.CHANNEL_DATA);o.data={eventName:"AUDIO_CHANGE",event:e},i.dispatchEvent(o)}).on("MESSAGE",function(t){i.onSocketDataAli(t.data)}).start()},i._instance=new i,i}(egret.EventDispatcher);t.SocketManager=e,__reflect(e.prototype,"ZJ.SocketManager")}(ZJ||(ZJ={}));var ZJ;!function(t){var e=function(){function e(){this._tables={}}return Object.defineProperty(e,"instance",{get:function(){return this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){return this.load("bg_djw_png"),0},Object.defineProperty(e.prototype,"tables",{get:function(){return this._tables},enumerable:!0,configurable:!0}),e.prototype.load=function(e){t.ResManager.instance.loadRes(e,function(e){for(var i=new JSZip(e),o=i.file(/^[tc].*/),n=0,s=o.length;s>n;n++){var r=o[n],a=t.Util.strFormat("shared/{0}",r.name);this._tables[a]=JSON.parse(r.asText())}t.EventManager.instance.dispatchEvent(new egret.Event(t.CommonEventName.TABLE_LOADED))},this)},e._instance=new e,e}();t.TableManager=e,__reflect(e.prototype,"ZJ.TableManager")}(ZJ||(ZJ={}));var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,o){function n(t){e.call(o,t)}function s(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),i.call(o))}"undefined"!=typeof generateEUI?egret.callLater(function(){e.call(o,generateEUI)},this):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_TEXT))},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i,o){function n(o){e.call(i,o,t)}if(void 0===o&&(o=RES.ResourceItem.TYPE_IMAGE),RES.hasRes(t)){var s=RES.getRes(t);s?n(s):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,o)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var ZJ;!function(t){var e=function(){function t(){this._uiLayers=[],this.uiDatas={},this.uiroot=null,this.views={}}return Object.defineProperty(t,"instance",{get:function(){return this._instance},enumerable:!0,configurable:!0}),t.prototype.init=function(t){return this.uiroot=t,0},Object.defineProperty(t.prototype,"uiLayers",{set:function(t){if(this._uiLayers.length>0)egret.warn("uiLayers已经设定。");else{this._uiLayers=t;for(var e=0,i=this._uiLayers.length;i>e;++e){var o=new eui.Group;o.name="layer"+e,o.touchEnabled=!1,this.uiroot.addChild(o),o.percentWidth=100,o.percentHeight=100}}},enumerable:!0,configurable:!0}),t.prototype.getUIData=function(t){return this.uiDatas[t]},t.prototype.getView=function(t){return this.views[t]},t.prototype.openView=function(t){var e=this.getUIData(t);if(void 0==e)return egret.log("ModuleConfig没有界面配置: "+t),null;var i=this.getView(t);if(void 0!=i);else{if(i=new e.viewClass,void 0==i)return console.warn("viewClass不存在 请检查ModuleConfig.uiDatas"),null;i.percentWidth=100,i.percentHeight=100,this.views[t]=i;var o=0;e.layer<this.uiroot.numChildren&&(o=e.layer),this.uiroot.getChildAt(o).addChild(i)}return i.visible=!0,i.parent.setChildIndex(i,9999),i.show(),i},t.prototype.destroyView=function(t){var e=this.getView(t);return void 0!=e&&null!=e&&(e.onDestroy(),e.parent.removeChild(e),this.views[t]=null),0},t._instance=new t,t}();t.UIManager=e,__reflect(e.prototype,"ZJ.UIManager")}(ZJ||(ZJ={}));var ZJ;!function(t){var e=function(){function t(){}return t.getChar=function(t,e){var i=new egret.ByteArray;return i.writeUTFBytes(t),i.length<e?t:(i.position=0,i.readUTFBytes(e)+"...")},t.strFormat=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return t.replace(/\{(\d+)\}/g,function(t,i){return e[i]})},t.timeStamp=function(t){return t=t||(new Date).toString(),Date.parse(t)/1e3},t.Utf8ArrayToStr=function(t){var e,i,o,n,s,r;for(e="",o=t.length,i=0;o>i;)switch(n=t[i++],n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:e+=String.fromCharCode(n);break;case 12:case 13:s=t[i++],e+=String.fromCharCode((31&n)<<6|63&s);break;case 14:s=t[i++],r=t[i++],e+=String.fromCharCode((15&n)<<12|(63&s)<<6|(63&r)<<0)}return e},t.getClassName=function(t){if(t&&t.constructor&&t.constructor.toString()){if(t.constructor.name)return t.constructor.name;var e=t.constructor.toString();if("["==e.charAt(0))var i=e.match(/\[\w+\s*(\w+)\]/);else var i=e.match(/function\s*(\w+)/);if(i&&2==i.length)return i[1]}},t.objToByteArray=function(t){var e=JSON.stringify(t),i=new egret.ByteArray;return i.writeUTF(e),i},t.rmArrayObj=function(t,e){return-1!=t.indexOf(e)?t.splice(t.indexOf(e),1):void 0},t}();t.Util=e,__reflect(e.prototype,"ZJ.Util")}(ZJ||(ZJ={}));var ZJ;!function(t){var e=function(){function t(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this.x=0,this.y=0,this.z=0,this.x=t,this.y=e,this.z=i}return t}();t.Vector3=e,__reflect(e.prototype,"ZJ.Vector3")}(ZJ||(ZJ={}));var ZJ;!function(t){var e=function(){function e(){this.bgm="bgm",this._isMute=!1,this.sounds={},this.soundsUniqueChannel={},this.soundsChannel={}}return Object.defineProperty(e,"Instance",{get:function(){return this._instance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isMute",{get:function(){return this._isMute},set:function(t){this._isMute=t,this._isMute?this.stopAll():this.playBgm()},enumerable:!0,configurable:!0}),e.prototype.playBgm=function(t,e){void 0===t&&(t=0),void 0===e&&(e=1),this._isMute||null!=this.bgm&&""!=this.bgm&&this.play(this.bgm,t,e,!0)},e.prototype.stopBgm=function(){this.stop(this.bgm)},e.prototype.play=function(e,i,o,n){var s=this;void 0===i&&(i=1),void 0===o&&(o=1),void 0===n&&(n=!1);var r=e+"_mp3";if(!this._isMute)if(null!=this.sounds[e]){n&&this.stop(e);var a=this.sounds[e].play(0,i);n?this.soundsUniqueChannel[e]=a:this.soundsChannel[e].push(a),a.volume=o}else t.ResManager.instance.loadRes(r,function(t,r){var a=t,h=a.play(0,i);h.volume=o,s.sounds[e]=a,s.soundsChannel[e]=[],n?s.soundsUniqueChannel[e]=h:s.soundsChannel[e].push(h)},this)},e.prototype.stop=function(t){var e=this.soundsChannel[t],i=this.soundsUniqueChannel[t];if(null!=e){for(var o=0,n=e;o<n.length;o++){var s=n[o];s.stop()}e.length=0}null!=i&&(i.stop(),i=null)},e.prototype.stopAll=function(){for(var t in this.soundsChannel)this.stop(t);for(var e in this.soundsUniqueChannel)this.stop(e)},e.prototype.getSound=function(t){return this.sounds[t]},e.prototype.getChannel=function(t){return this.soundsChannel[t]},e.prototype.getUniqueChannel=function(t){return this.soundsUniqueChannel[t]},e._instance=new e,e}();t.AudioManager=e,__reflect(e.prototype,"ZJ.AudioManager")}(ZJ||(ZJ={}));var ZJ;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.cb=null,t.leftSecond=0,t.intervalID=0,t.isPause=!1,t.skinName="CountDownSkin",t}return __extends(i,e),i.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},i.prototype.start=function(t){var e=this;this.stop(),this.isPause=!1,this.leftSecond=t,this.count(),this.intervalID=setInterval(function(){e.count()},1e3)},i.prototype.pause=function(){this.isPause=!0},i.prototype.resume=function(){this.isPause=!1},i.prototype.stop=function(){clearInterval(this.intervalID)},i.prototype.setSecond=function(e){var i=Math.floor(e/60)%60,o=e%60,n=this.checkTime(i),s=this.checkTime(o);this.label.text=t.Util.strFormat("{0}:{1}",n,s)},i.prototype.count=function(){return this.setSecond(this.leftSecond),0==this.leftSecond?(this.stop(),void(null!=this.cb&&this.cb())):void(this.isPause||this.leftSecond--)},i.prototype.checkTime=function(t){return 10>t&&(t="0"+t),t},i.prototype.OnDestroy=function(){this.cb=null,this.stop()},i}(eui.Component);t.CountDown=e,__reflect(e.prototype,"ZJ.CountDown",["eui.UIComponent","egret.DisplayObject"])}(ZJ||(ZJ={}));var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.share=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var MyButton=function(t){function e(){var e=t.call(this)||this;return e.addEventListener("touchBegin",function(){e.img.visible=!1},e),e.addEventListener("touchEnd",function(){e.img.visible=!0},e),e.addEventListener("touchReleaseOutside",function(){e.img.visible=!0},e),e}return __extends(e,t),e}(ZJ.ComponentBase);__reflect(MyButton.prototype,"MyButton");var UILayer=function(){function t(){}return t.View=0,t.Pop=1,t.SDK=2,t}();__reflect(UILayer.prototype,"UILayer");var UIName=function(){function t(){}return t.Game="Game",t.Settle="Settle",t.Loading="Loading",t}();__reflect(UIName.prototype,"UIName");var ModuleConfig=function(){function t(){}return t.WIN_INDEX=6,t.uiLayers=[UILayer.View,UILayer.Pop,UILayer.SDK],t.uiDatas=(_a={},_a[UIName.Game]=new ZJ.UIData(UIName.Game,UILayer.View,GameView),_a[UIName.Settle]=new ZJ.UIData(UIName.Settle,UILayer.View,SettleView),_a[UIName.Loading]=new ZJ.UIData(UIName.Loading,UILayer.Pop,LoadingView),_a),t.compile={need_loading:!0,ali:!1,chushou:!0,chushou_h5AppName:"hstetrissingle",danji:!0},t.ip="dev-game.u17games.com",t.port="12051",t.ws="ws",t.protoFiles=["p10_proto","p11_proto"],t}();__reflect(ModuleConfig.prototype,"ModuleConfig");var EventName=function(){function t(){}return t.SPEED="Speed",t.SPEED_READY="SpeedReady",t.ADD_SCORE="AddScore",t.MOVE_LEFT="Moveleft",t.MOVE_RIGHT="MoveRight",t.MOVE_DOWN="MoveDown",t.MOVE_FAST_DOWN="MoveFastDown",t.ROTATE="Rotate",t.ADD_OBS_BLOCK="AddObsBlock",t.SPECIAL_X="Special_X",t.MOVE_END_EVENT="MoveEndEvent",t.GAME_OVER="GameOver",t}();__reflect(EventName.prototype,"EventName");var _a,ModuleStartUp=function(){function t(){}return t.init=function(){return ZJ.SocketManager.instance.setCompany(1),ZJ.UIManager.instance.openView(UIName.Game),0},t}();__reflect(ModuleStartUp.prototype,"ModuleStartUp");var ModuleUtil=function(){function t(){}return Object.defineProperty(t,"tables",{get:function(){return ZJ.TableManager.instance.tables},enumerable:!0,configurable:!0}),t}();__reflect(ModuleUtil.prototype,"ModuleUtil");var Block=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.skinName="BlockSkin"},e}(eui.Component);__reflect(Block.prototype,"Block",["eui.UIComponent","egret.DisplayObject"]);var Combo=function(t){function e(){var e=t.call(this)||this;return e.skinName="ComboSkin",e}return __extends(e,t),e.prototype.setCombo=function(t){this.comboLabel.text="X"+t.toString()},e.prototype.show=function(){var t=this;this.scaleX=.5,this.scaleY=.5;var e=350,i=150,o=500,n=500;egret.Tween.get(this).to({scaleX:1.1,scaleY:1.1,verticalCenter:this.verticalCenter-250},e).call(function(){egret.Tween.get(t).to({scaleX:1,scaleY:1,verticalCenter:t.verticalCenter+80},i).wait(o).call(function(){egret.Tween.get(t).to({alpha:0},n).call(function(){t.parent.removeChild(t)})},t)},this)},e}(eui.Component);__reflect(Combo.prototype,"Combo",["eui.UIComponent","egret.DisplayObject"]);var FlyBlock=function(t){function e(){var e=t.call(this)||this;e.posArray=[],e.curIndex=0,e.rotateArray=[-105,-105],e.moveTimeArray=[0,320],e.moveTotalTime=0,e.callBack=null,e.skinName="FlyBlockSkin";for(var i=0;i<e.moveTimeArray.length;i++)e.moveTotalTime+=e.moveTimeArray[i];return e}return __extends(e,t),e.prototype.play=function(t,e,i){void 0===i&&(i=!0),this.particleSystem=e,this.posArray=t,this.ball.visible=!0,this.tail.scaleY=.1,this.tail.visible=!0,this.tail.source="tail_png",this.light_point.visible=!0,this.horizontalCenter=this.posArray[0].x,this.verticalCenter=this.posArray[0].y,this.rotation=this.rotateArray[0];var o=["J","L","Z","S","T","O","I"];i&&(this.ball_block.source="block_"+o[ZJ.MathUtil.randomRange(0,o.length)]+"_png",this.ball_block.scaleX=0,this.ball_block.scaleY=0,this.ball_block.rotation=0,this.ball_block.visible=!0,egret.Tween.get(this.ball_block).to({scaleX:1,scaleY:1},this.moveTimeArray[1]),egret.Tween.get(this.ball_block).to({rotation:150},this.moveTotalTime)),this.particleSystem.emitterX=this.posArray[0].x,this.particleSystem.emitterY=this.posArray[0].y,this.particleSystem.start(),this.moveNextPos()},e.prototype.moveNextPos=function(){var t=this;if(this.curIndex++,this.curIndex>=this.posArray.length)this.light_point.visible=!1,this.ball_block.visible=!1,setTimeout(function(){t.tail.visible=!1},50),null!=this.callBack&&this.callBack(this.ball),this.particleSystem.stop();else{var e=this.posArray[this.curIndex];egret.Tween.get(this.particleSystem).to({emitterX:e.x,emitterY:e.y},this.moveTimeArray[this.curIndex]),egret.Tween.get(this).to({horizontalCenter:e.x,verticalCenter:e.y,rotation:this.rotateArray[this.curIndex]},this.moveTimeArray[this.curIndex]).call(function(){t.moveNextPos()}),1==this.curIndex&&egret.Tween.get(this.tail).to({scaleY:1},this.moveTimeArray[this.curIndex]/2)}},e}(eui.Component);__reflect(FlyBlock.prototype,"FlyBlock",["eui.UIComponent","egret.DisplayObject"]);var NumCountDown=function(t){function e(){var e=t.call(this)||this;return e.cb=null,e.leftSecond=0,e.intervalID=0,e.isPause=!1,e.skinName="NumCountDownSkin",e}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.start=function(t){var e=this;this.stop(),this.isPause=!1,this.leftSecond=t,this.count(),this.intervalID=setInterval(function(){e.count()},1e3)},e.prototype.pause=function(){this.isPause=!0},e.prototype.stop=function(){this.label.text="",clearInterval(this.intervalID)},e.prototype.count=function(){return this.label.text=this.leftSecond.toString(),0==this.leftSecond?(this.stop(),void(null!=this.cb&&this.cb())):void(this.isPause||this.leftSecond--)},e.prototype.OnDestroy=function(){this.cb=null,this.stop()},e}(eui.Component);__reflect(NumCountDown.prototype,"NumCountDown",["eui.UIComponent","egret.DisplayObject"]);var Dir;!function(t){t[t.left=0]="left",t[t.right=1]="right",t[t.down=2]="down"}(Dir||(Dir={}));var TetrisCmd;!function(t){t[t.rotate=0]="rotate",t[t.moveleft=1]="moveleft",t[t.moveright=2]="moveright",t[t.movedown=3]="movedown",t[t.movefastdown=4]="movefastdown",t[t.addObsBlockToEnemy=5]="addObsBlockToEnemy",t[t.addObsBlockMySelf=6]="addObsBlockMySelf",t[t.gameover=7]="gameover",t[t.checkData=8]="checkData"}(TetrisCmd||(TetrisCmd={}));var Tetris=function(t){function e(){var e=t.call(this)||this;e.COL=10,e.ROW=20,e.BLOCK_WIDTH=56.5,e.BLOCK_HEIGHT=56.2,e.SMALL_BLOCK_PERCENT=.55,e.DEF_INTERVAL=700,e.TETRIS_NAMES=["block_J","block_L","block_S","block_Z","block_T","block_I","block_O"],e.SPEED_INTERVAL=100,e.MIN_INTERVAL=100,e.SPEED_READY_TIME=3e3,e.clear_row=0,e.use_time=0,e.bornBeginPos=new Pos(0,3),e.curBlockBeginPos=new Pos(0,3),e.curBlockTetrisType=0,e.curBlockState=0,e.curBlockTetrisTypeName="",e.curBlockArray=[],e.shadowBlocks=[],e.nextBlockArray=[],e.doubleNextBlockArray=[],e.timeOnEnterFrame=0,e.randomNumArray=[],e.isOver=!1,e.isPlay=!0,e.isAI=!1,e.isReceiver=!1,e.addSpeedCount=0,e.time=0,e.isDoMoveEndEvent=!1,e.isMoveFastDown=!1,e.hasTouchDown=!1,e.combo=-1,e.interval=e.DEF_INTERVAL,e.hasReadySpeed=!1,e.speedLevel=1,e.score=0,e.curRanIndex=-1,e.curRanCount=0,e.cmdArray=[],e.whitePanelArray=[],e.AIReadyRotateTimeArray=[250,130,90,10],e.AIReadyMoveTimeArray=[200,130,90,10],e.AIReadyMoveFastDownTimeArray=[500,370,270,10],e.AIRotateIntervalTimeArray=[250,160,120,10],e.AIMoveIntervalTimeArray=[230,140,50,10],e.curAILevel=3,e.AIWrongProArray=[30,15,0,0],e.seed=0,e.battleTimes=0,e.tetrisInfo=[new TetrisInfo([[[0,0,0,0],[0,1,1,1],[0,0,0,1],[0,0,0,0]],[[0,0,1,0],[0,0,1,0],[0,1,1,0],[0,0,0,0]],[[0,0,0,0],[0,1,0,0],[0,1,1,1],[0,0,0,0]],[[0,0,1,1],[0,0,1,0],[0,0,1,0],[0,0,0,0]]]),new TetrisInfo([[[0,0,0,0],[0,1,1,1],[0,1,0,0],[0,0,0,0]],[[0,1,1,0],[0,0,1,0],[0,0,1,0],[0,0,0,0]],[[0,0,0,0],[0,0,0,1],[0,1,1,1],[0,0,0,0]],[[0,0,1,0],[0,0,1,0],[0,0,1,1],[0,0,0,0]]]),new TetrisInfo([[[0,0,0,0],[0,0,1,1],[0,1,1,0],[0,0,0,0]],[[0,1,0,0],[0,1,1,0],[0,0,1,0],[0,0,0,0]]]),new TetrisInfo([[[0,0,0,0],[0,1,1,0],[0,0,1,1],[0,0,0,0]],[[0,0,0,1],[0,0,1,1],[0,0,1,0],[0,0,0,0]]]),new TetrisInfo([[[0,0,0,0],[0,1,1,1],[0,0,1,0],[0,0,0,0]],[[0,0,1,0],[0,1,1,0],[0,0,1,0],[0,0,0,0]],[[0,0,0,0],[0,0,1,0],[0,1,1,1],[0,0,0,0]],[[0,0,1,0],[0,0,1,1],[0,0,1,0],[0,0,0,0]]]),new TetrisInfo([[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]]]),new TetrisInfo([[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]]])],e.AIRotateIdArray=[],e.AIMoveIdArray=[],e.total_width=e.BLOCK_WIDTH*e.COL,e.total_height=e.BLOCK_HEIGHT*e.ROW,e.width=e.total_width,e.height=e.total_height,e.blocks=new Array;for(var i=0;i<e.ROW;i++){e.blocks[i]=new Array;for(var o=0;o<e.COL;o++)e.blocks[i][o]=null}return e.skinName="",e}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),ZJ.ResManager.instance.loadMovieClip("luodi","luodi",function(t,i){e.luodiFactory=i}),this.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this)},e.prototype.onEnterFrame=function(t){if(this.isPlay&&!this.isOver){var e=egret.getTimer(),i=this.timeOnEnterFrame,o=e-i;for(this.use_time+=o,this.time+=o,(!this.isReceiver||this.isAI)&&this.time>=this.getIntervalTime()&&!this.hasTouchDown&&(this.onInterval(),this.time=0);this.cmdArray.length>0&&this.isPlay;){var n=this.cmdArray.shift(),s=n.cmd,r=n.data;s==TetrisCmd.rotate?this.rotateOnce():s==TetrisCmd.moveleft?this.moveLeft():s==TetrisCmd.moveright?this.moveRight():s==TetrisCmd.movedown?this.moveDown():s==TetrisCmd.movefastdown?this.moveFastDown():s==TetrisCmd.checkData&&(this.checkDataSame(r)||this.setDatas(r))}this.timeOnEnterFrame=egret.getTimer()}},e.prototype.createTetris=function(t,e){var i=this.getTetrisInfo(t,e);this.curBlockTetrisType=t,this.curBlockTetrisTypeName=this.TETRIS_NAMES[t],this.curBlockState=e;for(var o=-1,n=i.length-1;n>=0&&-1==o;n--)for(var s=0;s<i[n].length;s++)if(1==i[n][s]){o=n;break}this.curBlockBeginPos.i=this.bornBeginPos.i-(o-0),this.curBlockBeginPos.j=this.bornBeginPos.j,this.createTetrisBlockByInfo(i),this.setTetrisShadow()},e.prototype.createRandomTetris=function(){var t=this,e=this.randomNumArray.shift();this.createTetris(e.tetrisType,e.state),this.randomNumArray.push(this.getRandomNumByRule()),this.nextTetrisGroup&&this.setTetrisBySelf(this.randomNumArray[0].tetrisType,this.randomNumArray[0].state,this.BLOCK_WIDTH*this.SMALL_BLOCK_PERCENT,this.BLOCK_HEIGHT*this.SMALL_BLOCK_PERCENT,this.nextTetrisGroup),this.doubleNextTetrisGroup&&this.setTetrisBySelf(this.randomNumArray[1].tetrisType,this.randomNumArray[1].state,this.BLOCK_WIDTH*this.SMALL_BLOCK_PERCENT*.7,this.BLOCK_HEIGHT*this.SMALL_BLOCK_PERCENT*.7,this.doubleNextTetrisGroup),this.isAI&&setTimeout(function(){var e=t.getFitAIPos();null!=e&&t.setFitAIPos(e)},300)},e.prototype.getRandomNum=function(){var t={};return this.seed=ZJ.MathUtil.randomSeed(this.seed),t.tetrisType=ZJ.MathUtil.randomRange(0,this.tetrisInfo.length,this.seed),this.seed=ZJ.MathUtil.randomSeed(this.seed),t.state=ZJ.MathUtil.randomRange(0,this.tetrisInfo[t.tetrisType].info.length,this.seed),t},e.prototype.getRandomNumByRule=function(){var t=this.getRandomNum();if(t.tetrisType!=this.curRanIndex?(this.curRanIndex=t.tetrisType,this.curRanCount=1):this.curRanCount++,this.curRanCount>=3)for(;;)if(t=this.getRandomNum(),t.tetrisType!=this.curRanIndex){this.curRanIndex=t.tetrisType,this.curRanCount=1;break}return t},e.prototype.createTetrisBlockByInfo=function(t){if(null!=t){this.curBlockArray.length=0;for(var e=0;e<t.length;e++)for(var i=0;i<t[e].length;i++)if(1==t[e][i]){var o=new Block;o.width=this.BLOCK_WIDTH,o.height=this.BLOCK_HEIGHT,this.addChild(o),this.curBlockArray.push(o);var n=this.getPosByIndex(this.curBlockBeginPos.i+e,this.curBlockBeginPos.j+i);o.x=n.x,o.y=n.y,o.row=this.curBlockBeginPos.i+e,o.col=this.curBlockBeginPos.j+i,o.tetrisType=this.curBlockTetrisType,o.img.source=this.curBlockTetrisTypeName+"_png",o.row<0&&(o.visible=!1)}}},e.prototype.setTetrisBySelf=function(t,e,i,o,n){if(!this.isAI&&!this.isReceiver){var s=this.getTetrisInfo(t,e);if(s){var r=0,a=void 0;if(n==this.nextTetrisGroup?a=this.nextBlockArray:n==this.doubleNextTetrisGroup&&(a=this.doubleNextBlockArray),a){for(var h=0,c=0,l=0;l<s.length;l++)for(var u=0;u<s[l].length;u++)if(1==s[l][u]){h++;break}for(var u=0;u<s[0].length;u++)for(var l=0;l<s.length;l++)if(1==s[l][u]){c++;break}for(var d=new Pos(-1,-1),l=0;l<s.length&&-1==d.i;l++)for(var u=0;u<s[l].length;u++)if(1==s[l][u]){d.i=l;break}for(var u=0;u<s[0].length&&-1==d.j;u++)for(var l=0;l<s.length;l++)if(1==s[l][u]){d.j=u;break}for(var p=new Array,l=0;l<s.length;l++){p[l]=new Array;for(var u=0;u<s[l].length;u++)1==s[l][u]&&(p[l-d.i][u-d.j]=1)}for(var g=new Pos(-(h-1)/2*o,-(c-1)/2*i),v=0;h>v;v++)for(var f=0;c>f;f++)if(1==p[v][f]){var m=new Pos(g.i+v*o,g.j+f*i);if(r++,a){var y=void 0;a.length>=r?(y=a[r-1],y.visible=!0):(y=new Block,a.push(y),n.addChild(y),a==this.doubleNextBlockArray&&(y.alpha=.5)),y.horizontalCenter=m.j,y.verticalCenter=m.i,y.width=i,y.height=o,y.img.source=this.TETRIS_NAMES[t]+"_png"}}for(var v=0;v<a.length;v++)v>=r&&(a[v].visible=!1)}}}},e.prototype.getTetrisInfo=function(t,e){if(t>=0&&t<this.tetrisInfo.length){var i=this.tetrisInfo[t];if(e>=0&&e<i.info.length)return i.info[e]}return null},e.prototype.getRandomTetrisInfo=function(){this.seed=ZJ.MathUtil.randomSeed(this.seed);var t=ZJ.MathUtil.randomRange(0,this.tetrisInfo.length,this.seed),e=this.tetrisInfo[t];this.seed=ZJ.MathUtil.randomSeed(this.seed);var i=ZJ.MathUtil.randomRange(0,e.info.length);return{tetrisType:t,state:i}},e.prototype.moveTetris=function(t,e){if(void 0===e&&(e=!0),this.isOver||!this.isPlay)return!1;var i=new Pos(this.curBlockBeginPos.i,this.curBlockBeginPos.j);t==Dir.left?i.j--:t==Dir.right?i.j++:t==Dir.down&&i.i++;for(var o=this.tetrisInfo[this.curBlockTetrisType].info[this.curBlockState],n=!0,s=[],r=0;r<o.length&&n;r++)for(var a=0;a<o[r].length;a++)if(1==o[r][a]){var h=new Pos(i.i+r,i.j+a);if(!(h.i<this.ROW&&h.j>=0&&h.j<this.COL)){n=!1;break}if(h.i>=0&&null!=this.blocks[h.i][h.j]&&-1==this.curBlockArray.indexOf(this.blocks[h.i][h.j])){n=!1;break}s.push(h)}if(n){this.curBlockBeginPos.i=i.i,this.curBlockBeginPos.j=i.j;for(var r in this.curBlockArray){var h=this.getPosByIndex(s[r].i,s[r].j),c=this.curBlockArray[r];if(c.row>=0&&c.row<this.ROW&&c.col>=0&&c.col<this.COL&&this.blocks[c.row][c.col]==c)return!0;c.x=h.x,c.y=h.y,c.row=s[r].i,c.col=s[r].j,c.row>=0&&0==c.visible&&(c.visible=!0)}return!e||this.isReceiver||this.isAI||ZJ.AudioManager.Instance.play("move",1,.5),!0}return!1},e.prototype.moveLeft=function(){this.isPlay&&!this.isOver&&(this.moveTetris(Dir.left),this.setTetrisShadow(),this.dispatchEvent(new egret.Event(EventName.MOVE_LEFT,!1,!1,null)))},e.prototype.moveRight=function(){this.isPlay&&!this.isOver&&(this.moveTetris(Dir.right),this.setTetrisShadow(),this.dispatchEvent(new egret.Event(EventName.MOVE_RIGHT,!1,!1,null)))},e.prototype.moveDown=function(t){void 0===t&&(t=!0),this.isPlay&&!this.isOver&&(this.isMoveFastDown&&console.log("moveFastDown"),this.moveTetris(Dir.down,t)||this.moveEndEvent(),this.dispatchEvent(new egret.Event(EventName.MOVE_DOWN,!1,!1,null)))},e.prototype.rotateOnce=function(){this.isPlay&&!this.isOver&&this.rotate()&&(this.setTetrisShadow(),this.dispatchEvent(new egret.Event(EventName.ROTATE,!1,!1,null)))},e.prototype.moveFastDown=function(){if(!this.isOver&&this.isPlay){this.isMoveFastDown=!0;for(var t=0;t<this.curBlockArray.length;t++){var e=this.curBlockArray[t],i=this.shadowBlocks[t];e.row=i.row,e.col=i.col,e.x=i.x,e.y=i.y,e.visible||(e.visible=!0)}for(var o=0,n=this.shadowBlocks;o<n.length;o++){var i=n[o];i.visible=!1}this.moveEndEvent(),this.isMoveFastDown=!1,this.dispatchEvent(new egret.Event(EventName.MOVE_FAST_DOWN,!1,!1,null))}},e.prototype.rotate=function(){if(!this.isOver&&this.isPlay){this.isReceiver||this.isAI||ZJ.AudioManager.Instance.play("rotate",1,.5);var t=this.curBlockState+1;t>=this.tetrisInfo[this.curBlockTetrisType].info.length&&(t=0);for(var e=this.tetrisInfo[this.curBlockTetrisType].info[t],i=!0,o=[],n=0;n<e.length&&i;n++)for(var s=0;s<e[n].length;s++)if(1==e[n][s]){var r=new Pos(this.curBlockBeginPos.i+n,this.curBlockBeginPos.j+s);if(!(r.i<this.ROW&&r.j>=0&&r.j<this.COL)||r.i>=0&&null!=this.blocks[r.i][r.j]){i=!1;break}o.push(r)}if(!i){for(var a=0,h=0,c=!1,n=0;n<e.length;n++)for(var s=0;s<e[n].length;s++)if(1==e[n][s]){var r=new Pos(this.curBlockBeginPos.i+n,this.curBlockBeginPos.j+s);if(r.i>this.ROW-1){var l=r.i-(this.ROW-1);h=l>h?l:h,c=!0}if(r.j<0){var l=r.j-0;a=a>l?l:a,c=!0}else if(r.j>this.COL-1){var l=r.j-(this.COL-1);a=l>a?l:a,c=!0}}if(c){var u=this.curBlockBeginPos.i-h,d=this.curBlockBeginPos.j-a;i=!0,o.length=0;for(var n=0;n<e.length&&i;n++)for(var s=0;s<e[n].length;s++)if(1==e[n][s]){var r=new Pos(u+n,d+s);if(!(r.i<this.ROW&&r.j>=0&&r.j<this.COL)||r.i>=0&&null!=this.blocks[r.i][r.j]){i=!1;break}o.push(r)}i&&(this.curBlockBeginPos.i=u,this.curBlockBeginPos.j=d)}}if(i){for(var n in this.curBlockArray){var r=this.getPosByIndex(o[n].i,o[n].j),p=this.curBlockArray[n];p.x=r.x,p.y=r.y,p.row=o[n].i,p.col=o[n].j,p.row<0&&p.visible?p.visible=!1:p.row>=0&&!p.visible&&(p.visible=!0)}return this.curBlockState=t,!0}return!1}},e.prototype.setTetrisShadow=function(){var t=this.getNearPushPos(this.curBlockTetrisType,this.curBlockState,this.curBlockBeginPos);if(null==t&&(t=this.curBlockBeginPos),null!=t){for(var e=this.getTetrisInfo(this.curBlockTetrisType,this.curBlockState),i=0,o=0;o<e.length;o++)for(var n=0;n<e[o].length;n++)if(1==e[o][n]){i++;var s=this.getPosByIndex(t.i+o,t.j+n),r=void 0;this.shadowBlocks.length>=i?r=this.shadowBlocks[i-1]:(r=new Block,r.width=this.BLOCK_WIDTH,r.height=this.BLOCK_HEIGHT,r.name="shadowBlock",this.shadowBlocks.push(r),this.addChildAt(r,0),r.img.source="block_Shadow_png"),r.visible=!0,r.x=s.x,r.y=s.y,r.row=t.i+o,r.col=t.j+n}for(var a=0;a<this.shadowBlocks.length;a++)if(a>=i)this.shadowBlocks[a].visible=!1;else for(var r=this.shadowBlocks[a],h=0;h<this.curBlockArray.length;h++){var c=this.curBlockArray[h];if(c.row==r.row&&c.col==r.col){r.visible=!1;break}}}else for(var a=0;a<this.shadowBlocks.length;a++)this.shadowBlocks[a].visible=!1;this.isAI||this.isReceiver},e.prototype.clearData=function(){this.score=0,this.clear_row=0,this.use_time=0;for(var t=0;t<this.blocks.length;t++)for(var e=0;e<this.blocks[t].length;e++){var i=this.blocks[t][e];null!=i&&(this.removeChild(i),this.blocks[t][e]=null)}for(var t=0;t<this.curBlockArray.length;t++){var i=this.curBlockArray[t];null!=i&&this.removeChild(i)}this.curBlockArray.length=0;for(var t=0;t<this.shadowBlocks.length;t++)this.shadowBlocks[t].visible=!1;for(var t=0;t<this.nextBlockArray.length;t++)this.nextBlockArray[t].visible=!1;for(var t=0;t<this.doubleNextBlockArray.length;t++)this.doubleNextBlockArray[t].visible=!1;this.cmdArray.length=0,this.randomNumArray=[],this.isOver=!1,this.addSpeedCount=0,this.time=0,this.timeOnEnterFrame=egret.getTimer(),this.curRanIndex=-1,this.curRanCount=0,this.isDoMoveEndEvent=!1,this.isMoveFastDown=!1,this.interval=this.DEF_INTERVAL,this.combo=-1,this.hasTouchDown=!1,this.hasReadySpeed=!1,this.speedLevel=1},e.prototype.onInterval=function(){this.isPlay&&!this.isOver&&this.moveDown(!1)},e.prototype.moveEndEvent=function(){var t=this;if(!this.isOver&&this.isPlay){this.isDoMoveEndEvent=!0;for(var e=0,i=this.curBlockArray;e<i.length;e++){var o=i[e];o.row>=0&&o.row<this.ROW&&o.col>=0&&o.col<this.COL?null==this.blocks[o.row][o.col]?this.blocks[o.row][o.col]=o:this.blocks[o.row][o.col]!=o&&this.removeChild(o):(this.removeChild(o),this.isOver=!0,this.overGame()),this.playLuodiAnim(o),this.isReceiver||this.isAI||ZJ.AudioManager.Instance.play("fall",1,.2)}this.curBlockArray.length=0;for(var n=new Array,s=this.ROW-1;s>=0;s--){for(var r=!0,a=this.blocks[s],h=0;h<this.COL;h++)if(null==a[h]){r=!1;break}r&&(n.push(s),this.clearUp(s))}var c=0;this.isReceiver||this.isAI||(this.isPlay=!1),n.length>0&&(c=this.playClearUpAnim(n)),this.isReceiver?this.fillEmptyRow(n):setTimeout(function(){t.fillEmptyRow(n)},c)}},e.prototype.playLuodiAnim=function(t){var e=this;if(!this.isAI&&!this.isReceiver){var i=new eui.Image;i.source="block_light_png",i.x=t.x,i.y=t.y,i.anchorOffsetX=7,i.anchorOffsetY=8,this.addChild(i),egret.Tween.get(i).to({alpha:0},200,egret.Ease.circIn).call(function(){e.removeChild(i)
});var o=t.x+t.width/2,n=t.y+t.height,s=new egret.MovieClip(this.luodiFactory.generateMovieClipData("luodi"));s.addEventListener(egret.MovieClipEvent.FRAME_LABEL,function(t){"@end"==t.frameLabel&&e.removeChild(s)},this),this.addChild(s),s.x=o,s.y=n,s.play(1)}},e.prototype.playClearUpAnim=function(t){var e=this;if(!this.isAI&&!this.isReceiver){var i=300;return ZJ.ResManager.instance.loadMovieClip("xiaochu","xiaochu",function(i,o){for(var n=function(i){var n=t[i],s=e.getPosByIndex(n,0).y+e.BLOCK_HEIGHT/2,r=new egret.MovieClip(o.generateMovieClipData("xiaochu"));r.addEventListener(egret.MovieClipEvent.FRAME_LABEL,function(t){"@end"==t.frameLabel&&e.removeChild(r)},e),e.addChild(r),e.setChildIndex(r,e.numChildren-1),r.x=e.width/2,r.y=s,r.scaleX=2,r.scaleY=2,r.visible=!1,r.frameRate=12,r.visible=!0,r.gotoAndPlay(1)},s=0;s<t.length;s++)n(s)}),i}},e.prototype.addObsBlock=function(t){var e=this;if(!this.isOver){if(this.isDoMoveEndEvent)return void setTimeout(function(){e.addObsBlock(t)},300);this.isReceiver||this.isAI||ZJ.AudioManager.Instance.play("addObs");for(var i=!1,o=0;o<this.ROW;o++)for(var n=this.blocks[o],s=0;s<n.length;s++){var r=this.blocks[o][s];if(null!=r){r.row-=t,r.row>=0?this.blocks[r.row][s]=r:(r.visible=!1,i=!0),this.blocks[o][s]=null;var a=this.getPosByIndex(r.row,s);r.x=a.x,r.y=a.y}}for(var h=ZJ.MathUtil.randomSeed(ZJ.Util.timeStamp()),c=0;t>c;c++){var o=this.ROW-1-c;h=ZJ.MathUtil.randomSeed(h);for(var l=ZJ.MathUtil.randomRange(0,this.COL,h),s=0;s<this.COL;s++)if(s!=l){var r=new Block;this.addChild(r),r.img.source="block_obstacle_png",r.width=this.BLOCK_WIDTH,r.height=this.BLOCK_HEIGHT,r.name="block_obs",r.row=o,r.col=s;var a=this.getPosByIndex(o,s);r.x=a.x,r.y=a.y,r.tetrisType=-10,this.blocks[o][s]=r}}this.setTetrisShadow(),this.checkBgm(),i&&this.overGame(),this.dispatchEvent(new egret.Event(EventName.ADD_OBS_BLOCK,!1,!1,t))}},e.prototype.clearUp=function(t){this.clear_row++;for(var e=0;e<this.COL;e++){var i=this.blocks[t][e];null!=i&&(this.removeChild(i),this.blocks[t][e]=null)}},e.prototype.fillEmptyRow=function(t){var e=this;if(t.length>0){for(var i=t[0],o=i-1;o>=0;o--)if(-1==t.indexOf(o)){for(var n=this.blocks[o],s=0;s<this.COL;s++){var r=n[s];null!=r&&(r.y=this.getPosByIndex(i,s).y,this.blocks[i][s]=r,r.row=i,n[s]=null)}i--}if(t.length>=3){if(this.combo++,this.dispatchEvent(new egret.Event(EventName.SPECIAL_X,!1,!1,{uprow:t.length+this.combo,combo:this.combo})),this.isReceiver||this.isAI||ZJ.AudioManager.Instance.play("specialX"),this.combo>=1&&!this.isReceiver&&!this.isAI){var s=this.combo;s>3&&(s=3),ZJ.AudioManager.Instance.play("combo"+s)}}else this.combo=-1,this.isReceiver||this.isAI||ZJ.AudioManager.Instance.play("normalX",1,.5);this.score+=this.getAddScore(t.length,this.combo),this.dispatchEvent(new egret.Event(EventName.ADD_SCORE,!1,!1,this.score));var a=this.speedLevel+1,h=!0;do{var c=this.getLockedScore(a);if(null!=c&&this.score>=c){var l=a+1,u=this.getLockedScore(l);null!=u&&this.score>=u?(h=!0,a++):h=!1}else h=!1}while(h);var d=this.getLockedScore(a);null!=d&&this.score>=d?(this.speedLevel=a,this.speedReadyEvent(),setTimeout(function(){e.interval=e.getSpeedByLevel(e.speedLevel),e.hasReadySpeed=!1,e.dispatchEvent(new egret.Event(EventName.SPEED,!1,!1,e.speedLevel))},3e3)):this.speedLevel!=a-1&&(this.speedLevel=a-1,this.speedReadyEvent(),setTimeout(function(){e.interval=e.getSpeedByLevel(e.speedLevel),e.hasReadySpeed=!1,e.dispatchEvent(new egret.Event(EventName.SPEED,!1,!1,e.speedLevel))},3e3))}else this.combo=-1;this.checkBgm(),this.createRandomTetris(),this.isGameOver()?this.overGame():(this.time=this.interval,this.isPlay=!0),this.isDoMoveEndEvent=!1,this.dispatchEvent(new egret.Event(EventName.MOVE_END_EVENT,!1,!1,this.getCurData()))},e.prototype.getNearPushPos=function(t,e,i){for(var o=this.getTetrisInfo(t,e),n=[],s=0;4>s;s++)for(var r=o.length-1;r>=0;r--)if(1==o[r][s]){n.push(new Pos(r,s));break}for(var a=[],h=0,c=n;h<c.length;h++){var l=c[h],u=i.j+l.j;if(u>=0&&u<this.COL)for(var r=i.i+l.i+1;r<=this.ROW;r++)if(r==this.ROW||r>=0&&null!=this.blocks[r][u]){for(var d=new Pos(r-1-l.i,u-l.j),p=!0,g=0;g<o.length&&p;g++)for(var v=0;v<o[g].length;v++)if(1==o[g][v]){var f=new Pos(d.i+g,d.j+v);if(f.i<0||f.i>=this.ROW||f.j<0||f.j>=this.COL||f.i>=0&&null!=this.blocks[f.i][f.j]){p=!1;break}}!p||d.i==i.i&&d.j==i.j||a.push(d);break}}var m;if(a.length>0)for(var y=0,C=a;y<C.length;y++){var l=C[y];null==m?m=new Pos(l.i,l.j):l.i<m.i&&(m.i=l.i,m.j=l.j)}return m},e.prototype.getFitAIPos=function(){if(this.isPlay&&!this.isOver){for(var t=this.curBlockTetrisType,e=this.curBlockState,i=[],o=0,n=0;n<this.tetrisInfo[t].info.length;n++){e>=this.tetrisInfo[t].info.length&&(e=0);for(var s=this.getTetrisInfo(t,e),r=1-s[0].length;r<=this.COL-1;r++){var a=new Pos(this.curBlockBeginPos.i,r),h=this.getNearPushPos(t,e,a),c=void 0;if(null!=h){c=h.j<this.bornBeginPos.j?100*Math.abs(r-this.bornBeginPos.j)+10+o:100*Math.abs(r-this.bornBeginPos.j)+o;var l=this.calAIScore(h,s);i.push({pos:h,score:l,rotate:o,priority:c})}}e++,o++}i.sort(function(t,e){return t.score>e.score?-1:t.score<e.score?1:t.priority>e.priority?-1:t.priority<e.priority?1:0});var u=this.AIWrongProArray[this.curAILevel-1],d=ZJ.MathUtil.randomRange(0,101),p=0;u>d&&(p=ZJ.MathUtil.randomRange(1,3),p>=i.length&&(p=i.length-1));var g;return p>=0&&p<i.length&&(g=i[p]),g}},e.prototype.setFitAIPos=function(t){var e=this,i=t.pos,o=t.rotate,n=i.j-this.curBlockBeginPos.j,s=this.addSpeedCount;1==this.curAILevel&&(s=0);var r=this.AIRotateIntervalTimeArray[this.curAILevel-1]-10*s,a=this.AIMoveIntervalTimeArray[this.curAILevel-1]-10*s,h=this.AIReadyRotateTimeArray[this.curAILevel-1]-25*s,c=this.AIMoveIntervalTimeArray[this.curAILevel-1]-25*s,l=this.AIReadyMoveFastDownTimeArray[this.curAILevel-1]-20*s;40>r&&(r=40),40>a&&(a=40),80>h&&(h=80),80>c&&(c=80),80>l&&(l=80);for(var u=h,d=0;d<this.AIRotateIdArray.length;d++)clearTimeout(this.AIRotateIdArray[d]);for(var d=0;d<this.AIMoveIdArray.length;d++)clearTimeout(this.AIMoveIdArray[d]);clearTimeout(this.AIMoveFastDownId),this.AIRotateIdArray.length=0,this.AIMoveIdArray.length=0;for(var d=0;o>d;d++)this.AIRotateIdArray.push(setTimeout(function(){e.rotateOnce()},u)),u+=r;u+=c;for(var d=0;d<Math.abs(n);d++)this.AIMoveIdArray.push(setTimeout(function(){n>0?e.moveRight():0>n&&e.moveLeft()},u)),u+=a;u+=l,this.AIMoveFastDownId=setTimeout(function(){e.moveFastDown()},u)},e.prototype.calAIScore=function(t,e){for(var i=new Array,o=0;o<this.ROW;o++){i[o]=new Array;for(var n=0;n<this.COL;n++)null!=this.blocks[o][n]?i[o][n]=1:i[o][n]=0}for(var s=[],r=0;r<e.length;r++)for(var a=0;a<e[r].length;a++)1==e[r][a]&&(i[t.i+r][t.j+a]=1,s.push(new Pos(t.i+r,t.j+a)));var h=this.getLandingHeight(t),c=this.getErodedPieceCellsMetric(i,s),l=this.getBoardRowTransition(i),u=this.getBoardColTransition(i),d=this.getBoardBuriedHoles(i),p=this.getBoardWells(i);return-1*h+c+-1*l+-1*u+-4*d+-1*p},e.prototype.getLandingHeight=function(t){return this.ROW-1-t.i},e.prototype.getErodedPieceCellsMetric=function(t,e){for(var i=0,o=0,n=[],s=0;s<t.length;s++){for(var r=!0,a=0;a<t[s].length;a++)if(0==t[s][a]){r=!1;break}r&&n.push(s)}for(var h=0,c=e;h<c.length;h++){var l=c[h];-1!=n.indexOf(l.i)&&o++}return i*o},e.prototype.getBoardRowTransition=function(t){for(var e=0,i=0;i<t.length;i++)for(var o=t[i],n=0;n<o.length;n++)0==n?0==o[n]&&e++:n==o.length-1?0==o[n]&&e++:(0==o[n]&&1==o[n+1]&&e++,1==o[n]&&0==o[n+1]&&e++);return e},e.prototype.getBoardColTransition=function(t){for(var e=0,i=0;i<this.COL;i++)for(var o=0;o<this.ROW;o++)0==o?0==t[o][i]&&e++:o==t.length-1?0==t[o][i]&&e++:(0==t[o][i]&&1==t[o+1][i]&&e++,1==t[o][i]&&0==t[o+1][i]&&e++);return e},e.prototype.getBoardBuriedHoles=function(t){for(var e=0,i=0;i<t.length;i++)for(var o=0;o<this.ROW;o++)if(1==t[o][i]){for(;++o<this.ROW;)0==t[o][i]&&e++;break}return e},e.prototype.getBoardWells=function(t){for(var e=0,i=0;i<this.COL;i++)for(var o=0;o<this.ROW;o++)if(0==i){if(0==t[o][i]&&1==t[o][i+1]){for(var n=o,s=n;++o<this.ROW&&0==t[o][i]&&1==t[o][i+1];)s=o;for(var r=s-n+1;r>1;)e+=r*(r-1),r--}}else if(i==this.COL-1){if(0==t[o][i]&&1==t[o][i-1]){for(var n=o,s=n;++o<this.ROW&&0==t[o][i]&&1==t[o][i-1];)s=o;for(var r=s-n+1;r>1;)e+=r*(r-1),r--}}else if(0==t[o][i]&&1==t[o][i-1]&&1==t[o][i+1]){for(var n=o,s=n;++o<this.ROW&&0==t[o][i]&&1==t[o][i-1]&&1==t[o][i+1];)s=o;for(var r=s-n+1;r>1;)e+=r*(r-1),r--}return e},e.prototype.speedReadyEvent=function(){!this.hasReadySpeed&&this.interval>this.MIN_INTERVAL&&(this.hasReadySpeed=!0,this.dispatchEvent(new egret.Event(EventName.SPEED_READY)))},e.prototype.AIDoSomething=function(){var t=this.getFitAIPos();null!=t&&this.setFitAIPos(t)},e.prototype.checkBgm=function(){if(!this.isReceiver&&!this.isAI&&!this.isOver){for(var t=!1,e=0;6>e&&!t;e++)for(var i=0;i<this.COL;i++)if(null!=this.blocks[e][i]){t=!0;break}t?"danger"!=ZJ.AudioManager.Instance.bgm&&(ZJ.AudioManager.Instance.stopBgm(),ZJ.AudioManager.Instance.bgm="danger",ZJ.AudioManager.Instance.playBgm()):"bgm"!=ZJ.AudioManager.Instance.bgm&&(ZJ.AudioManager.Instance.stopBgm(),ZJ.AudioManager.Instance.bgm="bgm",ZJ.AudioManager.Instance.playBgm())}},e.prototype.getCurData=function(){for(var t=new Array,e=0;e<this.ROW;e++){t[e]=new Array;for(var i=0;i<this.COL;i++)null==this.blocks[e][i]?t[e][i]=-1:t[e][i]=this.blocks[e][i].tetrisType}var o={};return o.blockDatas=t,o},e.prototype.checkDataSame=function(t){for(var e=this.getCurData(),i=t.blockDatas,o=e.blockDatas,n=0;n<this.ROW;n++)for(var s=0;s<this.COL;s++)if(i[n][s]!=o[n][s])return!1;return!0},e.prototype.setDatas=function(t){for(var e=0;e<this.curBlockArray.length;e++)this.removeChild(this.curBlockArray[e]);this.curBlockArray.length=0;for(var i=t.blockDatas,o=0;o<this.ROW;o++)for(var n=0;n<this.COL;n++){var s=this.blocks[o][n],r=i[o][n];if(-1==r)null!=s&&(this.removeChild(s),this.blocks[o][n]=null);else{if(null==s){s=new Block,s.width=this.BLOCK_WIDTH,s.height=this.BLOCK_HEIGHT,s.row=o,s.col=n,this.addChild(s);var a=this.getPosByIndex(o,n);s.x=a.x,s.y=a.y,this.blocks[o][n]=s}-10==r?s.img.source="block_obstacle_png":s.img.source=this.TETRIS_NAMES[r]+"_png",s.tetrisType=r}}this.createRandomTetris()},e.prototype.rePlay=function(){this.clearData();for(var t=0;3>t;t++)this.randomNumArray.push(this.getRandomNumByRule());this.isPlay=!0},e.prototype.startPlay=function(){for(var t=0;3>t;t++)this.randomNumArray.push(this.getRandomNumByRule());this.isPlay=!0},e.prototype.isGameOver=function(){for(var t=0,e=this.curBlockArray;t<e.length;t++){var i=e[t];if(i.row>=0&&i.row<this.ROW&&i.col>=0&&i.col<this.COL&&null!=this.blocks[i.row][i.col])return!0}return!1},e.prototype.overGame=function(){this.isOver=!0,this.dispatchEvent(new egret.Event(EventName.GAME_OVER))},e.prototype.getPosByIndex=function(t,e){return{x:e*this.BLOCK_WIDTH,y:t*this.BLOCK_HEIGHT}},e.prototype.getCenterPosByIndex=function(t,e){var i=new Pos(-(this.ROW-1)/2*this.BLOCK_HEIGHT,-(this.COL-1)/2*this.BLOCK_WIDTH);return{x:i.j+e*this.BLOCK_WIDTH,y:i.i+t*this.BLOCK_HEIGHT}},e.prototype.getIntervalTime=function(){return this.interval},e.prototype.getScoreInfoByRule=function(t,e){var i=ZJ.TableManager.instance.tables[xlsx.cfg_c_score];return null!=i[t]?ZJ.TableManager.instance.tables[xlsx.cfg_c_score][t][e]:null},e.prototype.getAddScore=function(t,e){0>e&&(e=0);var i="";1==t?i=xlsx.c_score_remove_one:2==t?i=xlsx.c_score_remove_two:3==t?i=xlsx.c_score_remove_three:4==t&&(i=xlsx.c_score_remove_four);var o=0,n=this.getScoreInfoByRule(this.speedLevel,i),s=this.getScoreInfoByRule(this.speedLevel,xlsx.c_score_remove_combo);return null!=n&&null!=s&&(o=n+s*e),o},e.prototype.getSpeedByLevel=function(t){return this.getScoreInfoByRule(t,xlsx.c_score_speed)},e.prototype.getLockedScore=function(t){return this.getScoreInfoByRule(t,xlsx.c_score_speed_score)},e.prototype.setAI=function(t){this.isAI=t},e.prototype.setAILevel=function(t){1>t?t=1:t>3&&(t=3),this.curAILevel=t},e.prototype.setReceiver=function(t){this.isReceiver=t},e.prototype.pushCmd=function(t,e){var i={cmd:t,data:e};this.cmdArray.push(i)},e.prototype.destroy=function(){},e}(eui.Component);__reflect(Tetris.prototype,"Tetris",["eui.UIComponent","egret.DisplayObject"]);var Pos=function(){function t(t,e){this.i=t,this.j=e}return t}();__reflect(Pos.prototype,"Pos");var TetrisInfo=function(){function t(t){this.info=t}return t}();__reflect(TetrisInfo.prototype,"TetrisInfo");var ZJ;!function(t){var e=function(t){function e(e,i,o,n){var s=t.call(this,e,i,o,n)||this;return s.data=null,s}return __extends(e,t),e}(egret.Event);t.ChannelDataEvent=e,__reflect(e.prototype,"ZJ.ChannelDataEvent")}(ZJ||(ZJ={}));var ZJ;!function(t){var e=function(){function t(){}return t.FRAME=30,t.UP=0,t.DOWN=1,t.LEFT=2,t.RIGHT=3,t}();t.CommonConfig=e,__reflect(e.prototype,"ZJ.CommonConfig");var i=function(){function t(){}return t.TABLE_LOADED="TABLE_LOADED",t.SOCKET_CONNECTED="SOCKET_CONNECTED",t.SOCKET_CLOSE="SOCKET_CLOSE",t.SOCKET_DATA="SOCKET_DATA",t.GESTURE_DIRECT="GESTURE_DIRECT",t.CHANNEL_DATA="CHANNEL_DATA",t}();t.CommonEventName=i,__reflect(i.prototype,"ZJ.CommonEventName")}(ZJ||(ZJ={}));var MatchView=function(t){function e(){var e=t.call(this)||this;return e.skinName="MatchViewSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.idInput.textDisplay.size=80,this.idInput.textDisplay.textAlign="center",this.idInput.textDisplay.verticalAlign="middle",this.idInput.textDisplay.left=0,this.idInput.textDisplay.right=0,this.idInput.textDisplay.top=0,this.idInput.textDisplay.bottom=0,this.matchInput.textDisplay.size=80,this.matchInput.textDisplay.textAlign="center",this.matchInput.textDisplay.verticalAlign="middle",this.matchInput.textDisplay.left=0,this.matchInput.textDisplay.right=0,this.matchInput.textDisplay.top=0,this.matchInput.textDisplay.bottom=0,this.login.addEventListener("touchTap",function(){e.sendLogin(),e.log.text="已点击登录"},this),this.match.addEventListener("touchTap",function(){var t=e.matchInput.text;e.matchRoom(t),e.log.text="已点击匹配"},this),this.ready.addEventListener("touchTap",function(){e.readyGame(),e.log.text="已点击准备"},this),this.a10010.addEventListener("touchTap",function(){ZJ.SocketManager.instance.send(11010,{processData:ZJ.Util.objToByteArray("11010的数据").bytes}),e.log.text="已点击发送11010"},this),this.a10011.addEventListener("touchTap",function(){ZJ.SocketManager.instance.send(11011,{resultData:ZJ.Util.objToByteArray("11011的数据").bytes}),e.log.text="已点击发送11011"},this),this.log=new eui.Label,this.log.horizontalCenter=450,this.log.verticalCenter=-200,this.log.textAlign="center",this.log.verticalAlign="middle",this.addChild(this.log)},e.prototype.sendLogin=function(){ModuleConfig.compile.danji||ZJ.SocketManager.instance.send(11e3,{openId:this.idInput.text,nickname:yyGameConfig.nickname,avatarUrl:yyGameConfig.avatarUrl,timestamp:yyGameConfig.timestamp,sign:yyGameConfig.sign})},e.prototype.matchRoom=function(t){ZJ.SocketManager.instance.send(11001,{matchId:t})},e.prototype.readyGame=function(){ZJ.SocketManager.instance.send(11002,{})},e}(ZJ.ViewBase);__reflect(MatchView.prototype,"MatchView");var Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){var e=this;t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){e.tickerInterval=setInterval(function(){egret.ticker.update()},e,1e3/30)},egret.lifecycle.onResume=function(){clearInterval(e.tickerInterval)},egret.registerImplementation("eui.IAssetAdapter",new AssetAdapter),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,this.createGameScene()];case 1:return e.sent(),[4,platform.login()];case 2:return e.sent(),[4,platform.getUserInfo()];case 3:return t=e.sent(),console.log(t),[2]}})})},e.prototype.createGameScene=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return egret.ImageLoader.crossOrigin="anonymous",ModuleConfig.compile.yy&&onPKLoading(),[4,ZJ.ResManager.instance.init(this.stage)];case 1:return e.sent(),[4,ZJ.ResManager.instance.loadGroup("realpreload")];case 2:return e.sent(),ZJ.UIManager.instance.init(this),ZJ.UIManager.instance.uiLayers=ModuleConfig.uiLayers,ZJ.UIManager.instance.uiDatas=ModuleConfig.uiDatas,t=this.GetLoadingView(),[4,ZJ.ResManager.instance.loadGroup("sample",0,t)];case 3:return e.sent(),ZJ.TableManager.instance.init(),ZJ.SocketManager.instance.init(),1==ModuleConfig.compile.yy&&onPKFinishLoading(),ModuleStartUp.init(),1==ModuleConfig.compile.yy&&onPKStart(),[2]}})})},e.prototype.GetLoadingView=function(){var t=null,e=null;return ModuleConfig.compile.need_loading&&(ModuleConfig.compile.danji?e=LoadingView:ModuleConfig.compile.yy?e=YYLoadingView:ModuleConfig.compile.ali?e=AliLoadingView:ModuleConfig.compile.chushou&&(e=ChushouLoadingView)),null!=e&&(ModuleConfig.uiDatas[UIName.Loading].viewClass=e,t=ZJ.UIManager.instance.openView(UIName.Loading)),t},e.prototype.onEnterFrame=function(){},e}(eui.UILayer);__reflect(Main.prototype,"Main");var AliLoadingView=function(t){function e(){var e=t.call(this)||this;return e.intervalID=0,e.ran1=0,e.ran2=0,e.SEND_PROGRESS=6,e.progressIndex=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);var e=ZJ.ShapeUtil.getRect(0,1,this.stage.stageWidth,this.stage.stageHeight);this.addChild(e);var i=500,o=new eui.ProgressBar;o.skinName="YYLoadingPBSkin",this.progress=o,this.progress.width=450,this.progress.height=62,this.progress.minimum=0,this.progress.maximum=100,this.progress.horizontalCenter=0,this.progress.y=i+435,this.progress.scaleX=1.3,this.progress.scaleY=1.3,this.progress.labelFunction=function(t,e){return t+"%"},this.addChild(this.progress);var n=new eui.Image;n.source="load_img03_png",n.horizontalCenter=0,n.y=i+630,n.width=510,n.height=100,n.alpha=.2,this.addChild(n),this.load3=new eui.Label,this.load3.text="等待对手加入游戏...",this.load3.horizontalCenter=0,this.load3.y=i+660,this.load3.size=40,this.load3.textColor=16777215,this.addChild(this.load3),this.startCount(),ZJ.SocketManager.instance.connectByUrlAli({ip:ModuleConfig.ip,port:ModuleConfig.port})},e.prototype.startCount=function(){var t=this;this.intervalID=setInterval(function(){t.ran2=Math.min(t.ran2+8*Math.random()+2,99),t.progress.value=Math.floor((t.ran1+t.ran2)/2)},200)},e.prototype.onProgress=function(t,e){this.ran1=Math.floor(t/e*100);var i=Math.floor(t/e*100);100==i?ALISDK.CatcherSDK.instance().updateProgress(ALISDK.CatcherSDK.ProgressState.COMPLETED,i):(this.progressIndex==this.SEND_PROGRESS-1&&ALISDK.CatcherSDK.instance().updateProgress(ALISDK.CatcherSDK.ProgressState.PROGRESSING,i),this.progressIndex=++this.progressIndex%this.SEND_PROGRESS)},e.prototype.onDestroy=function(){return t.prototype.onDestroy.call(this),0},e}(ZJ.ViewBase);__reflect(AliLoadingView.prototype,"AliLoadingView");var ChushouLoadingView=function(t){function e(){var e=t.call(this)||this;return e.intervalID=0,e.ran1=0,e.ran2=0,e.SEND_PROGRESS=10,e.progressIndex=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);var e=ZJ.ShapeUtil.getRect(0,1,this.stage.stageWidth,this.stage.stageHeight);this.addChild(e)},e.prototype.startCount=function(){var t=this;this.intervalID=setInterval(function(){t.ran2=Math.min(t.ran2+8*Math.random()+2,99),t.progress.value=Math.floor((t.ran1+t.ran2)/2)},200)},e.prototype.onProgress=function(t,e){this.progressIndex==this.SEND_PROGRESS-1&&ChushouSDK.instance.csNotifyLoadProgress(t/e*100),this.progressIndex=++this.progressIndex%this.SEND_PROGRESS},e.prototype.onDestroy=function(){return t.prototype.onDestroy.call(this),0},e}(ZJ.ViewBase);__reflect(ChushouLoadingView.prototype,"ChushouLoadingView");var ChushouSDK=function(){function t(){this.gameRoomId="",this.role="",this.title="分享标题",this.image="/resource/assets/egret_icon.png",this.description="分享描述",this.enableMic="1",this.enableAudioOutput="1",this.csAuthRequestData=null}return Object.defineProperty(t,"instance",{get:function(){return this._instance||(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.csAuthRequest=function(t){var e=this;console.log("csAuthRequest"),csAuthRequest('{"h5AppName" : "'+ModuleConfig.compile.chushou_h5AppName+'","launchMode" : "'+chushouGameConfig.launchMode+'","inviteMode" : "'+chushouGameConfig.inviteMode+'","gameRoomId" : "'+chushouGameConfig.gameRoomId+'"}',function(i){console.log("cb csAuthRequest"),console.log(i);var o=JSON.parse(i);e.csAuthRequestData=o,t&&t(o)})},t.prototype.csJoinRoom=function(t){console.log("csJoinRoom "+this.gameRoomId),csJoinRoom('{"accessToken" : "'+this.csAuthRequestData.accessToken+'","gameRoomId" : "'+this.gameRoomId+'","role" : "'+this.csAuthRequestData.role+'"}',function(e){console.log("cb csJoinRoom"),console.log(e.toString()),t&&t(JSON.parse(e))})},t.prototype.csQuitRoom=function(t){console.log("csQuitRoom"),csQuitRoom('{"accessToken" : "'+this.csAuthRequestData.accessToken+'","gameRoomId" : "'+this.gameRoomId+'"}',function(e){console.log("cb csQuitRoom"),t&&t(JSON.parse(e))})},t.prototype.csInviteToGame=function(t){console.log("csInviteToGame"),csInviteToGame('{"accessToken" : "'+this.csAuthRequestData.accessToken+'","gameRoomId" : "'+this.gameRoomId+'","inviteMode" : "'+chushouGameConfig.inviteMode+'","title" : "'+this.title+'","description" : "'+this.description+'","image" : "'+this.image+'"}',function(e){console.log("cb csInviteToGame"),t&&t(JSON.parse(e))})},t.prototype.csKickOutUser=function(t){console.log("csKickOutUser"),csKickOutUser('{"accessToken" : "'+this.csAuthRequestData.accessToken+'","targetUid" : "sl23859","gameRoomId" : "'+this.gameRoomId+'"}',function(e){console.log("cb csKickOutUser"),t&&t(JSON.parse(e))})},t.prototype.csShareRoom=function(t){console.log("csShareRoom"),csShareRoom('{"accessToken" : "'+this.csAuthRequestData.accessToken+'","gameRoomId" : "'+this.gameRoomId+'","title" : "'+this.title+'","description" : "'+this.description+'","image" : "'+this.image+'"}',function(e){console.log("cb csShareRoom"),t&&t(JSON.parse(e))})},t.prototype.csShareRecord=function(t){console.log("csShareRecord"),csShareRecord('{"accessToken" : "'+this.csAuthRequestData.accessToken+'","gameRecordId" : "119844","title" : "'+this.title+'","description" : "'+this.description+'","image" : "'+this.image+'"}',function(e){console.log("cb csShareRecord"),t&&t(JSON.parse(e))})},t.prototype.csGetFriendList=function(t){console.log("csGetFriendList"),csGetFriendList('{"accessToken" : "'+this.csAuthRequestData.accessToken+'","numPerPage" : "10","breakpoint" : "18823-ffgh-cc08"}',function(e){console.log("cb csGetFriendList"),t&&t(JSON.parse(e))})},t.prototype.csGetUserRelationship=function(t,e){for(var i="",o=0;o<t.length;o++)i+=t[o],o!=t.length-1&&(i+=",");console.log("csGetUserRelationship"),csGetUserRelationship('{"accessToken" : "'+this.csAuthRequestData.accessToken+'","users" : "'+i+'"}',function(t){console.log("cb csGetUserRelationship"),e&&e(JSON.parse(t))})},t.prototype.csFollowUser=function(t,e){console.log("csFollowUser"),csFollowUser('{"accessToken" : "'+this.csAuthRequestData.accessToken+'","targetUid" : "'+t+'"}',function(t){console.log("cb csFollowUser"),e&&e(JSON.parse(t))})},t.prototype.csEnableMic=function(t){console.log("csEnableMic"),csEnableMic('{"accessToken" : "'+this.csAuthRequestData.accessToken+'","enableMic" : '+this.enableMic+"}",function(e){console.log("cb csEnableMic"),t&&t(JSON.parse(e))})},t.prototype.csEnableAudioOutput=function(t){console.log("csEnableAudioOutput"),csEnableAudioOutput('{"accessToken" : "'+this.csAuthRequestData.accessToken+'","enableAudioOutput" : "'+this.enableAudioOutput+'"}',function(e){console.log("cb csEnableAudioOutput"),t&&t(JSON.parse(e))})},t.prototype.onUserVolumeUpdate=function(t){console.log("onUserVolumeUpdate"),onUserVolumeUpdate(function(e){console.log("cb onUserVolumeUpdate"),t&&t(JSON.parse(e))})},t.prototype.csExitGame=function(t){console.log("csExitGame "+this.csAuthRequestData.accessToken),this.csQuitRoom(),csExitGame('{"accessToken" : "'+this.csAuthRequestData.accessToken+'"}')},t.prototype.csNotifyLoadProgress=function(t,e){console.log("csNotifyLoadProgress"),csNotifyLoadProgress('{"total" : "100","progress" : "'+t+'"}')},t.prototype.onNetworkStatusChange=function(t){console.log("onNetworkStatusChange"),onNetworkStatusChange(function(e){console.log("cb onNetworkStatusChange"),t&&t(JSON.parse(e))})},t.prototype.csGetAPIVersionInfo=function(t){console.log("csGetAPIVersionInfo"),csGetAPIVersionInfo('{"h5AppName" : "'+ModuleConfig.compile.chushou_h5AppName+'","launchMode" : "'+chushouGameConfig.launchMode+'","inviteMode" : "'+chushouGameConfig.inviteMode+'","gameRoomId" : "'+this.gameRoomId+'"}',function(e){console.log("cb csGetAPIVersionInfo"),t&&t(JSON.parse(e))})},t.prototype.csInvokeRecharge=function(t,e){console.log("csInvokeRecharge"),csInvokeRecharge('{"accessToken" : "'+this.csAuthRequestData.accessToken+'","paymentScene" : "'+t+'"}',function(t){console.log("cb csInvokeRecharge"),e&&e(JSON.parse(t))})},t.prototype.onBalanceChanged=function(t){console.log("onBalanceChanged")},t.prototype.csPurchaseProps=function(t){console.log("csPurchaseProps"),csPurchaseProps('{"accessToken" : "'+this.csAuthRequestData.accessToken+'","cpOrderId" : "prop7865421","cpPropName" : "双倍积分卡","cpPropId" : "1","payAmount" : "500"}',function(e){console.log("cb csPurchaseProps"),t&&t(JSON.parse(e))})},t.prototype.csPayEntryFee=function(t,e,i,o){console.log("csPayEntryFee"),csPayEntryFee('{"accessToken" : "'+this.csAuthRequestData.accessToken+'","cpOrderId" : "'+t+'","cpPropName" : "'+i+'","cpPropId" : "'+e+'"}',function(t){console.log("cb csPayEntryFee"),o&&o(JSON.parse(t))})},t.prototype.csCheckEntryFee=function(t){console.log("csCheckEntryFee"),csCheckEntryFee('{"accessToken" : "'+this.csAuthRequestData.accessToken+'"}',function(e){console.log("cb csCheckEntryFee"),t&&t(JSON.parse(e))})},t}();__reflect(ChushouSDK.prototype,"ChushouSDK");var YYLoadingView=function(t){function e(){var e=t.call(this)||this;return e.intervalID=0,e.ran1=0,e.ran2=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);var e=ZJ.ShapeUtil.getRect(0,1,this.stage.stageWidth,this.stage.stageHeight);this.addChild(e);var i=new eui.Image;i.source="loading_bg_png",i.height=1920,i.percentWidth=100,this.addChild(i),i.horizontalCenter=0;var o=500,n=new eui.Group;this.addChild(n),n.horizontalCenter=0,n.y=o,ZJ.ResManager.instance.loadMovieClip("yylangren","yylangren",function(t){n.addChild(t),t.scaleX=1.5,t.scaleY=1.5,t.x=-195,t.gotoAndPlay("tiao",-1)});var s=new eui.ProgressBar;s.skinName="YYLoadingPBSkin",this.progress=s,this.progress.width=450,this.progress.height=62,this.progress.minimum=0,this.progress.maximum=100,this.progress.horizontalCenter=0,this.progress.y=o+435,this.progress.scaleX=1.3,this.progress.scaleY=1.3,this.progress.labelFunction=function(t,e){return t+"%"},this.addChild(this.progress);var r=new eui.Image;r.source="load_img03_png",r.horizontalCenter=0,r.y=o+630,r.width=510,r.height=100,r.alpha=.2,this.addChild(r),this.load3=new eui.Label,this.load3.text="等待对手加入游戏...",this.load3.horizontalCenter=0,this.load3.y=o+660,this.load3.size=40,this.load3.textColor=16777215,this.addChild(this.load3),this.startCount()},e.prototype.startCount=function(){var t=this;this.intervalID=setInterval(function(){t.ran2=Math.min(t.ran2+8*Math.random()+2,99),t.progress.value=Math.floor((t.ran1+t.ran2)/2)},200)},e.prototype.onProgress=function(t,e){this.ran1=Math.floor(t/e*100),this.progress.value=Math.floor((this.ran1+this.ran2)/2)},e.prototype.onDestroy=function(){return t.prototype.onDestroy.call(this),clearInterval(this.intervalID),0},e}(ZJ.ViewBase);__reflect(YYLoadingView.prototype,"YYLoadingView");var xlsx;!function(t){t.cfg_c_score="shared/c_score.json",t.c_score_id="A",t.c_score_speed="B",t.c_score_speed_score="C",t.c_score_remove_one="D",t.c_score_remove_two="E",t.c_score_remove_three="F",t.c_score_remove_four="G",t.c_score_remove_combo="H"}(xlsx||(xlsx={}));