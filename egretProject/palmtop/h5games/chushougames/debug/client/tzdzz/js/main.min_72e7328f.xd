var __reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n},__awaiter=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(o,a){function r(t){try{h(i.next(t))}catch(e){a(e)}}function s(t){try{h(i["throw"](t))}catch(e){a(e)}}function h(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(r,s)}h((i=i.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function n(t){return function(e){return i([t,e])}}function i(n){if(o)throw new TypeError("Generator is already executing.");for(;h;)try{if(o=1,a&&(r=a[2&n[0]?"return":n[0]?"throw":"next"])&&!(r=r.call(a,n[1])).done)return r;switch(a=0,r&&(n=[0,r.value]),n[0]){case 0:case 1:r=n;break;case 4:return h.label++,{value:n[1],done:!1};case 5:h.label++,a=n[1],n=[0];continue;case 7:n=h.ops.pop(),h.trys.pop();continue;default:if(r=h.trys,!(r=r.length>0&&r[r.length-1])&&(6===n[0]||2===n[0])){h=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){h.label=n[1];break}if(6===n[0]&&h.label<r[1]){h.label=r[1],r=n;break}if(r&&h.label<r[2]){h.label=r[2],h.ops.push(n);break}r[2]&&h.ops.pop(),h.trys.pop();continue}n=e.call(t,h)}catch(i){n=[6,i],a=0}finally{o=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,a,r,s,h={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},ZJ;!function(t){var e=function(e){function n(){var n=e.call(this)||this;return n.skinName=t.Util.getClassName(n)+"Skin",n}return __extends(n,e),n.prototype.onDestroy=function(){return 0},n}(eui.Component);t.ComponentBase=e,__reflect(e.prototype,"ZJ.ComponentBase",["eui.UIComponent","egret.DisplayObject"])}(ZJ||(ZJ={}));var ZJ;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.setData=function(t){},e.prototype.show=function(){},e.prototype.onProgress=function(t,e){},e.prototype.onDestroy=function(){return t.prototype.onDestroy.call(this)},e}(t.ComponentBase);t.ViewBase=e,__reflect(e.prototype,"ZJ.ViewBase",["RES.PromiseTaskReporter"])}(ZJ||(ZJ={}));var ZJ;!function(t){var e=function(){function t(t,e,n){void 0===e&&(e=0),void 0===n&&(n=null),this.viewName="",this.layer=0,this.viewClass=null,this.viewName=t,this.layer=e,this.viewClass=n}return t}();t.UIData=e,__reflect(e.prototype,"ZJ.UIData")}(ZJ||(ZJ={}));var Cmd;!function(t){t[t.useGoat=0]="useGoat",t[t.requestData=1]="requestData",t[t.checkData=2]="checkData"}(Cmd||(Cmd={}));var GameView=function(t){function e(){var e=t.call(this)||this;return e.INTERVAL=50,e.INTERVAL_PING=3e4,e.PLAYER_1="player1",e.PLAYER_2="player2",e.TOTAL_TIME=120,e.GOAT_CD_TIME=4,e.COL_DIS=0,e.COL_DIS_PERCENT=.33,e.PLAYER1_ENDY=250,e.PLAYER2_ENDY=1670,e.PLAYER1_STARTY=1720,e.PLAYER2_STARTY=200,e.GOAT_MOVEPIX_PER=116,e.GOAT_OFFSETX=0,e.AI_INTERVAL=4.5,e.AI_INTERVAL_0=4.2,e.DIFF_TIMESTAMP=1500,e.GOAT_SCALE_ARRAY=[.4,.55,.7,.85,1],e.roadTipArray=[],e.roadTipGroupArray=[],e.roadGroupArray=new Array,e.nextGroupArray=new Array,e.nextImgArray=new Array,e.time=0,e.goatUIGroupArray=[],e.roadGoatArray={},e.roadGoatHitArray={},e.score1=0,e.score2=0,e.coolTime=0,e.timeOnEnterFrame=0,e.isWait=!1,e.isPlay=!1,e.isCooling=!1,e.ranGoat1Array=[],e.ranGoat2Array=[],e.ranGoatIndex=0,e.ranGoat2Index=0,e.player1_lvArray=[],e.next1DefHorizontal=-30,e.isDanji=!1,e.isServer=!1,e.startTimestamp=0,e.diffTimestamp=0,e.cmdPool=[],e.timeActionArray=[],e.roadAnimArray=[],e.intervalPing=0,e.goatInfos={},e.skinName="GameViewSkin",e}return __extends(e,t),e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this);var n=document.createElement("canvas"),i=n.getContext("experimental-webgl"),o=i.getExtension("WEBGL_debug_renderer_info"),a=i.getParameter(o.UNMASKED_RENDERER_WEBGL);a.indexOf("Apple")>-1&&a.indexOf("A11")>-1&&375==window.screen.width&&812==window.screen.height&&(this.topGroup.top=70),this.next1DefHorizontal=this.next1.horizontalCenter,this.seed=ZJ.Util.timeStamp(),this.isDanji=ModuleConfig.compile.danji,this.bar.getChildAt(0).source="bar_bg_png",this.bar.getChildAt(1).source="bar_1_png",this.bar.labelFunction=function(t,e){return""};for(var r=this.goatGroup.numChildren-1;r>=0;r--)this.goatUIGroupArray.push(this.goatGroup.getChildAt(r));for(var r=1;5>=r;r++){var s=this.getGoatInfoByType(r.toString());this.goatInfos[r]=s}setTimeout(function(){ZJ.ShapeUtil.setArcMask(e.head1,e.head1.width/2,0,1),ZJ.ShapeUtil.setArcMask(e.head2,e.head2.width/2,0,1)},50),this.countDown=new ZJ.MyCountDown,this.countDown.label=this.timeText,this.timeGroup.addChild(this.countDown),this.countDown.horizontalCenter=0,this.countDown.label.size=60,this.countDown.cb=function(){if(e.isDanji)e.gameOver();else if(e.isServer){var t=0;e.score2>e.score1?t=e.player2.playerId:e.score2<e.score1&&(t=e.player1.playerId),ZJ.SocketManager.instance.send(11012,{winPlayerId:t})}},this.countDown.setSecond(120);var h=new eui.Group;h.horizontalCenter=0,h.verticalCenter=0,this.addChild(h),this.daojishiAnim=ZJ.ResManager.instance.loadDragonBones("daojishi"),this.daojishiAnim.visible=!1,h.addChild(this.daojishiAnim);for(var r=0;r<this.roadGroup.numChildren;r++){var c=this.roadGroup.getChildAt(r).getChildAt(0),l=c.getChildAt(0);this.roadTipGroupArray.push(c),this.roadTipArray.push(l)}for(var u=function(t){var n=p.roadGroup.getChildAt(t),i=t+1;n.addEventListener("touchTap",function(){if(e.isPlay)if(n.numChildren>0){if(e.canUseGoat1){var t=e.getRanGoatFromRanArray(e.PLAYER_1);null!=t&&((e.isDanji||e.isServer)&&e.useGoat(e.PLAYER_1,i,t),e.isDanji||(e.isServer?e.pushTimeAction(function(n){return ZJ.SocketManager.instance.send(11010,{processData:ZJ.Util.objToByteArray({cmd:Cmd.useGoat,usePlayerId:e.playerId,road:i,ranGoat:t,time:n}).bytes}),!0}):ZJ.SocketManager.instance.send(11010,{processData:ZJ.Util.objToByteArray({cmd:Cmd.useGoat,usePlayerId:e.playerId,road:i,ranGoat:t}).bytes})))}e.updateRoadTip(e.canUseGoat1,i)}else e.updateRoadTip(e.canUseGoat1,i)},p),p.roadGroupArray.push(n)},p=this,r=0;r<this.roadGroup.numChildren;r++)u(r);for(var r=this.player1_nextGroup.numChildren-1;r>=0;r--){var c=this.player1_nextGroup.getChildAt(r);this.nextGroupArray.push(c),this.nextImgArray.push(c.getChildAt(1)),r<this.player1_nextGroup.numChildren-1&&this.player1_lvArray.push(c.getChildAt(2))}this.start.visible=!0,this.countDown.visible=!1,this.start.addEventListener("touchTap",function(){if(e.isDanji){e.start.visible=!1,e.setWait(!1),e.clear(),e.updateScoreText();var t=ZJ.MathUtil.randomSeed(e.seed+54321),n=ZJ.MathUtil.randomSeed(e.seed+123);e.resetRandomGoatNumArray(e.seed,t,n),e.updateReviewPic(),e.daojishiAnim.visible=!0,e.daojishiAnim.addDBEventListener(dragonBones.EgretEvent.COMPLETE,function(t){e.daojishiAnim.animation.stop(),e.daojishiAnim.visible=!1,e.playGame()},e),e.daojishiAnim.animation.play("newAnimation",1)}},this),this.over.visible=!1,this.over.addEventListener("touchTap",function(){e.setWait(!0),e.over.visible=!1,e.start.visible=!0},this);for(var r=0;r<this.roadTipGroupArray.length;r++){var d=ZJ.ResManager.instance.loadDragonBones("jiantou");d.animation.stop(),this.roadTipGroupArray[r].addChild(d),d.x=this.roadTipGroupArray[r].width/2+3,d.y=this.roadTipGroupArray[r].height-222+13,this.roadAnimArray.push(d)}var g=ZJ.MathUtil.randomSeed(this.seed+54321),f=ZJ.MathUtil.randomSeed(g+123);this.resetRandomGoatNumArray(this.seed,g,f),this.canUseGoat1=!0,this.canUseGoat2=!0,this.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this),this.timeOnEnterFrame=egret.getTimer(),this.intervalID=setInterval(function(){e.onInterval()},this.INTERVAL),this.setWait(!0),ZJ.SocketManager.instance.addEventListener(ZJ.CommonEventName.SOCKET_CONNECTED,this.onSocketConnected,this),ZJ.SocketManager.instance.addEventListener(ZJ.CommonEventName.SOCKET_DATA,this.onSocketData,this),this.isDanji?ZJ.UIManager.instance.destroyView(UIName.Loading):(this.connect(),this.start.labelDisplay.text="等待中",this.start.visible=!1,ZJ.UIManager.instance.destroyView(UIName.Loading))},e.prototype.onEnterFrame=function(t){var e=this,n=egret.getTimer(),i=this.timeOnEnterFrame,o=n-i;if(this.update(o),this.isPlay)for(var a=function(){var t=r.cmdPool.shift(),n=t.data,i=t.cmd;if(i==Cmd.useGoat){var o=n.road,a=n.ranGoat,s=n.usePlayerId,h=s==r.player1.playerId?r.PLAYER_1:r.PLAYER_2,c=n.time;r.useGoat(h,o,a),r.isServer?r.pushTimeAction(function(t){return ZJ.SocketManager.instance.send(11010,{processData:ZJ.Util.objToByteArray({cmd:Cmd.useGoat,usePlayerId:s,road:o,ranGoat:a,time:t}).bytes}),!0}):r.pushTimeAction(function(t){var n=t,i=n-c;return i>0&&(e.diffTimestamp+=i),e.diffTimestamp>=e.DIFF_TIMESTAMP&&ZJ.SocketManager.instance.send(11010,{processData:ZJ.Util.objToByteArray({cmd:Cmd.requestData}).bytes}),!0})}else if(i==Cmd.requestData)r.isServer&&r.pushTimeAction(function(t){return ZJ.SocketManager.instance.send(11011,{score:e.score1,resultData:ZJ.Util.objToByteArray({data:e.getCurData(),time:t}).bytes}),!0});else if(i==Cmd.checkData){for(var l=-10,u=r.cmdPool.length-1;u>=0;u--)if(r.cmdPool[u].cmd==Cmd.checkData){l=u;break}-10!=l&&(r.cmdPool.splice(0,l),t=r.cmdPool.shift(),n=t.data),r.setNewData(n.data),r.diffTimestamp=0}},r=this;this.cmdPool.length>0;)a();this.timeOnEnterFrame=egret.getTimer()},e.prototype.update=function(t){if(this.isCooling){this.coolTime+=t;var e=this.coolTime/(1e3*this.GOAT_CD_TIME),n=this.nextImgArray[0];this.isWait||n.visible||(n.visible=!0),e>=1?(e=1,this.bar.getChildAt(1).source="bar_1_png",this.isCooling=!1,this.canUseGoat1=!0,this.updateRoadTip(this.canUseGoat1)):this.bar.getChildAt(1).source="bar_0_png",this.bar.value=100*e,this.next1.horizontalCenter=this.next1DefHorizontal+e*this.bar.width}(this.isWait||this.isPlay)&&(this.runAllGoat(t/1e3),this.checkAllHit(),this.checkRunEnd())},e.prototype.getRandomGoat=function(){return this.seed=ZJ.MathUtil.randomSeed(this.seed),this.isWait?ZJ.MathUtil.randomRange(1,6,this.seed):this.time<=30?ZJ.MathUtil.randomRange(1,4,this.seed):this.time<=60?ZJ.MathUtil.randomRange(1,5,this.seed):ZJ.MathUtil.randomRange(1,6,this.seed)},e.prototype.getRanGoatFromRanArray=function(t){return t==this.PLAYER_1?(this.isWait&&this.ranGoat1Array.push(this.getRandomGoat()),this.ranGoatIndex<this.ranGoat1Array.length?this.ranGoat1Array[this.ranGoatIndex]:null):(this.isWait&&this.ranGoat2Array.push(this.getRandomGoat()),this.ranGoat2Index<this.ranGoat2Array.length?this.ranGoat2Array[this.ranGoat2Index]:null)},e.prototype.getRandomRoad=function(){return this.seed=ZJ.MathUtil.randomSeed(this.seed),ZJ.MathUtil.randomRange(1,6,this.seed)},e.prototype.onInterval=function(){},e.prototype.canUseGoat=function(t,e){if(t==this.PLAYER_1){if(this.canUseGoat1)return!0}else if(t==this.PLAYER_2&&this.canUseGoat2)return!0;return!1},e.prototype.useGoat=function(t,e,n){var i=this;if((this.isWait||this.isPlay)&&this.canUseGoat(t,e)){var o=this.createNewGoat(t,n,e);if(t==this.PLAYER_1){o.y+=o.height;var a=this.getGoatHitArray(this.PLAYER_1,e.toString());if(a&&a.length>0){var r=a[a.length-1];o.y-o.height+o.height*this.COL_DIS_PERCENT<r.y&&(o.y=r.y+o.height-o.height*this.COL_DIS_PERCENT)}if(a=this.getGoatHitArray(this.PLAYER_2,e.toString()),a&&a.length>0){var s=a[0];o.y-o.height+o.height*this.COL_DIS_PERCENT<s.y+s.height&&(o.y=s.y+s.height+o.height-o.height*this.COL_DIS_PERCENT)}}else if(t==this.PLAYER_2){o.y-=o.height;var a=this.getGoatHitArray(this.PLAYER_2,e.toString());if(a&&a.length>0){var r=a[a.length-1];o.y+o.height-o.height*this.COL_DIS_PERCENT>r.y&&(o.y=r.y-o.height+o.height*this.COL_DIS_PERCENT)}if(a=this.getGoatHitArray(this.PLAYER_1,e.toString()),a&&a.length>0){var s=a[0];o.y+o.height-o.height*this.COL_DIS_PERCENT>s.y-s.height&&(o.y=s.y-s.height-o.height+o.height*this.COL_DIS_PERCENT)}}var h=this.getGoatArray(e.toString());h.push(o),t==this.PLAYER_1?(this.isCooling=!0,this.coolTime=0,this.ranGoatIndex++,this.updateRoadTip(this.canUseGoat1,e)):t==this.PLAYER_2&&(this.ranGoat2Index++,this.isDanji||this.isServer?this.cd2IntevalId=setTimeout(function(){i.canUseGoat2=!0},1e3*this.GOAT_CD_TIME):this.canUseGoat2=!0),this.updateReviewPic()}},e.prototype.runAllGoat=function(t){for(var e=1;5>=e;e++){for(var n=this.getGoatArray(e.toString()),i=0,o=n;i<o.length;i++){var a=o[i];a.player==this.PLAYER_1?a.y-=a.speed*t:a.y+=a.speed*t}for(var r=this.getGoatHitArray(this.PLAYER_1,e.toString()),s=0,h=r;s<h.length;s++){var a=h[s];a.y-=a.speed*t}r=this.getGoatHitArray(this.PLAYER_2,e.toString());for(var c=0,l=r;c<l.length;c++){var a=l[c];a.y+=a.speed*t}}},e.prototype.checkAllHit=function(){for(var t=1;5>=t;t++)for(var e=this.getGoatArray(t.toString()),n=0,i=e;n<i.length;n++){var o=i[n];this.checkHit(o,t.toString())}},e.prototype.checkHit=function(t,e){for(var n=0;2>n;n++){var i=void 0;i=0==n?this.PLAYER_1:this.PLAYER_2;for(var o=this.getGoatHitArray(i,e),a=0,r=o;a<r.length;a++){var s=r[a];if(this.isNear(t,s))return void this.onHitBegin(t,s,e)}}for(var h=this.getGoatArray(e),c=0,l=h;c<l.length;c++){var s=l[c];if(t!=s&&this.isNear(t,s))return void this.onHitBegin(t,s,e)}},e.prototype.isNear=function(t,e){if(t.player==this.PLAYER_1&&e.player==this.PLAYER_2){var n=e.y+e.height,i=e.y,o=t.y-t.height;if(o<=n-this.COL_DIS-t.height*this.COL_DIS_PERCENT&&o>i)return!0}else if(t.player==this.PLAYER_2&&e.player==this.PLAYER_1){var n=e.y,a=e.y-e.height,r=t.y+t.height;if(r>=a+this.COL_DIS+t.height*this.COL_DIS_PERCENT&&n>r)return!0}else if(t.player==this.PLAYER_1&&e.player==this.PLAYER_1){var n=e.y,s=e.y-e.height,o=t.y-t.height;if(o<n-this.COL_DIS-t.height*this.COL_DIS_PERCENT&&o>s)return!0}else if(t.player==this.PLAYER_2&&e.player==this.PLAYER_2){var n=e.y+e.height,h=e.y,r=t.y+t.height;if(r>h+this.COL_DIS+t.height*this.COL_DIS_PERCENT&&n>r)return!0}return!1},e.prototype.onHitBegin=function(t,e,n){var i=this;t.touchGoat=e,t.player!=e.player&&(e.touchGoat=t,e.playAttack()),setTimeout(function(){i.ShowHitEffect(t,e)},650),t.playAttack(),ZJ.Util.rmArrayObj(this.getGoatArray(n),t),this.getGoatHitArray(t.player,n).push(t),ZJ.Util.rmArrayObj(this.getGoatArray(n),e);var o=this.getGoatHitArray(e.player,n);-1==o.indexOf(e)&&o.push(e);var a=this.calGoatGroupSpeed(n);this.setGroupSpeed(a,n)},e.prototype.checkRunEnd=function(){for(var t=1;5>=t;t++){for(var e=this.getGoatArray(t.toString()),n=0,i=e;n<i.length;n++){var o=i[n];this.IsRunEnd(o)&&this.RunEndEvent(o,t.toString(),!1)}e=this.getGoatHitArray(this.PLAYER_1,t.toString());for(var a=0,r=e;a<r.length;a++){var o=r[a];this.IsRunEnd(o)&&this.RunEndEvent(o,t.toString(),!0)}e=this.getGoatHitArray(this.PLAYER_2,t.toString());for(var s=0,h=e;s<h.length;s++){var o=h[s];this.IsRunEnd(o)&&this.RunEndEvent(o,t.toString(),!0)}}},e.prototype.IsRunEnd=function(t){if(t.player==this.PLAYER_1){if(t.y<=this.PLAYER1_ENDY)return!0}else if(t.player==this.PLAYER_2&&t.y>=this.PLAYER2_ENDY)return!0;return!1},e.prototype.RunEndEvent=function(t,e,n){var i=t.score;if(null!=t.touchGoat&&t.player!=t.touchGoat.player){for(var o=0,a=0,r=this.getGoatHitArray(t.touchGoat.player,e);a<r.length;a++){r[a]}i+=Math.floor(o)}if(this.addScore(t.player,i),n?ZJ.Util.rmArrayObj(this.getGoatHitArray(t.player,e),t):ZJ.Util.rmArrayObj(this.getGoatArray(e),t),this.goatUIGroupArray[+e-1].removeChild(t),n){for(var s=t.player==this.PLAYER_1?this.PLAYER_2:this.PLAYER_1,h=this.getGoatHitArray(s,e),c=void 0;c=h.pop();)this.goatUIGroupArray[+e-1].removeChild(c);var l=this.calGoatGroupSpeed(e);this.setGroupSpeed(l,e)}},e.prototype.sendPing=function(){this.isDanji||(this.intervalPing=setInterval(function(){ZJ.SocketManager.instance.send(11004)},this.INTERVAL_PING))},e.prototype.sendLogin=function(){this.isDanji||ZJ.SocketManager.instance.send(1e4,{openId:ChushouSDK.instance.csAuthRequestData.openUid,sign:"sign",timestamp:ZJ.Util.timeStamp(),appId:1234,params:[ChushouSDK.instance.csAuthRequestData.nickname,ChushouSDK.instance.csAuthRequestData.gender,ChushouSDK.instance.csAuthRequestData.avatar]})},e.prototype.connect=function(){if(!this.isDanji){var t=ModuleConfig.ws+"://"+ModuleConfig.ip+":"+ModuleConfig.port;ZJ.SocketManager.instance.connectByUrl(t)}},e.prototype.onSocketConnected=function(){var t=this;ModuleConfig.compile.chushou&&ChushouSDK.instance.csAuthRequest(function(){t.sendPing(),t.sendLogin()})},e.prototype.onSocketData=function(t){var e=this,n=t.data,i=n.data;switch(n.protoID){case 1e4:this.sendMatch(ChushouSDK.instance.csAuthRequestData.csGroupId.toString()),this.playerId=i.playerId;break;case 10001:this.sendReady(),ChushouSDK.instance.gameRoomId=i.roomId,ChushouSDK.instance.csJoinRoom();break;case 11002:0==i.result?console.log("ready success"):(ChushouSDK.instance.csExitGame(),console.log("ready fail"));break;case 11003:this.startTimestamp=0,this.pushTimeAction(function(t){return e.startTimestamp=t,console.log("服务器时间: "+e.startTimestamp),!0}),this.onCountDown(i);break;case 11007:0!=i.result&&this.setLeave();break;case 11010:this.onReceiveGameData(i);break;case 11011:this.onReceiveCheckData(i);break;case 11012:this.onReceiveWin(i);break;case 11015:for(var o=i.millisecond,a=0;a<this.timeActionArray.length;a++){var r=this.timeActionArray[a](o);1==r&&(ZJ.Util.rmArrayObj(this.timeActionArray,this.timeActionArray[a]),a--)}}},e.prototype.sendMatch=function(t){ZJ.SocketManager.instance.send(10001,{gameMode:1,matchType:1,matchId:t})},e.prototype.sendReady=function(){ZJ.SocketManager.instance.send(11002)},e.prototype.onCountDown=function(t){var e=this;console.log("开始倒计时:"+t.readyTime),ZJ.UIManager.instance.destroyView(UIName.Settle),ModuleConfig.compile.chushou&&ChushouSDK.instance.csPayEntryFee(function(t){"0"==t.code?console.log("成功扣除入场费"):("100"==t.code&&console.log("触手豆余额不足"),console.log(t.errMsg))}),this.isServer=!1,this.seed=t.seeds[0];for(var n=this.seed,i=this.seed,o=0;o<t.playerInfos.length;o++)if(t.playerInfos[o].playerId==this.playerId){this.player1=t.playerInfos[o];for(var a=0;o+1>a;a++)n=ZJ.MathUtil.randomSeed(n+o+1);0==o?(this.isServer=!0,console.log("isServer")):console.log("isClient")}else{this.player2=t.playerInfos[o];for(var a=0;o+1>a;a++)i=ZJ.MathUtil.randomSeed(i+o+1)}this.player1.avatarUrl&&(this.head1.source=this.player1.avatarUrl),this.player2.avatarUrl&&(this.head2.source=this.player2.avatarUrl),this.updateSex(this.player1,this.player1.gender),this.updateSex(this.player2,this.player2.gender),this.start.visible=!1,this.setWait(!1),this.clear(),this.updateScoreText(),this.resetRandomGoatNumArray(this.seed,n,i),this.updateReviewPic(),this.daojishiAnim.visible=!0,this.daojishiAnim.addDBEventListener(dragonBones.EgretEvent.COMPLETE,function(t){e.daojishiAnim.animation.stop(),e.daojishiAnim.visible=!1,e.playGame()},this),this.daojishiAnim.animation.play("newAnimation",1)},e.prototype.onReceiveGameData=function(t){var e=t.playerId,n=ZJ.Util.bytesToObj(t.processData);if(e==this.player2.playerId){var i=n.cmd;this.cmdPool.push({cmd:i,data:n})}},e.prototype.onReceiveCheckData=function(t){var e=t.playerId,n=(t.score,ZJ.Util.bytesToObj(t.resultData));e==this.player2.playerId&&this.cmdPool.push({cmd:Cmd.checkData,data:n})},e.prototype.onReceiveWin=function(t){if(0==t.result){var e=void 0;if(e=t.winPlayerId==this.playerId?1:0==t.winPlayerId?0:2,null==ZJ.UIManager.instance.getView(UIName.Settle)){var n=ZJ.UIManager.instance.openView(UIName.Settle);n.setSettle(e,this.player1,this.player2,this.score1,this.score2)}this.isPlay=!1}else console.log("游戏结果通知失败")},e.prototype.updateReviewPic=function(){for(var t=0;4>t;t++){var e=this.ranGoat1Array[t+this.ranGoatIndex],n=this.nextImgArray[t];null!=e?(n.source="rabbitUI"+e+"_png",t>=1&&(this.player1_lvArray[t-1].source="lv"+e+"_png")):(n.source="",t>=1&&(this.player1_lvArray[t-1].source=""))}var i=this.ranGoat2Array[this.ranGoat2Index];null!=i?(this.player2_next.source="rabbitUI"+i+"_png",this.player2_lv.source="lv"+i+"_png"):(this.player2_next.source="",this.player2_lv.source="")},e.prototype.gameOver=function(){this.over.visible=!0,this.isCooling=!1,this.score1>this.score2?console.log("胜利"):this.score1==this.score2?console.log("平手"):console.log("失败"),this.isPlay=!1,clearInterval(this.timeIntervalId)},e.prototype.playGame=function(){var t=this;this.isPlay=!0,this.countDown.visible=!0,this.countDown.start(120),this.time=0,this.timeIntervalId=setInterval(function(){t.time+=1},1e3),this.isDanji&&this.setAI(!0)},e.prototype.setAI=function(t){var e=this;clearInterval(this.aiIntervalId),t&&(this.useGoat(this.PLAYER_2,this.getAIChooseRoad(this.PLAYER_2),this.getRanGoatFromRanArray(this.PLAYER_2)),this.aiIntervalId=setInterval(function(){e.useGoat(e.PLAYER_2,e.getAIChooseRoad(e.PLAYER_2),e.getRanGoatFromRanArray(e.PLAYER_2))},1e3*this.AI_INTERVAL))},e.prototype.clear=function(){this.time=0,this.diffTimestamp=0,this.roadGoatArray={},this.roadGoatHitArray={},this.ranGoatIndex=0,this.ranGoat2Index=0,this.cmdPool.length=0;for(var t=0;t<this.goatUIGroupArray.length;t++)this.goatUIGroupArray[t].removeChildren();this.score1=0,this.score2=0,clearTimeout(this.cd1IntevalId),clearTimeout(this.cd2IntevalId),clearInterval(this.timeIntervalId),this.isCooling=!1,this.coolTime=0,this.bar.value=100,this.next1.horizontalCenter=this.next1DefHorizontal+1*this.bar.width,this.bar.getChildAt(1).source="bar_1_png",this.canUseGoat1=!0,this.canUseGoat2=!0;this.nextImgArray[0];this.updateRoadTip(this.canUseGoat1)},e.prototype.setWait=function(t){var e=this;this.isWait=t,clearInterval(this.waitIntervalId),t?(this.isPlay=!1,this.uiGroup.visible=!1,this.canUseGoat1=!0,this.useGoat(this.PLAYER_1,this.getAIChooseRoad(this.PLAYER_1),this.getRanGoatFromRanArray(this.PLAYER_1)),this.waitIntervalId=setInterval(function(){e.useGoat(e.PLAYER_1,e.getAIChooseRoad(e.PLAYER_1),e.getRanGoatFromRanArray(e.PLAYER_1))},1e3*this.AI_INTERVAL_0),this.countDown.visible=!1,this.score1Label.visible=!1,this.score2Label.visible=!1,this.roadGroup.visible=!1,this.setAI(!0)):(this.setAI(!1),this.uiGroup.visible=!0,this.countDown.visible=!0,this.score1Label.visible=!0,this.score2Label.visible=!0,this.roadGroup.visible=!0)},e.prototype.getGoatArray=function(t){return this.roadGoatArray[t]||(this.roadGoatArray[t]=new Array),this.roadGoatArray[t]},e.prototype.getGoatHitArray=function(t,e){var n=t+"_"+e;return this.roadGoatHitArray[n]||(this.roadGoatHitArray[n]=new Array),this.roadGoatHitArray[n]},e.prototype.setGroupSpeed=function(t,e){var n=this.getGoatHitArray(this.PLAYER_1,e);if(n)for(var i=0,o=n;i<o.length;i++){var a=o[i];a.speed=t}if(n=this.getGoatHitArray(this.PLAYER_2,e))for(var r=0,s=n;r<s.length;r++){var a=s[r];a.speed=-1*t}},e.prototype.addScore=function(t,e){t==this.PLAYER_1?this.score1+=e:t==this.PLAYER_2&&(this.score2+=e),this.updateScoreText()},e.prototype.updateScoreText=function(){this.score1Label.text=this.score1.toString(),this.score2Label.text=this.score2.toString()},e.prototype.calGoatSpeed=function(t){var e=t.strength/t.weight;return(null==e||e==Number.NaN||e>1)&&(e=1),-1>e&&(e=-1),e*this.GOAT_MOVEPIX_PER},e.prototype.calGoatGroupSpeed=function(t){var e=0,n=0,i=0,o=0,a=this.getGoatHitArray(this.PLAYER_1,t);if(a)for(var r=0,s=a;r<s.length;r++){var h=s[r];e+=h.strength,i+=h.weight}if(a=this.getGoatHitArray(this.PLAYER_2,t))for(var c=0,l=a;c<l.length;c++){var h=l[c];n+=h.strength,o+=h.weight}var u=(e-n)/(i+o);return(null==u||u==Number.NaN||u>1)&&(u=1),-1>u&&(u=-1),u*this.GOAT_MOVEPIX_PER},e.prototype.getGoatInfoByType=function(t){var e=ZJ.TableManager.instance.tables[xlsx.cfg_c_goat][t];return{weight:e.B,strength:e.C,score:e.D}},e.prototype.getCurData=function(){for(var t=[],e=1;5>=e;e++){var n=e.toString(),i=this.getGoatArray(n);if(null!=i){t[n]=new Array;for(var o=t[n],a=0,r=i;a<r.length;a++){var s=r[a];o.push({x:s.x,y:s.y,strength:s.strength,weight:s.weight,score:s.score,ranGoat:s.ranGoat,player:s.player==this.PLAYER_1?1:2})}}}for(var h=[],c=1;5>=c;c++){for(var n=c.toString(),e=1;2>=e;e++){var l=1==e?this.PLAYER_1:this.PLAYER_2,u=this.getGoatHitArray(l,n);if(null!=u){null==h[n]&&(h[n]={}),h[n][l]=new Array;for(var o=h[n][l],p=0,d=u;p<d.length;p++){var s=d[p];o.push({x:s.x,y:s.y,strength:s.strength,weight:s.weight,score:s.score,ranGoat:s.ranGoat})}}}var g=this.getGoatHitArray(this.PLAYER_1,n),f=this.getGoatHitArray(this.PLAYER_2,n);g.length>0&&f.length>0&&(g[0].touchGoat=f[0],f[0].touchGoat=g[0])}var y={nohitData:t,hitData:h,ranGoatIndex:this.ranGoatIndex,ranGoat2Index:this.ranGoat2Index,score1:this.score1,score2:this.score2};return y},e.prototype.setNewData=function(t){for(var e=new Array,n=0;n<this.goatUIGroupArray.length;n++)for(var i=this.goatUIGroupArray[n],o=0;o<i.numChildren;o++)e.push(i.getChildAt(o));for(var a in this.roadGoatArray)this.roadGoatArray[a].length=0;for(var a in this.roadGoatHitArray)this.roadGoatHitArray[a].length=0;var r=t.nohitData,s=t.hitData;if(null!=s)for(var o=0;2>o;o++)for(var h=0==o?this.PLAYER_1:this.PLAYER_2,c=h==this.PLAYER_1?this.PLAYER_2:this.PLAYER_1,n=1;5>=n;n++){var l=n.toString();if(null!=s[l]){var u=s[l][c];if(null!=u)for(var p=0,d=u;p<d.length;p++){var g=d[p],f=e.shift();null==f?f=this.createNewGoat(h,g.ranGoat,n):f.player=h,this.setGoatData(f,n,g),f.playEndAttackAnim(),this.getGoatHitArray(h,l).push(f)}}}if(null!=r)for(var n=1;5>=n;n++){var l=n.toString(),u=r[l];if(null!=u)for(var y=0,v=u;y<v.length;y++){var g=v[y],f=e.shift(),h=1==g.player?this.PLAYER_2:this.PLAYER_1;null==f?f=this.createNewGoat(h,g.ranGoat,n):f.player=h,this.setGoatData(f,n,g),f.playWalk(),f.speed=this.calGoatSpeed(f),this.getGoatArray(l).push(f)}}for(var n=1;5>=n;n++)for(var l=n.toString(),m=this.calGoatGroupSpeed(l),o=0;2>o;o++){var h=0==o?this.PLAYER_1:this.PLAYER_2,A=m*(0==o?1:-1),_=this.getGoatHitArray(h,l);if(null!=_)for(var E=0,C=_;E<C.length;E++){var f=C[E];f.speed=A}}for(var I=0,R=e;I<R.length;I++){var f=R[I];null!=f&&(f.anim&&f.anim.parent.removeChild(f.anim),f.parent.removeChild(f))}this.ranGoat2Index=t.ranGoatIndex,this.ranGoatIndex=t.ranGoat2Index,this.score1=t.score2,this.score2=t.score1,this.updateScoreText(),this.updateReviewPic()},e.prototype.setGoatData=function(t,e,n){t.x=n.x,t.y=1920-n.y,t.strength=n.strength,t.score=n.score,t.weight=n.weight,t.ranGoat=n.ranGoat,t.width=215*this.GOAT_SCALE_ARRAY[t.ranGoat-1],t.height=139*this.GOAT_SCALE_ARRAY[t.ranGoat-1],t.anchorOffsetX=t.width/2,t.player==this.PLAYER_1?(t.anchorOffsetY=t.height,t.setAnim("rabbit3"),this.goatUIGroupArray[e-1].addChild(t)):t.player==this.PLAYER_2&&(t.anchorOffsetY=0,t.setAnim("rabbit4"),this.goatUIGroupArray[e-1].addChildAt(t,0))},e.prototype.resetRandomGoatNumArray=function(t,e,n){this.ranGoat1Array.length=0,this.ranGoat2Array.length=0,this.ranGoat1Array=this.getNewGoatArray(t,e),this.ranGoat2Array=this.getNewGoatArray(t,n)},e.prototype.ShowHitEffect=function(t,e){var n,i=this;n=t.player==this.PLAYER_1&&e.player==this.PLAYER_1?t.y>e.y?t.y-t.height:e.y-e.height:t.player==this.PLAYER_2&&e.player==this.PLAYER_2?t.y<e.y?e.y:t.y:t.player==this.PLAYER_1?t.y-t.height:e.y-t.height,ZJ.ResManager.instance.loadMovieClip("bomb","bomb",function(o,a){i.addChild(o),i.goatGroup.addChild(o);var r=(t.x+e.x)/2;o.x=r,o.y=n,o.scaleX=-1,o.addEventListener(egret.MovieClipEvent.FRAME_LABEL,function(t){"@end"==t.frameLabel&&i.goatGroup.removeChild(o)},i),o.play(1)})},e.prototype.updateRoadTip=function(t,e){if(t)for(var n=0;n<this.roadTipGroupArray.length;n++)this.roadTipArray[n].source="right_road_png",this.roadAnimArray[n].visible||(this.roadAnimArray[n].visible=!0,this.roadAnimArray[n].animation.gotoAndPlayByFrame("newAnimation",0));else for(var n=0;n<this.roadTipGroupArray.length;n++)e&&n==e-1?this.roadTipArray[n].source="wrong_road_png":this.roadTipArray[n].source="right_road_png",this.roadAnimArray[n].animation.stop(),this.roadAnimArray[n].visible=!1},e.prototype.getAIChooseRoad=function(t){var e=t==this.PLAYER_1?this.PLAYER_2:this.PLAYER_1;this.seed=ZJ.MathUtil.randomSeed(this.seed);for(var n=ZJ.MathUtil.randomRange(1,101,this.seed),i=[],o=1;5>=o;o++){var a=this.getGoatHitArray(e,o.toString());null!=a&&a.length>0&&i.push(o)}for(var o=1;5>=o;o++)if(-1==i.indexOf(o)){var a=this.getGoatArray(o.toString());if(null!=a)for(var r=0,s=a;r<s.length;r++){var h=s[r];h.player==e&&i.push(o)}}var c;if(50>=n&&i.length>0){this.seed=ZJ.MathUtil.randomSeed(this.seed);var l=ZJ.MathUtil.randomRange(0,i.length);c=i[l]}else c=this.getRandomRoad();return c},e.prototype.getNewGoatArray=function(t,e){var n=Math.floor(this.TOTAL_TIME/this.GOAT_CD_TIME),i=Math.floor(60/this.GOAT_CD_TIME),o=Math.floor(i/2*.6);o>2&&(t=ZJ.MathUtil.randomSeed(t),o=ZJ.MathUtil.randomRange(2,o+1,t)),i=Math.floor(90/this.GOAT_CD_TIME);var a=Math.floor(2*Math.floor(i/3)*.6);a>4&&(t=ZJ.MathUtil.randomSeed(t),a=ZJ.MathUtil.randomRange(4,a+1,t));var r=n-a-o,s=Math.floor(3*Math.floor(r/4)*.6);s>5&&(t=ZJ.MathUtil.randomSeed(t),s=ZJ.MathUtil.randomRange(5,s+1,t)),r-=s;var h=Math.floor(3*Math.floor(r/4)*.8);h>5&&(t=ZJ.MathUtil.randomSeed(t),h=ZJ.MathUtil.randomRange(5,h+1,t));var c=r-=h,l={};l[1]=c,l[2]=h,l[3]=s,l[4]=a,l[5]=o;for(var u=Math.floor(30/this.GOAT_CD_TIME),p=Math.floor(60/this.GOAT_CD_TIME),d=[1,2,3],g=[],f=0,y=-1,v=0;n>v;v++){v==u?d.push(4):v==p&&d.push(5);var m=!1,A=void 0;do{var _=f;e=ZJ.MathUtil.randomSeed(e);var E=ZJ.MathUtil.randomRange(0,d.length,e);if(A=d[E],A!=y){y=A,_=1,f=_;break}if(_++,(1==A||2==A||3==A)&&_>3)m=!0;else if(4==A&&_>2)m=!0;else{if(!(5==A&&_>1)){f=_;break}m=!0}if(1==m&&1==d.length){var C=0;3>=A?C=0:4==A?C=u:5==A&&(C=p);for(var I=C;I<g.length;I++)if(g[I]!=A){var R=I;_=1;for(var S=R-1;S>=0&&g[S]==A;S--)_++;for(var D=R+1;D<g.length&&g[D]==A;D++)_++;if(3>=A&&_>3)continue;if(4==A&&_>2)continue;if(5==A&&_>1)continue;var G=g[I];g[I]=A,A=G,m=!1;break}m=!1;break}}while(m);g.push(A),l[A]--,l[A]<=0&&ZJ.Util.rmArrayObj(d,A)}return g},e.prototype.createNewGoat=function(t,e,n){var i=new Goat;i.touchEnabled=!1;var o;return t==this.PLAYER_1?(this.canUseGoat1=!1,o=this.PLAYER_1,i.y=this.PLAYER1_STARTY):t==this.PLAYER_2&&(this.canUseGoat2=!1,o=this.PLAYER_2,i.y=this.PLAYER2_STARTY),i.strength=this.goatInfos[e].strength,i.weight=this.goatInfos[e].weight,i.score=this.goatInfos[e].score,i.speed=this.calGoatSpeed(i),i.player=o,i.x=203+168.5*(n-1),i.width=215*this.GOAT_SCALE_ARRAY[e-1],i.height=139*this.GOAT_SCALE_ARRAY[e-1],i.ranGoat=e,i.anchorOffsetX=i.width/2,i.player==this.PLAYER_1?(i.anchorOffsetY=i.height,i.setAnim("rabbit3")):i.player==this.PLAYER_2&&(i.anchorOffsetY=0,i.setAnim("rabbit4")),i.playWalk(),i.player==this.PLAYER_2?this.goatUIGroupArray[n-1].addChildAt(i,0):this.goatUIGroupArray[n-1].addChild(i),i},e.prototype.updateSex=function(t,e){var n;n=t==this.player1?this.sex1:this.sex2,"1"==e?n.source="boy_png":n.source="girl_png"},e.prototype.setLeave=function(){var t=this,e=ZJ.UIManager.instance.getView(UIName.Settle);return null==e?void setTimeout(function(){t.setLeave()},500):void e.setLeave()},e.prototype.pushTimeAction=function(t){this.timeActionArray.push(t),ZJ.SocketManager.instance.send(11015)},e.prototype.onDestroy=function(){return clearInterval(this.intervalID),clearInterval(this.intervalPing),this.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this),ZJ.SocketManager.instance.removeEventListener(ZJ.CommonEventName.SOCKET_CONNECTED,this.onSocketConnected,this),ZJ.SocketManager.instance.removeEventListener(ZJ.CommonEventName.SOCKET_DATA,this.onSocketData,this),0},e}(ZJ.ViewBase);__reflect(GameView.prototype,"GameView");var LoadingView=function(t){function e(){var e=t.call(this)||this;return e.intervalID=0,e.ran1=0,e.ran2=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);var e=ZJ.ShapeUtil.getRect(0,1,this.stage.stageWidth,this.stage.stageHeight);this.addChild(e);var n=500,i=new eui.ProgressBar;i.skinName="YYLoadingPBSkin",this.progress=i,this.progress.width=450,this.progress.height=62,this.progress.minimum=0,this.progress.maximum=100,this.progress.horizontalCenter=0,this.progress.y=n+435,this.progress.scaleX=1.3,this.progress.scaleY=1.3,this.progress.labelFunction=function(t,e){return t+"%"
},this.addChild(this.progress);var o=new eui.Image;o.source="load_img03_png",o.horizontalCenter=0,o.y=n+630,o.width=510,o.height=100,o.alpha=.2,this.addChild(o),this.load3=new eui.Label,this.load3.text="等待对手加入游戏...",this.load3.horizontalCenter=0,this.load3.y=n+660,this.load3.size=40,this.load3.textColor=16777215,this.addChild(this.load3),this.startCount()},e.prototype.startCount=function(){var t=this;this.intervalID=setInterval(function(){t.ran2=Math.min(t.ran2+8*Math.random()+2,99),t.progress.value=Math.floor((t.ran1+t.ran2)/2)},200)},e.prototype.onProgress=function(t,e){this.ran1=Math.floor(t/e*100),this.progress.value=Math.floor((this.ran1+this.ran2)/2)},e.prototype.onDestroy=function(){return t.prototype.onDestroy.call(this),clearInterval(this.intervalID),0},e}(ZJ.ViewBase);__reflect(LoadingView.prototype,"LoadingView");var SettleView=function(t){function e(){var e=t.call(this)||this;return e.skinName="SettleViewSkin",e}return __extends(e,t),e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.fight.visible=!1,setTimeout(function(){ZJ.ShapeUtil.setArcMask(e.head1,e.head1.width/2,0,1,!0,e.head1.width/2,e.head2.height/2),ZJ.ShapeUtil.setArcMask(e.head2,e.head2.width/2,0,1,!0,e.head2.width/2,e.head2.height/2)},50),this.play.addEventListener("touchTap",function(){"record_leave_png"==e.play.source?ChushouSDK.instance.csExitGame():"record_wait_png"!=e.play.source&&ChushouSDK.instance.csCheckEntryFee(function(t){"0"==t.code?("record_accept_png"!=e.play.source&&(e.play.source="record_wait_png"),ZJ.SocketManager.instance.send(11007)):"100"==t.code?ChushouSDK.instance.csInvokeRecharge(function(t){"0"==t.code?console.log("拉起充值页面成功"):console.log(t.errMsg)}):console.log(t.errMsg)})},this),ZJ.SocketManager.instance.addEventListener(ZJ.CommonEventName.SOCKET_DATA,this.onSocketData,this),this.timeOnEnterFrame=egret.getTimer(),this.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this)},e.prototype.onEnterFrame=function(t){var e=egret.getTimer(),n=this.timeOnEnterFrame,i=e-n;this.light.rotation-=90*(i/1e3),this.timeOnEnterFrame=e},e.prototype.onSocketData=function(t){var e=t.data;if(!ModuleConfig.compile.yy||1==e.result){var n=e.data;switch(e.protoID){case 11007:0!=n.result&&this.setLeave();break;case 11009:n.playerId!=this.player1.playerId&&"record_wait_png"!=this.play.source&&"record_accept_png"!=this.play.source&&(this.play.source="record_accept_png",this.fight.visible=!0)}}},e.prototype.setSettle=function(t,e,n,i,o){var a=this;this.win=t,this.player1=e,this.player2=n,e&&(this.head1.source=e.avatarUrl,this.name1.text=e.nickname),n&&(this.head2.source=n.avatarUrl,this.name2.text=n.nickname),this.score1.text=i.toString(),this.score2.text=o.toString(),this.setInfo();var r=new Array;r.push(n.openId),ChushouSDK.instance.csGetUserRelationship(r,function(t){"0"==t.code?"0"==t.users[0].relationship?(a.guanzhu.visible=!0,a.guanzhu.source="record_guanzhuta_png"):(a.guanzhu.visible=!0,a.guanzhu.source="record_yiguanzhu_png"):console.log(t.errMsg)}),this.guanzhu.addEventListener("touchTap",function(t){"record_guanzhuta_png"==a.guanzhu.source&&ChushouSDK.instance.csFollowUser(n.openId,function(t){"0"==t.code?a.guanzhu.source="record_yiguanzhu_png":console.log(t.errMsg)})},this)},e.prototype.setInfo=function(){1==this.win?(this.light.source="record_light_png",this.panel.source="winPanel_png",this.stateTip.source="youwin_png"):2==this.win?(this.light.source="record_darklight_png",this.panel.source="failPanel_png",this.stateTip.source="youlose_png"):0==this.win&&(this.light.source="record_light_png",this.panel.source="winPanel_png",this.stateTip.source="pingju_png")},e.prototype.setLeave=function(){this.play.source="record_leave_png",this.fight.visible=!1},e.prototype.onDestroy=function(){return t.prototype.onDestroy.call(this),this.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this),0},e}(ZJ.ViewBase);__reflect(SettleView.prototype,"SettleView");var ZJ;!function(t){var e=function(){function t(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),this.x=0,this.y=0,this.z=0,this.x=t,this.y=e,this.z=n}return t}();t.Vector3=e,__reflect(e.prototype,"ZJ.Vector3")}(ZJ||(ZJ={}));var ZJ;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){return 0},e._instance=new e,e}(egret.EventDispatcher);t.EventManager=e,__reflect(e.prototype,"ZJ.EventManager")}(ZJ||(ZJ={}));var ZJ;!function(t){var e=function(){function e(){}return e.randomRange=function(e,n,i){null==i&&(i=t.Util.timeStamp());var o=this.randomSeed(i);return o/=233280,Math.floor(e+o*(n-e))},e.randomSeed=function(t){return t=(9301*t+49297)%233280},e.YiYuanErCi=function(t,e,n){var i,o,a,r=[];return i=e*e-4*t*n,0>i||(o=(-1*e+Math.sqrt(i))/(2*t),a=(-1*e-Math.sqrt(i))/(2*t),r.push(o),r.push(a)),r},e.GouguDingli=function(t,e){return Math.sqrt(t*t+e*e)},e}();t.MathUtil=e,__reflect(e.prototype,"ZJ.MathUtil")}(ZJ||(ZJ={}));var ZJ;!function(t){var e=function(){function e(){this.aa=null,this.stage=null,this.dbFactory=dragonBones.EgretFactory.factory,this.dbFileNames=[]}return Object.defineProperty(e,"instance",{get:function(){return this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.stage=t,this.aa=new AssetAdapter,[4,this.loadConfig("resource/default.res.json?v="+Math.random(),"resource/")];case 1:return e.sent(),[4,this.loadTheme()];case 2:return e.sent(),[2]}})})},e.prototype.loadRes=function(t,e,n,i){this.aa.getAsset(t,e,n,i)},e.prototype.loadExistRes=function(t){return RES.getRes(t)},e.prototype.loadConfig=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,RES.loadConfig(t,e)];case 1:return n.sent(),[2]}})})},e.prototype.loadGroup=function(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=null),__awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,RES.loadGroup(t,e,n)];case 1:return o.sent(),[3,3];case 2:return i=o.sent(),console.error(i),[3,3];case 3:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,n){var i=new eui.Theme("resource/default.thm.json",t.stage);i.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.loadMovieClip=function(e,n,i){t.ResManager.instance.loadRes(e+"_json",function(o,a){var r=o;t.ResManager.instance.loadRes(e+"_png",function(t,e){var o=t,a=new egret.MovieClipDataFactory(r,o),s=new egret.MovieClip(a.generateMovieClipData(n));i(s,a)},this)},this)},e.prototype.loadDragonBones=function(t,e){if(void 0===e&&(e=""),""==e&&(e=t),-1==this.dbFileNames.indexOf(t)){var n=this.loadExistRes(t+"_ske_json"),i=this.loadExistRes(t+"_tex_json"),o=this.loadExistRes(t+"_tex_png");this.dbFactory.parseDragonBonesData(n),this.dbFactory.parseTextureAtlasData(i,o),this.dbFileNames.push(t)}var a=this.dbFactory.buildArmatureDisplay(e);return a},e.prototype.replaceDBSlotDisplay=function(t,e,n,i,o){void 0===e&&(e=""),""==e&&(e=t),this.dbFactory.replaceSlotDisplay(t,e,n,i,o)},e._instance=new e,e}();t.ResManager=e,__reflect(e.prototype,"ZJ.ResManager")}(ZJ||(ZJ={}));var ZJ;!function(t){var e=function(){function t(){}return t.getRect=function(t,e,n,i,o,a){void 0===o&&(o=0),void 0===a&&(a=0);var r=new egret.Shape;return r.graphics.beginFill(t,e),r.graphics.drawRect(o,a,n,i),r.graphics.endFill(),r},t.getCircle=function(t,e,n,i,o){void 0===i&&(i=0),void 0===o&&(o=0);var a=new egret.Shape;return a.graphics.beginFill(t,e),a.graphics.drawCircle(i,o,n),a.graphics.endFill(),a},t.getLine=function(t,e,n,i,o,a,r){var s=new egret.Shape;return s.graphics.lineStyle(n,t,e),s.graphics.moveTo(i,o),s.graphics.lineTo(a,r),s.graphics.endFill(),s},t.getArc=function(t,e,n,i,o,a,r,s,h){void 0===r&&(r=!1),void 0===s&&(s=0),void 0===h&&(h=0);var c=new egret.Shape;return c.graphics.lineStyle(n,t,e),c.graphics.drawArc(s,h,i,Math.PI/180*o,Math.PI/180*a,r),c.graphics.endFill(),c},t.getArch=function(t,e,n,i,o,a,r,s){void 0===a&&(a=!1),void 0===r&&(r=0),void 0===s&&(s=0);var h=new egret.Shape;return h.graphics.beginFill(t,e),h.graphics.drawArc(r,s,n,Math.PI/180*i,Math.PI/180*o,a),h.graphics.endFill(),h},t.setArcMask=function(t,e,n,i,o,a,r){void 0===o&&(o=!1),void 0===a&&(a=t.width*t.scaleX/2),void 0===r&&(r=t.height*t.scaleY/2);var s;null!=t.mask?s=t.mask:(s=new egret.Shape,t.parent.addChild(s));var h=Math.round(n+360*i)*Math.PI/180;n*=Math.PI/180,s.graphics.clear(),s.graphics.beginFill(16711680,1),s.graphics.lineTo(e,0),s.graphics.drawArc(a,r,e,n,h,o),s.graphics.lineTo(a,r),s.graphics.endFill(),s.x=t.x,s.y=t.y,t.mask=s},t}();t.ShapeUtil=e,__reflect(e.prototype,"ZJ.ShapeUtil")}(ZJ||(ZJ={}));var ZJ;!function(t){var e=function(t){function e(e,n,i,o){var a=t.call(this,e,n,i,o)||this;return a.data=null,a}return __extends(e,t),e}(egret.Event);t.SocketDataEvent=e,__reflect(e.prototype,"ZJ.SocketDataEvent")}(ZJ||(ZJ={}));var ZJ;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.socket=null,t.ProtoBufRoot=new protobuf.Root,t.send=null,t.onSocketData=null,t.getProtoByID=null,t._company=1,t.clientIndex=0,t}return __extends(n,e),Object.defineProperty(n,"instance",{get:function(){return this._instance},enumerable:!0,configurable:!0}),n.prototype.init=function(){return this.parseProto(),this.socket=new egret.WebSocket,this.socket.type=egret.WebSocket.TYPE_BINARY,this.setCompany(1),this.socket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onSocketData,this),this.socket.addEventListener(egret.Event.CONNECT,this.onSocketConnect,this),0},n.prototype.parseProto=function(){for(var t=this.ProtoBufRoot,e=ModuleConfig.protoFiles,n=0,i=e.length;i>n;++n){var o=RES.getRes(e[n]);protobuf.parse(o,t)}},n.prototype.setCompany=function(t){switch(this._company=t,t){case 2:this.send=this.sendYouai,this.onSocketData=this.onSocketDataYouai,this.getProtoByID=this.getProtoByIDYouai;break;case 3:this.send=this.sendAli,this.getProtoByID=this.getProtoByIDHuoshu;break;default:this.send=this.sendHuoshu,this.onSocketData=this.onSocketDataHuoshu,this.getProtoByID=this.getProtoByIDHuoshu}},n.prototype.connect=function(t,e){this.socket.connect(t,e)},n.prototype.connectByUrl=function(t){this.socket.connectByUrl(t)},n.prototype.close=function(){this.socket.close()},n.prototype.onSocketConnect=function(e){var n=new egret.Event(t.CommonEventName.SOCKET_CONNECTED);this.dispatchEvent(n)},n.prototype.buildSmallShitByID=function(t,e){var n=this.getProtoByID(t,!0),i=this.buildSmallShit(n,e);return i},n.prototype.decodeShitByID=function(t,e){var n=this.getProtoByID(t,!1),i=this.decodeShit(n,e);return i},n.prototype.buildSmallShit=function(t,e){var n=t.create(e),i=t.encode(n),o=i.finish();return o},n.prototype.decodeShit=function(t,e){var n=t.decode(e);return n},n.prototype.sendHuoshu=function(t,e){void 0===e&&(e={}),console.log("send: "+t),console.log(e);var n=this.buildSmallShitByID(t,e),i=new egret.ByteArray;i.writeInt(n.byteLength),i.writeShort(t),i._writeUint8Array(n),this.socket.writeBytes(i)},n.prototype.onSocketDataHuoshu=function(e){var n=new egret.ByteArray;this.socket.readBytes(n);var i=(n.readInt(),n.readShort()),o=this.decodeShitByID(i,n.bytes.subarray(6));console.log("receive: "+i),console.log(o);var a=new t.SocketDataEvent(t.CommonEventName.SOCKET_DATA);a.data={data:o,protoID:i},this.dispatchEvent(a)},n.prototype.getProtoByIDHuoshu=function(e,n){var i=(Math.floor(e/1e3),""),o="";o=n?"cs_":"sc_",i=o+e;var a=t.SocketManager.instance.ProtoBufRoot,r=a.lookupType(i);return r},n.prototype.sendYouai=function(t,e){void 0===e&&(e={});var n=this.buildSmallShitByID(t,e),i=this.buildSmallShitByID(99999,{messageId:t,clientIndex:this.clientIndex++,data:n}),o=new egret.ByteArray(i);this.socket.writeBytes(o)},n.prototype.onSocketDataYouai=function(e){var n=new egret.ByteArray;this.socket.readBytes(n);var i=this.decodeShitByID(99999,n.bytes),o="",a={},r=i.result,s=i.messageId;i.result?a=this.decodeShitByID(i.messageId,i.data):o=t.Util.Utf8ArrayToStr(i.data);var h=new t.SocketDataEvent(t.CommonEventName.SOCKET_DATA);h.data={data99999:i,error:o,result:r,data:a,protoID:s},this.dispatchEvent(h)},n.prototype.getProtoByIDYouai=function(e,n){var i="";if(n)switch(e){case 99999:i="ClientCmdData";break;case 1e3:i="CmdLoginGameReqMsg";break;case 1001:i="CmdPingReqMsg";break;case 1300:i="CmdJumperUploadAnswerReqMsg";break;case 1303:i="CmdJumperGameOverReqMsg"}else switch(e){case 99999:i="ServerCmdData";break;case 1e3:i="CmdLoginGameRspMsg";break;case 1001:i="CmdPingRspMsg";break;case 1300:i="CmdJumperUploadAnswerRspMsg";break;case 1303:i="CmdJumperGameOverRspMsg";break;case 1399:i="CmdBroadcastJumperBC"}var o=t.SocketManager.instance.ProtoBufRoot,a=o.lookupType(i);return a},n.prototype.sendAli=function(t,e){void 0===e&&(e={});var n=this.buildSmallShitByID(t,e),i=new egret.ByteArray;i.writeInt(n.byteLength),i.writeShort(t),i._writeUint8Array(n),ALISDK.CatcherSDK.instance().sendData(i.buffer)},n.prototype.onSocketDataAli=function(e){var n=new egret.ByteArray(e),i=(n.readInt(),n.readShort()),o=this.decodeShitByID(i,n.bytes.subarray(6));console.log("receive: "+i),console.log(o);var a=new t.SocketDataEvent(t.CommonEventName.SOCKET_DATA);a.data={data:o,protoID:i},this.dispatchEvent(a)},n.prototype.connectByUrlAli=function(e){var n=this;ALISDK.CatcherSDK.init({url:"ws://"+e.ip+":"+e.port+"/ws/game",gameVersion:"0.0.1",gameId:"123123",messageType:"ARRAYBUFFER"}),ALISDK.CatcherSDK.instance().on("CONNECT",function(e){var i=new t.ChannelDataEvent(t.CommonEventName.CHANNEL_DATA);i.data={eventName:"CONNECT",event:e},n.dispatchEvent(i)}).on("PROGRESS",function(e){var i=new t.ChannelDataEvent(t.CommonEventName.CHANNEL_DATA);i.data={eventName:"PROGRESS",event:e},n.dispatchEvent(i)}).on("READY",function(e){var i=new t.ChannelDataEvent(t.CommonEventName.CHANNEL_DATA);i.data={eventName:"READY",event:e},n.dispatchEvent(i)}).on("KICK",function(e){var i=new t.ChannelDataEvent(t.CommonEventName.CHANNEL_DATA);i.data={eventName:"KICK",event:e},n.dispatchEvent(i)}).on("GAMEOVER",function(e){var i=new t.ChannelDataEvent(t.CommonEventName.CHANNEL_DATA);i.data={eventName:"GAMEOVER",event:e},n.dispatchEvent(i)}).on("BREAK",function(e){var i=new t.ChannelDataEvent(t.CommonEventName.CHANNEL_DATA);i.data={eventName:"BREAK",event:e},n.dispatchEvent(i)}).on("CONTINUE",function(e){var i=new t.ChannelDataEvent(t.CommonEventName.CHANNEL_DATA);i.data={eventName:"CONTINUE",event:e},n.dispatchEvent(i)}).on("ERROR",function(e){var i=new t.ChannelDataEvent(t.CommonEventName.CHANNEL_DATA);i.data={eventName:"ERROR",event:e},n.dispatchEvent(i)}).on("MIC_CHANGE",function(e){var i=new t.ChannelDataEvent(t.CommonEventName.CHANNEL_DATA);i.data={eventName:"MIC_CHANGE",event:e},n.dispatchEvent(i)}).on("AUDIO_CHANGE",function(e){var i=new t.ChannelDataEvent(t.CommonEventName.CHANNEL_DATA);i.data={eventName:"AUDIO_CHANGE",event:e},n.dispatchEvent(i)}).on("MESSAGE",function(t){n.onSocketDataAli(t.data)}).start()},n._instance=new n,n}(egret.EventDispatcher);t.SocketManager=e,__reflect(e.prototype,"ZJ.SocketManager")}(ZJ||(ZJ={}));var ZJ;!function(t){var e=function(){function e(){this._tables={}}return Object.defineProperty(e,"instance",{get:function(){return this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){return this.load("bg_djw_png"),0},Object.defineProperty(e.prototype,"tables",{get:function(){return this._tables},enumerable:!0,configurable:!0}),e.prototype.load=function(e){t.ResManager.instance.loadRes(e,function(e){for(var n=new JSZip(e),i=n.file(/^[tc].*/),o=0,a=i.length;a>o;o++){var r=i[o],s=t.Util.strFormat("shared/{0}",r.name);this._tables[s]=JSON.parse(r.asText())}t.EventManager.instance.dispatchEvent(new egret.Event(t.CommonEventName.TABLE_LOADED))},this)},e._instance=new e,e}();t.TableManager=e,__reflect(e.prototype,"ZJ.TableManager")}(ZJ||(ZJ={}));var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,n,i){function o(t){e.call(i,t)}function a(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),n.call(i))}"undefined"!=typeof generateEUI?egret.callLater(function(){e.call(i,generateEUI)},this):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),RES.getResByUrl(t,o,this,RES.ResourceItem.TYPE_TEXT))},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,n,i){function o(i){e.call(n,i,t)}if(void 0===i&&(i=RES.ResourceItem.TYPE_IMAGE),RES.hasRes(t)){var a=RES.getRes(t);a?o(a):RES.getResAsync(t,o,this)}else RES.getResByUrl(t,o,this,i)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var ZJ;!function(t){var e=function(){function t(){this._uiLayers=[],this.uiDatas={},this.uiroot=null,this.views={}}return Object.defineProperty(t,"instance",{get:function(){return this._instance},enumerable:!0,configurable:!0}),t.prototype.init=function(t){return this.uiroot=t,0},Object.defineProperty(t.prototype,"uiLayers",{set:function(t){if(this._uiLayers.length>0)egret.warn("uiLayers已经设定。");else{this._uiLayers=t;for(var e=0,n=this._uiLayers.length;n>e;++e){var i=new eui.Group;i.name="layer"+e,i.touchEnabled=!1,this.uiroot.addChild(i),i.percentWidth=100,i.percentHeight=100}}},enumerable:!0,configurable:!0}),t.prototype.getUIData=function(t){return this.uiDatas[t]},t.prototype.getView=function(t){return this.views[t]},t.prototype.openView=function(t){var e=this.getUIData(t);if(void 0==e)return egret.log("ModuleConfig没有界面配置: "+t),null;var n=this.getView(t);if(void 0!=n);else{if(n=new e.viewClass,void 0==n)return console.warn("viewClass不存在 请检查ModuleConfig.uiDatas"),null;n.percentWidth=100,n.percentHeight=100,this.views[t]=n;var i=0;e.layer<this.uiroot.numChildren&&(i=e.layer),this.uiroot.getChildAt(i).addChild(n)}return n.visible=!0,n.parent.setChildIndex(n,9999),n.show(),n},t.prototype.destroyView=function(t){var e=this.getView(t);return void 0!=e&&null!=e&&(e.onDestroy(),e.parent.removeChild(e),this.views[t]=null),0},t._instance=new t,t}();t.UIManager=e,__reflect(e.prototype,"ZJ.UIManager")}(ZJ||(ZJ={}));var ZJ;!function(t){var e=function(){function t(){}return t.getChar=function(t,e){var n=new egret.ByteArray;return n.writeUTFBytes(t),n.length<e?t:(n.position=0,n.readUTFBytes(e)+"...")},t.strFormat=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return t.replace(/\{(\d+)\}/g,function(t,n){return e[n]})},t.timeStamp=function(t){return t=t||(new Date).toString(),Date.parse(t)/1e3},t.Utf8ArrayToStr=function(t){var e,n,i,o,a,r;for(e="",i=t.length,n=0;i>n;)switch(o=t[n++],o>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:e+=String.fromCharCode(o);break;case 12:case 13:a=t[n++],e+=String.fromCharCode((31&o)<<6|63&a);break;case 14:a=t[n++],r=t[n++],e+=String.fromCharCode((15&o)<<12|(63&a)<<6|(63&r)<<0)}return e},t.getClassName=function(t){if(t&&t.constructor&&t.constructor.toString()){if(t.constructor.name)return t.constructor.name;var e=t.constructor.toString();if("["==e.charAt(0))var n=e.match(/\[\w+\s*(\w+)\]/);else var n=e.match(/function\s*(\w+)/);if(n&&2==n.length)return n[1]}},t.objToByteArray=function(t){var e=JSON.stringify(t),n=new egret.ByteArray;return n.writeUTF(e),n},t.bytesToObj=function(t){var e=new egret.ByteArray(t),n=JSON.parse(e.readUTF());return n},t.rmArrayObj=function(t,e){return-1!=t.indexOf(e)?t.splice(t.indexOf(e),1):void 0},t}();t.Util=e,__reflect(e.prototype,"ZJ.Util")}(ZJ||(ZJ={}));var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.share=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ZJ;!function(t){var e=function(){function e(){this.bgm="bgm",this._isMute=!1,this.sounds={},this.soundsUniqueChannel={},this.soundsChannel={}}return Object.defineProperty(e,"Instance",{get:function(){return this._instance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isMute",{get:function(){return this._isMute},set:function(t){this._isMute=t,this._isMute?this.stopAll():this.playBgm()},enumerable:!0,configurable:!0}),e.prototype.playBgm=function(t,e){void 0===t&&(t=0),void 0===e&&(e=1),this._isMute||null!=this.bgm&&""!=this.bgm&&this.play(this.bgm,t,e,!0)},e.prototype.stopBgm=function(){this.stop(this.bgm)},e.prototype.play=function(e,n,i,o){var a=this;void 0===n&&(n=1),void 0===i&&(i=1),void 0===o&&(o=!1);var r=e+"_mp3";if(!this._isMute)if(null!=this.sounds[e]){o&&this.stop(e);var s=this.sounds[e].play(0,n);o?this.soundsUniqueChannel[e]=s:this.soundsChannel[e].push(s),s.volume=i}else t.ResManager.instance.loadRes(r,function(t,r){var s=t,h=s.play(0,n);h.volume=i,a.sounds[e]=s,a.soundsChannel[e]=[],o?a.soundsUniqueChannel[e]=h:a.soundsChannel[e].push(h)},this)},e.prototype.stop=function(t){var e=this.soundsChannel[t],n=this.soundsUniqueChannel[t];if(null!=e){for(var i=0,o=e;i<o.length;i++){var a=o[i];a.stop()}e.length=0}null!=n&&(n.stop(),n=null)},e.prototype.stopAll=function(){for(var t in this.soundsChannel)this.stop(t);for(var e in this.soundsUniqueChannel)this.stop(e)},e.prototype.getSound=function(t){return this.sounds[t]},e.prototype.getChannel=function(t){return this.soundsChannel[t]},e.prototype.getUniqueChannel=function(t){return this.soundsUniqueChannel[t]},e._instance=new e,e}();t.AudioManager=e,__reflect(e.prototype,"ZJ.AudioManager")}(ZJ||(ZJ={}));var ZJ;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.cb=null,t.leftSecond=0,t.intervalID=0,t.isPause=!1,t.skinName="CountDownSkin",t}return __extends(n,e),n.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},n.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},n.prototype.start=function(t){var e=this;this.stop(),this.isPause=!1,this.leftSecond=t,this.count(),this.intervalID=setInterval(function(){e.count()},1e3)},n.prototype.pause=function(){this.isPause=!0},n.prototype.resume=function(){this.isPause=!1},n.prototype.stop=function(){clearInterval(this.intervalID)},n.prototype.setSecond=function(e){var n=Math.floor(e/60)%60,i=e%60,o=this.checkTime(n),a=this.checkTime(i);this.label.text=t.Util.strFormat("{0}:{1}",o,a)},n.prototype.count=function(){return this.setSecond(this.leftSecond),0==this.leftSecond?(this.stop(),void(null!=this.cb&&this.cb())):void(this.isPause||this.leftSecond--)},n.prototype.checkTime=function(t){return 10>t&&(t="0"+t),t},n.prototype.OnDestroy=function(){this.cb=null,this.stop()},n}(eui.Component);t.CountDown=e,__reflect(e.prototype,"ZJ.CountDown",["eui.UIComponent","egret.DisplayObject"])}(ZJ||(ZJ={}));var ZJ;!function(t){var e=function(e){function n(){var n=e.call(this)||this;return n.INTERVAL=60,n.DISTANCE=20,n.pastTime=0,n.lastPos=new t.Vector3,n.nowPos=new t.Vector3,n.isBegin=!1,n.intervalID=0,n}return __extends(n,e),n.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},n.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),this.layer.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.layer.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.layer.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.intervalID=setInterval(function(){t.onInterval()},this.INTERVAL)},n.prototype.onInterval=function(){if(this.isBegin){var e=this.nowPos.x-this.lastPos.x,n=this.nowPos.y-this.lastPos.y,i=Math.abs(e),o=Math.abs(n),a={};if(i>o?i>this.DISTANCE&&(e>0?a.direct=t.CommonConfig.RIGHT:a.direct=t.CommonConfig.LEFT,this.isBegin=!1):o>this.DISTANCE&&(n>0?a.direct=t.CommonConfig.DOWN:a.direct=t.CommonConfig.UP,this.isBegin=!1),!this.isBegin){var r=new egret.Event(t.CommonEventName.GESTURE_DIRECT);r.data=a,t.EventManager.instance.dispatchEvent(r)}this.lastPos.x=this.nowPos.x,this.lastPos.y=this.nowPos.y}},n.prototype.onTouchBegin=function(t){this.pastTime=0,this.nowPos.x=t.stageX,this.nowPos.y=t.stageY,this.lastPos.x=t.stageX,this.lastPos.y=t.stageY,this.isBegin=!0},n.prototype.onTouchEnd=function(t){this.isBegin=!1},n.prototype.onTouchMove=function(t){this.nowPos.x=t.stageX,this.nowPos.y=t.stageY},n.prototype.OnDestroy=function(){return clearInterval(this.intervalID),0},n}(t.ComponentBase);t.Gesture=e,__reflect(e.prototype,"ZJ.Gesture")}(ZJ||(ZJ={}));var ImgAnim=function(t){function e(e){var n=t.call(this)||this;return n.interval=0,n.loop=!0,n.index=0,n.imgArray=e,n.source=e[0],n}return __extends(e,t),e.prototype.play=function(){var t=this;this.id=setInterval(function(){t.index++,t.index>=t.imgArray.length&&(t.loop?t.index=0:t.stop()),t.source=t.imgArray[t.index]},this.interval,this)},e.prototype.replay=function(){this.index=0,clearInterval(this.id),this.play()},e.prototype.pause=function(){clearInterval(this.id)},e.prototype.stop=function(){this.index=0,clearInterval(this.id)},e}(eui.Image);__reflect(ImgAnim.prototype,"ImgAnim");var ZJ;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.cb=null,e.leftSecond=0,e.intervalID=0,e.isPause=!1,e}return __extends(e,t),e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.start=function(t){var e=this;this.stop(),this.isPause=!1,this.leftSecond=t,this.count(),this.intervalID=setInterval(function(){e.count()},1e3)},e.prototype.pause=function(){this.isPause=!0},e.prototype.resume=function(){this.isPause=!1},e.prototype.stop=function(){clearInterval(this.intervalID)},e.prototype.setSecond=function(t){this.label.text=t.toString()},e.prototype.count=function(){return this.setSecond(this.leftSecond),0==this.leftSecond?(this.stop(),void(null!=this.cb&&this.cb())):void(this.isPause||this.leftSecond--)},e.prototype.checkTime=function(t){return t},e.prototype.OnDestroy=function(){this.cb=null,this.stop()},e}(eui.Component);t.MyCountDown=e,__reflect(e.prototype,"ZJ.MyCountDown",["eui.UIComponent","egret.DisplayObject"])}(ZJ||(ZJ={}));var UILayer=function(){function t(){}return t.View=0,t.Pop=1,t.SDK=2,t}();__reflect(UILayer.prototype,"UILayer");var UIName=function(){function t(){}return t.Game="Game",t.Settle="Settle",t.Loading="Loading",t}();__reflect(UIName.prototype,"UIName");var ModuleConfig=function(){function t(){}return t.uiLayers=[UILayer.View,UILayer.Pop,UILayer.SDK],t.uiDatas=(_a={},_a[UIName.Game]=new ZJ.UIData(UIName.Game,UILayer.View,GameView),_a[UIName.Settle]=new ZJ.UIData(UIName.Settle,UILayer.View,SettleView),_a[UIName.Loading]=new ZJ.UIData(UIName.Loading,UILayer.Pop,LoadingView),_a),t.compile={need_loading:!0,chushou:!0,chushou_h5AppName:"tzdzz",danji:!0},t.ip="dev-game.u17games.com",t.port="12041",t.ws="ws",t.protoFiles=["p10_proto","p11_proto"],t}();__reflect(ModuleConfig.prototype,"ModuleConfig");var EventName=function(){function t(){}return t.Test="Test",t}();__reflect(EventName.prototype,"EventName");var _a,ModuleStartUp=function(){function t(){}return t.init=function(){return ZJ.UIManager.instance.openView(UIName.Game),0},t}();__reflect(ModuleStartUp.prototype,"ModuleStartUp");var ModuleUtil=function(){function t(){}return Object.defineProperty(t,"tables",{get:function(){return ZJ.TableManager.instance.tables},enumerable:!0,configurable:!0}),t}();__reflect(ModuleUtil.prototype,"ModuleUtil");var Goat=function(t){function e(){var e=t.call(this)||this;return e.isSpecialAnim=!1,e.skinName="GoatSkin",e}return __extends(e,t),e.prototype.setAnim=function(t){null!=this.anim&&(this.anim.animation.stop(),this.removeChild(this.anim)),this.isSpecialAnim=!1,"rabbit4"==t&&(this.isSpecialAnim=!0),this.anim=ZJ.ResManager.instance.loadDragonBones(t);var e=this.width/this.anim.measuredWidth;this.anim.anchorOffsetX=-this.anim.measuredWidth/2,this.anim.anchorOffsetY=-this.anim.measuredHeight/2,this.anim.x=0,this.anim.y=0,this.anim.$setScaleX(e),this.anim.$setScaleY(e),this.addChild(this.anim)},e.prototype.playWalk=function(){if(null!=this.anim){var t=this.getAnimName("walk");this.anim.animation.play(t,0)}},e.prototype.playAttack=function(){var t=this;if(null!=this.anim){var e=this.getAnimName("jump");this.anim.animation.play(e,1),this.anim.anchorOffsetY=-this.anim.measuredHeight/2,this.anim.addDBEventListener(dragonBones.EventObject.COMPLETE,function(e){t.anim.removeDBEventListener(dragonBones.EventObject.COMPLETE,function(t){},t),t.anim.animation.play("stand",1),t.anim.anchorOffsetY=-t.anim.measuredHeight/2,t.anim.addDBEventListener(dragonBones.EventObject.COMPLETE,function(e){t.anim.removeDBEventListener(dragonBones.EventObject.COMPLETE,function(t){},t),t.anim.animation.hasAnimation("stand_2")?(t.anim.animation.play("stand_2",1),t.anim.anchorOffsetY=-t.anim.measuredHeight/2,t.anim.addDBEventListener(dragonBones.EventObject.COMPLETE,function(e){t.anim.removeDBEventListener(dragonBones.EventObject.COMPLETE,function(t){},t),t.anim.animation.timeScale=.6,t.anim.animation.play("stand_1",0),t.anim.anchorOffsetY=-t.anim.measuredHeight/2},t)):(t.anim.removeDBEventListener(dragonBones.EventObject.COMPLETE,function(t){},t),t.anim.animation.timeScale=.6,t.anim.animation.play("stand_1",0),t.anim.anchorOffsetY=-t.anim.measuredHeight/2)},t)},this)}},e.prototype.playEndAttackAnim=function(){this.anim.removeDBEventListener(dragonBones.EventObject.COMPLETE,function(t){},this),this.anim.animation.timeScale=.6,this.anim.animation.play("stand_1",0),this.anim.anchorOffsetY=-this.anim.measuredHeight/2},e.prototype.getAnimName=function(t){return this.isSpecialAnim&&(t+=this.ranGoat),t},e}(eui.Component);__reflect(Goat.prototype,"Goat",["eui.UIComponent","egret.DisplayObject"]);var NumCountDown=function(t){function e(){var e=t.call(this)||this;return e.cb=null,e.leftSecond=0,e.intervalID=0,e.isPause=!1,e.skinName="NumCountDownSkin",e}return __extends(e,t),e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.start=function(t){var e=this;this.stop(),this.isPause=!1,this.leftSecond=t,this.count(),this.intervalID=setInterval(function(){e.count()},1e3)},e.prototype.pause=function(){this.isPause=!0},e.prototype.stop=function(){this.label.text="",clearInterval(this.intervalID)},e.prototype.count=function(){return this.label.text=this.leftSecond.toString(),0==this.leftSecond?(this.stop(),void(null!=this.cb&&this.cb())):void(this.isPause||this.leftSecond--)},e.prototype.OnDestroy=function(){this.cb=null,this.stop()},e}(eui.Component);__reflect(NumCountDown.prototype,"NumCountDown",["eui.UIComponent","egret.DisplayObject"]);var ZJ;!function(t){var e=function(t){function e(e,n,i,o){var a=t.call(this,e,n,i,o)||this;return a.data=null,a}return __extends(e,t),e}(egret.Event);t.ChannelDataEvent=e,__reflect(e.prototype,"ZJ.ChannelDataEvent")}(ZJ||(ZJ={}));var ZJ;!function(t){var e=function(){function t(){}return t.FRAME=30,t.UP=0,t.DOWN=1,t.LEFT=2,t.RIGHT=3,t}();t.CommonConfig=e,__reflect(e.prototype,"ZJ.CommonConfig");var n=function(){function t(){}return t.TABLE_LOADED="TABLE_LOADED",t.SOCKET_CONNECTED="SOCKET_CONNECTED",t.SOCKET_DATA="SOCKET_DATA",t.GESTURE_DIRECT="GESTURE_DIRECT",t.CHANNEL_DATA="CHANNEL_DATA",t}();t.CommonEventName=n,__reflect(n.prototype,"ZJ.CommonEventName")}(ZJ||(ZJ={}));var Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){var e=this;
t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){e.tickerInterval=setInterval(function(){egret.ticker.update()},e,1e3/30)},egret.lifecycle.onResume=function(){clearInterval(e.tickerInterval)},egret.registerImplementation("eui.IAssetAdapter",new AssetAdapter),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,this.createGameScene()];case 1:return e.sent(),[4,platform.login()];case 2:return e.sent(),[4,platform.getUserInfo()];case 3:return t=e.sent(),console.log(t),[2]}})})},e.prototype.createGameScene=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return egret.ImageLoader.crossOrigin="anonymous",ModuleConfig.compile.yy&&onPKLoading(),[4,ZJ.ResManager.instance.init(this.stage)];case 1:return e.sent(),[4,ZJ.ResManager.instance.loadGroup("realpreload")];case 2:return e.sent(),ZJ.UIManager.instance.init(this),ZJ.UIManager.instance.uiLayers=ModuleConfig.uiLayers,ZJ.UIManager.instance.uiDatas=ModuleConfig.uiDatas,t=this.GetLoadingView(),[4,ZJ.ResManager.instance.loadGroup("preload",0,t)];case 3:return e.sent(),ZJ.TableManager.instance.init(),ZJ.SocketManager.instance.init(),1==ModuleConfig.compile.yy&&onPKFinishLoading(),ModuleStartUp.init(),1==ModuleConfig.compile.yy&&onPKStart(),[2]}})})},e.prototype.GetLoadingView=function(){var t=null,e=null;return ModuleConfig.compile.need_loading&&(ModuleConfig.compile.danji?e=LoadingView:ModuleConfig.compile.yy?e=YYLoadingView:ModuleConfig.compile.chushou&&(e=ChushouLoadingView)),null!=e&&(ModuleConfig.uiDatas[UIName.Loading].viewClass=e,t=ZJ.UIManager.instance.openView(UIName.Loading)),t},e.prototype.onEnterFrame=function(){},e}(eui.UILayer);__reflect(Main.prototype,"Main");var YYLoadingView=function(t){function e(){var e=t.call(this)||this;return e.intervalID=0,e.ran1=0,e.ran2=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);var e=ZJ.ShapeUtil.getRect(0,1,this.stage.stageWidth,this.stage.stageHeight);this.addChild(e);var n=new eui.Image;n.source="loading_bg_png",n.height=1920,n.width=1080,this.addChild(n),n.horizontalCenter=0;var i=500,o=new eui.Group;this.addChild(o),o.horizontalCenter=0,o.y=i,ZJ.ResManager.instance.loadMovieClip("yylangren","yylangren",function(t){o.addChild(t),t.scaleX=1.5,t.scaleY=1.5,t.x=-195,t.gotoAndPlay("tiao",-1)});var a=new eui.ProgressBar;a.skinName="YYLoadingPBSkin",this.progress=a,this.progress.width=450,this.progress.height=62,this.progress.minimum=0,this.progress.maximum=100,this.progress.horizontalCenter=0,this.progress.y=i+435,this.progress.scaleX=1.3,this.progress.scaleY=1.3,this.progress.labelFunction=function(t,e){return t+"%"},this.addChild(this.progress);var r=new eui.Image;r.source="load_img03_png",r.horizontalCenter=0,r.y=i+630,r.width=510,r.height=100,r.alpha=.2,this.addChild(r),this.load3=new eui.Label,this.load3.text="等待对手加入游戏...",this.load3.horizontalCenter=0,this.load3.y=i+660,this.load3.size=40,this.load3.textColor=16777215,this.addChild(this.load3),this.startCount()},e.prototype.startCount=function(){var t=this;this.intervalID=setInterval(function(){t.ran2=Math.min(t.ran2+8*Math.random()+2,99),t.progress.value=Math.floor((t.ran1+t.ran2)/2)},200)},e.prototype.onProgress=function(t,e){this.ran1=Math.floor(t/e*100),this.progress.value=Math.floor((this.ran1+this.ran2)/2)},e.prototype.onDestroy=function(){return t.prototype.onDestroy.call(this),clearInterval(this.intervalID),0},e}(ZJ.ViewBase);__reflect(YYLoadingView.prototype,"YYLoadingView");var ChushouLoadingView=function(t){function e(){var e=t.call(this)||this;return e.intervalID=0,e.ran1=0,e.ran2=0,e.SEND_PROGRESS=10,e.progressIndex=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);var e=ZJ.ShapeUtil.getRect(0,1,this.stage.stageWidth,this.stage.stageHeight);this.addChild(e)},e.prototype.startCount=function(){var t=this;this.intervalID=setInterval(function(){t.ran2=Math.min(t.ran2+8*Math.random()+2,99),t.progress.value=Math.floor((t.ran1+t.ran2)/2)},200)},e.prototype.onProgress=function(t,e){this.progressIndex==this.SEND_PROGRESS-1&&ChushouSDK.instance.csNotifyLoadProgress(t/e*100),this.progressIndex=++this.progressIndex%this.SEND_PROGRESS},e.prototype.onDestroy=function(){return t.prototype.onDestroy.call(this),0},e}(ZJ.ViewBase);__reflect(ChushouLoadingView.prototype,"ChushouLoadingView");var ChushouSDK=function(){function t(){this.gameRoomId="",this.role="",this.title="分享标题",this.image="/resource/assets/egret_icon.png",this.description="分享描述",this.enableMic="1",this.enableAudioOutput="1",this.csAuthRequestData=null}return Object.defineProperty(t,"instance",{get:function(){return this._instance||(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.csAuthRequest=function(t){var e=this;console.log("csAuthRequest"),csAuthRequest('{"h5AppName" : "'+ModuleConfig.compile.chushou_h5AppName+'","launchMode" : "'+chushouGameConfig.launchMode+'","inviteMode" : "'+chushouGameConfig.inviteMode+'","gameRoomId" : "'+chushouGameConfig.gameRoomId+'"}',function(n){console.log("cb csAuthRequest"),console.log(n);var i=JSON.parse(n);e.csAuthRequestData=i,t&&t(i)})},t.prototype.csJoinRoom=function(t){console.log("csJoinRoom "+this.gameRoomId),csJoinRoom('{"accessToken" : "'+this.csAuthRequestData.accessToken+'","gameRoomId" : "'+this.gameRoomId+'","role" : "'+this.csAuthRequestData.role+'"}',function(e){console.log("cb csJoinRoom"),console.log(e.toString()),t&&t(JSON.parse(e))})},t.prototype.csQuitRoom=function(t){console.log("csQuitRoom"),csQuitRoom('{"accessToken" : "'+this.csAuthRequestData.accessToken+'","gameRoomId" : "'+this.gameRoomId+'"}',function(e){console.log("cb csQuitRoom"),t&&t(JSON.parse(e))})},t.prototype.csInviteToGame=function(t){console.log("csInviteToGame"),csInviteToGame('{"accessToken" : "'+this.csAuthRequestData.accessToken+'","gameRoomId" : "'+this.gameRoomId+'","inviteMode" : "'+chushouGameConfig.inviteMode+'","title" : "'+this.title+'","description" : "'+this.description+'","image" : "'+this.image+'"}',function(e){console.log("cb csInviteToGame"),t&&t(JSON.parse(e))})},t.prototype.csKickOutUser=function(t){console.log("csKickOutUser"),csKickOutUser('{"accessToken" : "'+this.csAuthRequestData.accessToken+'","targetUid" : "sl23859","gameRoomId" : "'+this.gameRoomId+'"}',function(e){console.log("cb csKickOutUser"),t&&t(JSON.parse(e))})},t.prototype.csShareRoom=function(t){console.log("csShareRoom"),csShareRoom('{"accessToken" : "'+this.csAuthRequestData.accessToken+'","gameRoomId" : "'+this.gameRoomId+'","title" : "'+this.title+'","description" : "'+this.description+'","image" : "'+this.image+'"}',function(e){console.log("cb csShareRoom"),t&&t(JSON.parse(e))})},t.prototype.csShareRecord=function(t){console.log("csShareRecord"),csShareRecord('{"accessToken" : "'+this.csAuthRequestData.accessToken+'","gameRecordId" : "119844","title" : "'+this.title+'","description" : "'+this.description+'","image" : "'+this.image+'"}',function(e){console.log("cb csShareRecord"),t&&t(JSON.parse(e))})},t.prototype.csGetFriendList=function(t){console.log("csGetFriendList"),csGetFriendList('{"accessToken" : "'+this.csAuthRequestData.accessToken+'","numPerPage" : "10","breakpoint" : "18823-ffgh-cc08"}',function(e){console.log("cb csGetFriendList"),t&&t(JSON.parse(e))})},t.prototype.csGetUserRelationship=function(t,e){for(var n="",i=0;i<t.length;i++)n+=t[i],i!=t.length-1&&(n+=",");console.log("csGetUserRelationship"),csGetUserRelationship('{"accessToken" : "'+this.csAuthRequestData.accessToken+'","users" : "'+n+'"}',function(t){console.log("cb csGetUserRelationship"),e&&e(JSON.parse(t))})},t.prototype.csFollowUser=function(t,e){console.log("csFollowUser"),csFollowUser('{"accessToken" : "'+this.csAuthRequestData.accessToken+'","targetUid" : "'+t+'"}',function(t){console.log("cb csFollowUser"),e&&e(JSON.parse(t))})},t.prototype.csEnableMic=function(t){console.log("csEnableMic"),csEnableMic('{"accessToken" : "'+this.csAuthRequestData.accessToken+'","enableMic" : '+this.enableMic+"}",function(e){console.log("cb csEnableMic"),t&&t(JSON.parse(e))})},t.prototype.csEnableAudioOutput=function(t){console.log("csEnableAudioOutput"),csEnableAudioOutput('{"accessToken" : "'+this.csAuthRequestData.accessToken+'","enableAudioOutput" : "'+this.enableAudioOutput+'"}',function(e){console.log("cb csEnableAudioOutput"),t&&t(JSON.parse(e))})},t.prototype.onUserVolumeUpdate=function(t){console.log("onUserVolumeUpdate"),onUserVolumeUpdate(function(e){console.log("cb onUserVolumeUpdate"),t&&t(JSON.parse(e))})},t.prototype.csExitGame=function(t){console.log("csExitGame "+this.csAuthRequestData.accessToken),this.csQuitRoom(),csExitGame('{"accessToken" : "'+this.csAuthRequestData.accessToken+'"}')},t.prototype.csNotifyLoadProgress=function(t,e){console.log("csNotifyLoadProgress"),csNotifyLoadProgress('{"total" : "100","progress" : "'+t+'"}')},t.prototype.onNetworkStatusChange=function(t){console.log("onNetworkStatusChange"),onNetworkStatusChange(function(e){console.log("cb onNetworkStatusChange"),t&&t(JSON.parse(e))})},t.prototype.csGetAPIVersionInfo=function(t){console.log("csGetAPIVersionInfo"),csGetAPIVersionInfo('{"h5AppName" : "'+ModuleConfig.compile.chushou_h5AppName+'","launchMode" : "'+chushouGameConfig.launchMode+'","inviteMode" : "'+chushouGameConfig.inviteMode+'","gameRoomId" : "'+this.gameRoomId+'"}',function(e){console.log("cb csGetAPIVersionInfo"),t&&t(JSON.parse(e))})},t.prototype.csInvokeRecharge=function(t){console.log("csInvokeRecharge"),csInvokeRecharge('{"accessToken" : "'+this.csAuthRequestData.accessToken+'","paymentScene" : "1",}',function(e){console.log("cb csInvokeRecharge"),t&&t(JSON.parse(e))})},t.prototype.onBalanceChanged=function(t){console.log("onBalanceChanged")},t.prototype.csPurchaseProps=function(t){console.log("csPurchaseProps"),csPurchaseProps('{"accessToken" : "'+this.csAuthRequestData.accessToken+'","cpOrderId" : "prop7865421","cpPropName" : "双倍积分卡","cpPropId" : "1","payAmount" : "500"}',function(e){console.log("cb csPurchaseProps"),t&&t(JSON.parse(e))})},t.prototype.csPayEntryFee=function(t){console.log("csPayEntryFee"),csPayEntryFee('{"accessToken" : "'+this.csAuthRequestData.accessToken+'","cpOrderId" : "prop7865425","cpPropName" : "游戏⼊场费","cpPropId" : "999"}',function(e){console.log("cb csPayEntryFee"),t&&t(JSON.parse(e))})},t.prototype.csCheckEntryFee=function(t){console.log("csCheckEntryFee"),csCheckEntryFee('{"accessToken" : "'+this.csAuthRequestData.accessToken+'"}',function(e){console.log("cb csCheckEntryFee"),t&&t(JSON.parse(e))})},t}();__reflect(ChushouSDK.prototype,"ChushouSDK");var xlsx;!function(t){t.cfg_c_goat="shared/c_goat.json",t.c_goat_id="A",t.c_goat_weight="B",t.c_goat_strength="C",t.c_goat_score="D"}(xlsx||(xlsx={}));